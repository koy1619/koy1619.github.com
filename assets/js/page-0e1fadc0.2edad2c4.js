(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{392:function(e,s,a){"use strict";a.r(s);var t=a(2),n=Object(t.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("p",[e._v("手动部署的k8s集群, 需要为master节点手动设置taints")]),e._v(" "),a("p",[e._v("设置taint")]),e._v(" "),a("p",[e._v("语法:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl taint node "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("key")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("effect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("   \n     其中"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("effect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" 可取值: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v(" NoSchedule "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" PreferNoSchedule "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" NoExecute "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n      NoSchedule: 一定不能被调度\n      PreferNoSchedule: 尽量不要调度\n      NoExecute: 不仅不会调度, 还会驱逐Node上已有的Pod\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br")])]),a("p",[e._v("示例:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl taint node node1 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("key1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("value1:NoSchedule\nkubectl taint node node1 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("key1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("value1:NoExecute\nkubectl taint node node1 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("key2")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("value2:NoSchedule\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[e._v("查看taint：")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl describe node node1\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("删除taint:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl taint node node1 key1:NoSchedule-  "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 这里的key可以不用指定value")]),e._v("\nkubectl taint node node1 key1:NoExecute-\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# kubectl taint node node1 key1-  删除指定key所有的effect")]),e._v("\nkubectl taint node node1 key2:NoSchedule-\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])]),a("p",[e._v("master节点设置taint")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl taint nodes master1 node-role.kubernetes.io/master"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(":NoSchedule\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("div",{staticClass:"custom-block warning"},[a("p",[e._v("注意⚠️ : 为master设置的这个taint中, node-role.kubernetes.io/master为key, value为空, effect为NoSchedule")])]),e._v(" "),a("p",[e._v("如果输入命令时, 你丢掉了=符号, 写成了node-role.kubernetes.io/master:NoSchedule, 会报error: at least one taint update is required错误")]),e._v(" "),a("p",[e._v("容忍tolerations主节点的taints")]),e._v(" "),a("p",[e._v("以上面为 master1 设置的 taints 为例, 你需要为你的 yaml 文件中添加如下配置, 才能容忍 master 节点的污点")]),e._v(" "),a("p",[e._v("在 pod 的 spec 中设置 tolerations 字段")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('tolerations:\n- key: "node-role.kubernetes.io/master"\n  operator: "Equal"\n  value: ""\n  effect: "NoSchedule"\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br")])]),a("p",[e._v("参考官方手册")]),e._v(" "),a("p",[e._v("https://kubernetes.io/zh/docs/concepts/configuration/taint-and-toleration/")])])}),[],!1,null,null,null);s.default=n.exports}}]);