(window.webpackJsonp=window.webpackJsonp||[]).push([[154],{519:function(s,t,n){"use strict";n.r(t);var a=n(2),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"症状描述："}},[n("a",{staticClass:"header-anchor",attrs:{href:"#症状描述："}},[s._v("#")]),s._v(" 症状描述：")]),s._v(" "),n("pre",[n("code",[s._v("ps -ef |grep sendmail 满屏\nps -ef |grep postdrop 满屏\n")])]),s._v(" "),n("p",[s._v("查看log疯狂刷屏")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@10-10-11-141 runtime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tail -f /var/log/maillog")]),s._v("\nNov "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":00:24 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-10-11-141 postfix/postdrop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3804")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": warning: mail_queue_enter: create "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" maildrop/634461.3804: No such "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" or directory\nNov "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":00:24 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-10-11-141 postfix/postdrop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4147")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": warning: mail_queue_enter: create "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" maildrop/634601.4147: No such "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" or directory\nNov "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":00:24 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-10-11-141 postfix/postdrop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1741")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": warning: mail_queue_enter: create "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" maildrop/634604.1741: No such "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" or directory\nNov "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":00:24 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-10-11-141 postfix/postdrop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1967")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": warning: mail_queue_enter: create "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" maildrop/843229.1967: No such "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" or directory\nNov "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":00:25 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-10-11-141 postfix/postdrop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3244")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": warning: mail_queue_enter: create "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" maildrop/135131.3244: No such "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" or directory\nNov "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":00:25 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-10-11-141 postfix/postdrop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2514")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": warning: mail_queue_enter: create "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" maildrop/135247.2514: No such "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" or directory\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("同时"),n("code",[s._v("/var/spool/postfix/maildrop/")]),s._v("文件夹下出现大量簇文件")]),s._v(" "),n("h2",{attrs:{id:"解决"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解决"}},[s._v("#")]),s._v(" 解决")]),s._v(" "),n("p",[s._v("使用"),n("code",[s._v("pstree|grep crond")]),s._v("，结果如下：")]),s._v(" "),n("pre",[n("code",[s._v(" |-crond---125*[crond---sendmail---postdrop]  \n")])]),s._v(" "),n("p",[s._v("可见crond守护进程启动了sendmail，进而启动了postdrop。查看crond的配置， crontab -e，都没有发现几秒就启动的程序，所以可能是sendmail自己一旦邮件发送不成功，就持续重新发送而导致持续启动postdrop，而postdrop总是执行失败，导致持续写入日志到日志文件。日志文件增大的速率超过了logrotate的删除频率，所以占据了100%的磁盘空间。并且线程数也不断的增加。")]),s._v(" "),n("p",[s._v("首先停掉posfix "),n("code",[s._v("/etc/init.d/posfix stop")]),s._v("并删除"),n("code",[s._v("/var/spool/postfix/maildrop/")]),s._v("下面的全部簇文件，释放磁盘inode！")]),s._v(" "),n("p",[s._v("然后就是手起刀落干掉sendmail和postdrop的进程，注意先干掉postdrop子进程")]),s._v(" "),n("pre",[n("code",[s._v("kill -9 $(ps -auwx | grep postdrop | gawk -F' ' '{print $2}')\nkill -9 $(ps -auwx | grep sendmail | gawk -F' ' '{print $2}')\n")])]),s._v(" "),n("p",[s._v("之后还要设置crond的MAILTO为空")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@10-10-11-141 runtime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/cron.d/0hourly ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MAILTO")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("SHELL")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/bin/bash\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/sbin:/bin:/usr/sbin:/usr/bin\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("HOME")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/\n01 * * * * root run-parts /etc/cron.hourly\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@10-10-11-141 runtime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/crontab ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MAILTO")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("SHELL")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/bin/bash\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/sbin:/bin:/usr/sbin:/usr/bin\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("HOME")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# For details see man 4 crontabs")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Example of job definition:")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# .---------------- minute (0 - 59)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# |  .------------- hour (0 - 23)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# |  |  .---------- day of month (1 - 31)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# |  |  |  |  |")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# *  *  *  *  * user-name command to be executed")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@10-10-11-141 runtime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# service crond restart")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("p",[s._v("最后整个世界都清静了！")])])}),[],!1,null,null,null);t.default=e.exports}}]);