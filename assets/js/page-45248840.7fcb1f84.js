(window.webpackJsonp=window.webpackJsonp||[]).push([[86],{389:function(s,e,a){"use strict";a.r(e);var t=a(2),n=Object(t.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[a("strong",[s._v("问题背景")])]),s._v(" "),a("p",[s._v("部署"),a("code",[s._v("KubeSphere")]),s._v("中间有问题，删除集群重新部署的，导致命名空间状态一直处于"),a("code",[s._v("Terminating")]),s._v("，使用"),a("code",[s._v("kubectl get all -n $NAMESPACE")]),s._v("命令显示已经没有资源，但仍无法删除。")]),s._v(" "),a("p",[s._v("命名空间无法删除通常是因为还有资源在使用这个命名空间，这个资源可能自己的状态也已经不正常了，或者是因为不正确的操作导致有空耦合")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl  get ns")]),s._v("\nNAME                           STATUS        AGE\nistio-system                   Active        21h\npaas-app                       Active        44d\nkube-system                    Active        44d\nkubesphere-controls-system     Terminating   21h\nkubesphere-devops-system       Terminating   21h\nkubesphere-logging-system      Terminating   21h\nkubesphere-monitoring-system   Terminating   23h\nkubesphere-system              Terminating   23h\nopenpitrix-system              Terminating   21h\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("三种尝试方法，最后一个终于成功删除了，此处记录一下")]),s._v(" "),a("p",[a("strong",[s._v("1. 强制删除")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl delete namespace kubesphere-system --force --grace-period"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("2. 使用api删除")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#先安装jq")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -ivh epel-release-latest-7.noarch.rpm\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y jq\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NAMESPACE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubesphere-system\nkubectl proxy "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\nkubectl get namespace "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NAMESPACE")]),s._v(" -o json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jq "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.spec = {\"finalizers\":[]}'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("temp.json\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -k -H "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Content-Type: application/json"')]),s._v(" -X PUT --data-binary @temp.json "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:8001/api/v1/namespaces/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NAMESPACE")]),s._v("/finalize\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("strong",[s._v("3. "),a("code",[s._v("kubectl edit")]),s._v("修改状态")])]),s._v(" "),a("p",[a("code",[s._v("kubectl edit namespace kubesphere-system")])]),s._v(" "),a("p",[s._v("将"),a("code",[s._v("finalizers")]),s._v("这条"),a("code",[s._v("value")]),s._v("改为"),a("code",[s._v("finalizers: []")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2019/11/08/H26gl7mMJ9evzAb.png",alt:"微信图片_20191108104510.png"}})]),s._v(" "),a("p",[s._v("保存即可看到该"),a("code",[s._v("namespace")]),s._v("已被删除")]),s._v(" "),a("p",[s._v("参考")]),s._v(" "),a("p",[s._v("https://blog.csdn.net/fengwuxichen/article/details/87877214")]),s._v(" "),a("p",[s._v("https://segmentfault.com/a/1190000016924414")])])}),[],!1,null,null,null);e.default=n.exports}}]);