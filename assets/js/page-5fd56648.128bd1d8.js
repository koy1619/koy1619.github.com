(window.webpackJsonp=window.webpackJsonp||[]).push([[108],{396:function(s,a,t){"use strict";t.r(a);var n=t(2),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"kube-dns"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kube-dns"}},[s._v("#")]),s._v(" kube-dns")]),s._v(" "),t("p",[s._v("7月份刚开始研究的时候，因为pod要读取阿里云RDS，和一些公网的接口，需要DNS解析")]),s._v(" "),t("p",[s._v("所以安装了"),t("a",{attrs:{href:"https://linux48.com/container/2019-07-12-k8s.html#%E5%AE%89%E8%A3%85kube-dns",target:"_blank",rel:"noopener noreferrer"}},[s._v("kube-dns"),t("OutboundLink")],1),s._v("，解决了容器使用DNS解析的问题")]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"造轮子解析内网hosts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#造轮子解析内网hosts"}},[s._v("#")]),s._v(" 造轮子解析内网hosts")]),s._v(" "),t("p",[s._v("后来还有一些内网的自定义hosts解析，因为没有上公网，所以需要pod自行加hosts解析")]),s._v(" "),t("p",[s._v("刚开是研究使用dockerfile+脚本，给容器强加hosts，后来发现虽然可行，但是还是有问题，并且这种做法在目前看来是十分落后和愚蠢的")]),s._v(" "),t("p",[s._v("因为后面有更好的方案，这里就不放怎么造轮子了。。。免得误导观众")]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"hostaliases"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hostaliases"}},[s._v("#")]),s._v(" HostAliases")]),s._v(" "),t("p",[s._v("后来发现从1.7版本开始，k8s支持了 HostAliases 特性： "),t("code",[s._v(".spec.hostAliases")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master yaml"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat paas-app/paas-gateway-server.yaml ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ------------------- App Deployment ------------------- #")]),s._v("\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: paas-gateway-server\nspec:\n  replicas: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n  template:\n    metadata:\n      labels:\n        app: paas-gateway-server\n    spec:\n      hostAliases:\n      - ip: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.255.0.170"')]),s._v("\n        hostnames:\n        - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"paas-nacos-register"')]),s._v("\n        - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"paas-nacos-config"')]),s._v("\n      - ip: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.1.2.3"')]),s._v("\n        hostnames:\n        - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"foo.remote"')]),s._v("\n        - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bar.remote"')]),s._v("\n      containers:\n        - name: paas-gateway-server\n          image: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'registry:5000/paas-gateway-server:latest'")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#imagePullPolicy: IfNotPresent")]),s._v("\n          imagePullPolicy: Always\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("p",[s._v("登陆pod查看hosts")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master yaml"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl exec -it paas-gateway-server-68f8d6f8fb-jkvn6 -- /bin/bash")]),s._v("\nroot@paas-gateway-server-68f8d6f8fb-jkvn6:/app"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/hosts")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Kubernetes-managed hosts file.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1       localhost\n::1     localhost ip6-localhost ip6-loopback\nfe00::0 ip6-localnet\nfe00::0 ip6-mcastprefix\nfe00::1 ip6-allnodes\nfe00::2 ip6-allrouters\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.254")]),s._v(".31.3     paas-gateway-server-68f8d6f8fb-jkvn6\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Entries added by HostAliases.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.255")]),s._v(".0.170    paas-nacos-register     paas-nacos-config\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".2.3        foo.remote      bar.remote\nroot@paas-gateway-server-68f8d6f8fb-jkvn6:/app"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("这样子就完美解决了")]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"coredns"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#coredns"}},[s._v("#")]),s._v(" CoreDNS")]),s._v(" "),t("p",[s._v("后来因为安装"),t("a",{attrs:{href:"https://kubesphere.com.cn/",target:"_blank",rel:"noopener noreferrer"}},[s._v("kubesphere"),t("OutboundLink")],1),s._v("，使用devpos的时候需要添加registry解析，发现devops相关的yaml都需要加一遍hostAliases")]),s._v(" "),t("p",[t("strong",[s._v("这样子弊端就出现了，业务一旦多起来，就很难维护")])]),s._v(" "),t("p",[t("strong",[s._v("接着又发现一个更先进的dns系统-----CoreDNS")])]),s._v(" "),t("p",[s._v("从 v1.11 开始可以使用 CoreDNS 来提供命名服务，并从 v1.13 开始成为默认 DNS 服务。CoreDNS 的特点是效率更高，资源占用率更小，推荐使用 CoreDNS 替代 kube-dns 为集群提供 DNS 服务。")]),s._v(" "),t("p",[s._v("从 kube-dns 升级为 CoreDNS 的步骤为：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/coredns/deployment\n$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" deployment/kubernetes\n$ ./deploy.sh "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" kubectl apply -f -\n$ kubectl delete --namespace"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kube-system deployment kube-dns\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("全新部署CoreDNS")]),s._v(" "),t("p",[s._v("修改REVERSE_CIDRS、DNS_DOMAIN、CLUSTER_DNS_IP等变量为实际值")]),s._v(" "),t("p",[s._v("具体命令")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("./deploy.sh -s -r "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.254")]),s._v(".0.0/16 -i "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.254")]),s._v(".0.100 -d cluster.local "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" coredns.yaml\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("diff")]),s._v(" coredns.yaml coredns.yaml.sed\nkubectl create -f coredns.yaml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("这里不用担心镜像被Q，都是可以下下来的，不像kube-dns的镜像都是google上的~~")]),s._v(" "),t("p",[s._v("下面就展示一下使用CoreDNS添加自定义DNS解析记录")]),s._v(" "),t("p",[s._v("coredns 自带 hosts 插件， 允许像配置 hosts 一样配置自定义 DNS 解析，修改 kube-system 中 configMap 的 coredns 添加如下标黑设置即可。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master system"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat coredns/kubernetes/coredns.yaml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: coredns\n  namespace: kube-system\ndata:\n  Corefile: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n    .:53 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        errors\n        health "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          lameduck 5s\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        ready\n        kubernetes cluster.local  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.254")]),s._v(".0.0/16 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          pods insecure\n          fallthrough in-addr.arpa ip6.arpa\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        hosts "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.255")]),s._v(".0.170 registry\n            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.127")]),s._v(".0.16 paas-nacos-register\n            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.127")]),s._v(".0.16 paas-nacos-config\n\n            fallthrough\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        prometheus :9153\n        forward "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" /etc/resolv.conf\n        cache "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n        loop\n        reload\n        loadbalance\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n---\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br")])]),t("p",[s._v("也可以使用")]),s._v(" "),t("p",[t("code",[s._v("kubectl edit configmap coredns -n kube-system -o yaml")])]),s._v(" "),t("p",[s._v("该命令可编辑 coredns 的配置文件，编辑 data 字段即可，即时生效")]),s._v(" "),t("p",[s._v("验证")]),s._v(" "),t("p",[s._v("删除yaml里面的hostAliases配置，重新 kubectl apply")]),s._v(" "),t("p",[s._v("登陆容器ping一下")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master paas-app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl exec -it paas-gateway-server-8c6fb49ff-xd9tq -- /bin/bash")]),s._v("\nroot@paas-gateway-server-8c6fb49ff-xd9tq:/app"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/hosts")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Kubernetes-managed hosts file.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1       localhost\n::1     localhost ip6-localhost ip6-loopback\nfe00::0 ip6-localnet\nfe00::0 ip6-mcastprefix\nfe00::1 ip6-allnodes\nfe00::2 ip6-allrouters\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.254")]),s._v(".31.3     paas-gateway-server-8c6fb49ff-xd9tq\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## hosts配置没有了，由于coredns直接在最上游定义了hosts，所以自定义的解析生效了")]),s._v("\n\nroot@paas-gateway-server-8c6fb49ff-xd9tq:/app"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ping registry")]),s._v("\nPING registry "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.255")]),s._v(".0.170"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v(" data bytes\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.255")]),s._v(".0.170: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.306")]),s._v(" ms\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.255")]),s._v(".0.170: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.278")]),s._v(" ms\n^C--- registry "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" statistics ---\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" packets transmitted, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" packets received, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% packet loss\nround-trip min/avg/max/stddev "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.278")]),s._v("/0.292/0.306/0.000 ms\nroot@paas-gateway-server-8c6fb49ff-xd9tq:/app"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("p",[s._v("可见即使有在多的业务，只要coredns加了解析，都不是问题")]),s._v(" "),t("p",[t("strong",[s._v("在此强力推荐coredns方案（暂时，如果还有更好的方案。。 😂 😂 😂）")])]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("当然如果内网有专门的DNS服务器；coredns支持配置私有 DNS 服务器和上游 DNS 服务器，此处就不深究了，详见官方文档")]),s._v(" "),t("p",[s._v("https://kubernetes.io/zh/docs/tasks/administer-cluster/dns-custom-nameservers/")]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("参考")]),s._v(" "),t("p",[s._v("https://ieevee.com/tech/2018/04/29/k8s-hostaliases.html")]),s._v(" "),t("p",[s._v("https://kubernetes.feisky.xyz/setup/addon-list/kube-dns#kube-dns")]),s._v(" "),t("p",[s._v("https://blog.csdn.net/kunyus/article/details/88841159")]),s._v(" "),t("p",[s._v("https://kubesphere.io/docs/v2.1/zh-CN/system-settings/edit-system-settings/#%E5%A6%82%E4%BD%95%E4%BF%AE%E6%94%B9-coredns-%E9%85%8D%E7%BD%AE")])])}),[],!1,null,null,null);a.default=e.exports}}]);