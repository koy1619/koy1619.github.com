(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{364:function(a,s,t){"use strict";t.r(s);var e=t(1),r=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"zabbix-3-0邮件报警"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#zabbix-3-0邮件报警","aria-hidden":"true"}},[a._v("#")]),a._v(" zabbix 3.0邮件报警")]),a._v(" "),t("p",[a._v("安装zabbix 3.0之后，写的脚本一直发信不成功,手动执行时可以的。\n那是因为zabbix3.0之后，可以自定义参数了。所以不写参数，它是不会传参数的。\n在2.x版本不存在这个问题，默认会传3个参数。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# cat alert_mail.log")]),a._v("\nsendEmail"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9271")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(": ERROR "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" You must specify at least one recipient via -t, -cc, or -bcc\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# cat alert_sms.log")]),a._v("\n手机机号码不能为空\n")])])]),a._v(" "),t("p",[a._v("进入zabbix管理页面\n点击管理->报警媒介类型 点击最右边的创建媒体类型")]),a._v(" "),t("p",[a._v("输入脚本名称，类型选择脚本\n添加以下3个参数，分别对应sendEmail.sh脚本需要的3个参数：收件人地址、主题、详细内容")]),a._v(" "),t("blockquote",[t("ul",[t("li",[a._v("{ALERT.SENDTO}")]),a._v(" "),t("li",[a._v("{ALERT.SUBJECT}")]),a._v(" "),t("li",[a._v("{ALERT.MESSAGE}")])])]),a._v(" "),t("p",[t("img",{attrs:{src:"http://r5.loli.io/ruEVne.png",alt:""}})]),a._v(" "),t("p",[a._v("邮件发送脚本")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[a._v("#!/bin/sh")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#$1, $2, $3 mean Recipient, Subject and Message")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("to")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$1")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("subject")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$2")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("body")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$3")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("DATE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"+%Y%m%d %H:%M:%S"')]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /usr/local/zabbix-server/share/zabbix/alertscripts\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$DATE")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v("alert_mail.log\n\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("MAIL")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'/usr/local/zabbix-server/share/zabbix/alertscripts/sendEmail'")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$MAIL")]),a._v(" -s smtp.test.com.cn -f zabbix@test.com.cn -t "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$to")]),a._v('"')]),a._v(" -xu zabbix@test.com.cn -xp "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'test2015test2015'")]),a._v(" -u "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$subject")]),a._v('"')]),a._v(" -m "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$body")]),a._v('"')]),a._v(" -o "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" alert_mail.log\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$1")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" alert_mail.log\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$2")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" alert_mail.log\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$3")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" alert_mail.log\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);