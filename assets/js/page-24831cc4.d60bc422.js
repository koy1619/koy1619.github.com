(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{369:function(s,a,e){"use strict";e.r(a);var t=e(2),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("div",{staticClass:"custom-block tip"},[e("ul",[e("li",[s._v("本文为初次安装，并不一定具有参考价值。")])])]),s._v(" "),e("h1",{attrs:{id:"操作系统要求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#操作系统要求"}},[s._v("#")]),s._v(" 操作系统要求")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# uname -a")]),s._v("\nLinux localhost.localdomain "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.10")]),s._v(".0-514.6.1.el7.x86_64 "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1 SMP Wed Jan 18 13:06:36 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/redhat-release ")]),s._v("\nCentOS Linux release "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.3")]),s._v(".1611 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Core"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h1",{attrs:{id:"节点分配"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#节点分配"}},[s._v("#")]),s._v(" 节点分配")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[s._v("节点及功能")]),s._v(" "),e("th",{staticStyle:{"text-align":"center"}},[s._v("主机名")]),s._v(" "),e("th",{staticStyle:{"text-align":"center"}},[s._v("ip")])])]),s._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[s._v("kube-apiserver、kube-controller-manager、kube-scheduler、docker、etcd、registry、flannel")]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("K8s-master")]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("10.1.1.100")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[s._v("kubelet、kubeproxy、docker、flannel")]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("K8s-node-1")]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("10.1.1.101")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[s._v("kubelet、kubeproxy、docker、flannel")]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("K8s-node-2")]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("10.1.1.102")])])])]),s._v(" "),e("h1",{attrs:{id:"基础配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#基础配置"}},[s._v("#")]),s._v(" 基础配置")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("hostnamectl --static set-hostname  k8s-master\nhostnamectl --static set-hostname  k8s-node-1\nhostnamectl --static set-hostname  k8s-node-2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/hosts\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".1.100    k8s-master\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".1.100    etcd\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".1.100    registry\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".1.101    k8s-node-1\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".1.102    k8s-node-2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl disable firewalld.service\nsystemctl stop firewalld.service\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h1",{attrs:{id:"all-所有机器安装-docker-和-kubernetes"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#all-所有机器安装-docker-和-kubernetes"}},[s._v("#")]),s._v(" all 所有机器安装 docker 和 kubernetes")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("yum update -y\nyum remove -y docker\nyum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y yum-utils\nyum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\nyum -y "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker kubernetes\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/docker/daemon.json\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"insecure-registries"')]),s._v(":"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry:5000"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nsystemctl start docker\nsystemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" docker\ndocker version\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("h1",{attrs:{id:"master-启动私服"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#master-启动私服"}},[s._v("#")]),s._v(" master 启动私服")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("docker run -d -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(":5000 --name"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("registry --restart"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always --privileged"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true  --log-driver"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("none -v /home/data/registrydata:/tmp/registry registry\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h1",{attrs:{id:"国外机器拉取被河蟹的镜像并保存传到国内"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#国外机器拉取被河蟹的镜像并保存传到国内"}},[s._v("#")]),s._v(" 国外机器拉取被河蟹的镜像并保存传到国内")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("docker pull gcr.io/google_containers/kubernetes-dashboard-amd64:v1.7.1\ndocker pull registry.access.redhat.com/rhel7/pod-infrastructure:latest\ndocker pull gcr.io/google_containers/k8s-dns-kube-dns-amd64:1.14.4\ndocker pull myhub.fdccloud.com/library/kubedns-amd64:1.9\ndocker pull myhub.fdccloud.com/library/kube-dnsmasq-amd64:1.4\ndocker pull myhub.fdccloud.com/library/dnsmasq-metrics-amd64:1.0\ndocker pull myhub.fdccloud.com/library/exechealthz-amd64:1.2\n\ndocker save gcr.io/google_containers/kubernetes-dashboard-amd64:v1.7.1 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" kubernetes-dashboard-amd64.tar\ndocker save registry.access.redhat.com/rhel7/pod-infrastructure:latest "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" pod-infrastructure.tar\ndocker save gcr.io/google_containers/k8s-dns-kube-dns-amd64:1.14.4 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" k8s-dns-kube-dns-amd64.tar\ndocker save myhub.fdccloud.com/library/kubedns-amd64:1.9  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" kubedns-amd64.tar\ndocker save myhub.fdccloud.com/library/kube-dnsmasq-amd64:1.4  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" kube-dnsmasq-amd64.tar\ndocker save myhub.fdccloud.com/library/dnsmasq-metrics-amd64:1.0  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" dnsmasq-metrics-amd64.tar\ndocker save myhub.fdccloud.com/library/exechealthz-amd64:1.2  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" exechealthz-amd64.tar\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("h1",{attrs:{id:"node-1导入镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#node-1导入镜像"}},[s._v("#")]),s._v(" node-1导入镜像")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("docker load "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" kubernetes-dashboard-amd64.tar\ndocker load "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" pod-infrastructure.tar\ndocker load "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" k8s-dns-kube-dns-amd64.tar\ndocker load "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" kubedns-amd64.tar\ndocker load "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" kube-dnsmasq-amd64.tar\ndocker load "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" dnsmasq-metrics-amd64.tar\ndocker load "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" exechealthz-amd64.tar\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h1",{attrs:{id:"node-1-镜像打tag并传至私服"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#node-1-镜像打tag并传至私服"}},[s._v("#")]),s._v(" node-1 镜像打tag并传至私服")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("docker tag registry.access.redhat.com/rhel7/pod-infrastructure:latest registry:5000/pod-infrastructure:latest\ndocker push registry:5000/pod-infrastructure:latest\n\ndocker tag gcr.io/google_containers/kubernetes-dashboard-amd64:v1.7.1 registry:5000/kubernetes-dashboard-amd64:v1.7.1\ndocker push registry:5000/kubernetes-dashboard-amd64:v1.7.1\n\ndocker tag gcr.io/google_containers/k8s-dns-kube-dns-amd64:1.14.4 registry:5000/k8s-dns-kube-dns-amd64:1.14.4\ndocker push registry:5000/k8s-dns-kube-dns-amd64:1.14.4\n\ndocker tag myhub.fdccloud.com/library/kubedns-amd64:1.9 registry:5000/kubedns-amd64:1.9\ndocker push registry:5000/kubedns-amd64:1.9\n\ndocker tag myhub.fdccloud.com/library/kube-dnsmasq-amd64:1.4 registry:5000/kube-dnsmasq-amd64:1.4\ndocker push registry:5000/kube-dnsmasq-amd64:1.4\n\ndocker tag myhub.fdccloud.com/library/dnsmasq-metrics-amd64:1.0 registry:5000/dnsmasq-metrics-amd64:1.0\ndocker push registry:5000/dnsmasq-metrics-amd64:1.0\n\ndocker tag myhub.fdccloud.com/library/exechealthz-amd64:1.2 registry:5000/exechealthz-amd64:1.2\ndocker push registry:5000/exechealthz-amd64:1.2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br")])]),e("h1",{attrs:{id:"node-2-验证拉取私服镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#node-2-验证拉取私服镜像"}},[s._v("#")]),s._v(" node-2 验证拉取私服镜像")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("docker pull registry:5000/pod-infrastructure:latest\ndocker pull registry:5000/kubernetes-dashboard-amd64:v1.7.1\ndocker pull registry:5000/k8s-dns-kube-dns-amd64:1.14.4\ndocker pull registry:5000/kubedns-amd64:1.9\ndocker pull registry:5000/kube-dnsmasq-amd64:1.4\ndocker pull registry:5000/dnsmasq-metrics-amd64:1.0\ndocker pull registry:5000/exechealthz-amd64:1.2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h1",{attrs:{id:"master-部署etcd服务配置启动检查"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#master-部署etcd服务配置启动检查"}},[s._v("#")]),s._v(" master 部署etcd服务配置启动检查")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("yum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" etcd -y\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@iZuf63961c1lfkvsm4shneZ ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# egrep -v '^#' /etc/etcd/etcd.conf | grep -v '^$'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_DATA_DIR")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/etcd/default.etcd"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_LISTEN_CLIENT_URLS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://0.0.0.0:2379,http://0.0.0.0:4001"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_NAME")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_ADVERTISE_CLIENT_URLS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://etcd:2379,http://etcd:4001"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@iZuf63961c1lfkvsm4shneZ ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@iZuf63961c1lfkvsm4shneZ ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start etcd")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@iZuf63961c1lfkvsm4shneZ ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# etcdctl set testdir/testkey0 0")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@iZuf63961c1lfkvsm4shneZ ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# etcdctl get testdir/testkey0")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@iZuf63961c1lfkvsm4shneZ ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# etcdctl -C http://etcd:4001 cluster-health")]),s._v("\nmember 8e9e05c52164694d is healthy: got healthy result from http://etcd:2379\ncluster is healthy\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@iZuf63961c1lfkvsm4shneZ ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# etcdctl -C http://etcd:2379 cluster-health")]),s._v("\nmember 8e9e05c52164694d is healthy: got healthy result from http://etcd:2379\ncluster is healthy\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@iZuf63961c1lfkvsm4shneZ ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("h1",{attrs:{id:"master-kubernetes配置启动"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#master-kubernetes配置启动"}},[s._v("#")]),s._v(" master-kubernetes配置启动")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@iZuf63961c1lfkvsm4shneZ ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# egrep -v '^#' /etc/kubernetes/apiserver | grep -v '^$'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBE_API_ADDRESS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--insecure-bind-address=0.0.0.0"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBE_API_PORT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--port=8080"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBE_ETCD_SERVERS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--etcd-servers=http://etcd:2379"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBE_SERVICE_ADDRESSES")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--service-cluster-ip-range=10.254.0.0/16"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBE_ADMISSION_CONTROL")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--admission-control=NamespaceLifecycle,NamespaceExists,LimitRanger,SecurityContextDeny,ResourceQuota"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBE_API_ARGS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@iZuf63961c1lfkvsm4shneZ ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# egrep -v '^#' /etc/kubernetes/config | grep -v '^$'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBE_LOGTOSTDERR")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--logtostderr=true"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBE_LOG_LEVEL")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--v=0"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBE_ALLOW_PRIV")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--allow-privileged=false"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBE_MASTER")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--master=http://k8s-master:8080"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@iZuf63961c1lfkvsm4shneZ ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kube-apiserver.service\nsystemctl start kube-apiserver.service\nsystemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kube-controller-manager.service\nsystemctl start kube-controller-manager.service\nsystemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kube-scheduler.service\nsystemctl start kube-scheduler.service\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h1",{attrs:{id:"node-1-node-2-kubernetes配置启动"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#node-1-node-2-kubernetes配置启动"}},[s._v("#")]),s._v(" node-1  node-2 kubernetes配置启动")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@iZuf6apa66r2qwfw57sx8dZ ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# egrep -v '^#' /etc/kubernetes/config | grep -v '^$'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBE_LOGTOSTDERR")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--logtostderr=true"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBE_LOG_LEVEL")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--v=0"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBE_ALLOW_PRIV")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--allow-privileged=false"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBE_MASTER")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--master=http://k8s-master:8080"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@iZuf6apa66r2qwfw57sx8dZ ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# egrep -v '^#' /etc/kubernetes/kubelet | grep -v '^$'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBELET_ADDRESS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--address=0.0.0.0"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBELET_HOSTNAME")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--hostname-override=k8s-node-1"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBELET_API_SERVER")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--api-servers=http://k8s-master:8080"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBELET_POD_INFRA_CONTAINER")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--pod-infra-container-image=registry.access.redhat.com/rhel7/pod-infrastructure:latest"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBELET_ARGS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--cluster_dns=10.254.0.100 --cluster_domain=cluster.local"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@iZuf6apa66r2qwfw57sx8dZ ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kubelet.service\nsystemctl start kubelet.service\nsystemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kube-proxy.service\nsystemctl start kube-proxy.service\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h1",{attrs:{id:"master上查看集群中节点及节点状态"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#master上查看集群中节点及节点状态"}},[s._v("#")]),s._v(" master上查看集群中节点及节点状态")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  kubectl -s http://k8s-master:8080 get node")]),s._v("\nNAME         STATUS    AGE\nk8s-node-1   Ready     3m\nk8s-node-2   Ready     16s\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get nodes")]),s._v("\nNAME         STATUS    AGE\nk8s-node-1   Ready     3m\nk8s-node-2   Ready     43s\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h1",{attrs:{id:"master-node-安装证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#master-node-安装证书"}},[s._v("#")]),s._v(" master node 安装证书")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("yum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y *rhsm*\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://mirror.centos.org/centos/7/os/x86_64/Packages/python-rhsm-certificates-1.19.10-1.el7_4.x86_64.rpm\nrpm2cpio python-rhsm-certificates-1.19.10-1.el7_4.x86_64.rpm "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cpio -iv --to-stdout ./etc/rhsm/ca/redhat-uep.pem "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/rhsm/ca/redhat-uep.pem\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h1",{attrs:{id:"master-node-安装flannel"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#master-node-安装flannel"}},[s._v("#")]),s._v(" master node 安装Flannel")]),s._v(" "),e("p",[s._v("创建覆盖网络——Flannel")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("yum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" flannel -y\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("master、node上均编辑/etc/sysconfig/flanneld")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# egrep -v '^#' /etc/sysconfig/flanneld | grep -v '^$'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FLANNEL_ETCD_ENDPOINTS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://etcd:2379"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FLANNEL_ETCD_PREFIX")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/atomic.io/network"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("在master配置etcd中关于flannel的key")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# etcdctl mk /atomic.io/network/config \'{ "Network": "10.0.0.0/16" }\'')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Network"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.0/16"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("启动Flannel之后，需要依次重启docker、kubernete。")]),s._v(" "),e("p",[s._v("在master执行：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" flanneld.service \nsystemctl start flanneld.service \n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" docker restart\nsystemctl restart kube-apiserver.service\nsystemctl restart kube-controller-manager.service\nsystemctl restart kube-scheduler.service\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("在node上执行：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" flanneld.service \nsystemctl start flanneld.service \n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" docker restart\nsystemctl restart kubelet.service\nsystemctl restart kube-proxy.service\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h1",{attrs:{id:"安装kube-dns"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装kube-dns"}},[s._v("#")]),s._v(" 安装kube-dns")]),s._v(" "),e("p",[s._v("在master上安装")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl create -f https://raw.githubusercontent.com/koy1619/k8s_yaml/master/kubedns-rc.yaml\nkubectl create -f https://raw.githubusercontent.com/koy1619/k8s_yaml/master/kubedns-svc.yaml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("修改各node节点上的/etc/kubernetes/kubelet配置文件，增加如下行：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBELET_ARGS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--cluster_dns=10.254.0.100 --cluster_domain=cluster.local"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("重启各节点：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl restart kubelet\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h1",{attrs:{id:"部署dashboard服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署dashboard服务"}},[s._v("#")]),s._v(" 部署dashboard服务")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl create -f https://raw.githubusercontent.com/koy1619/k8s_yaml/master/dashboard-controller.yaml\nkubectl create -f https://raw.githubusercontent.com/koy1619/k8s_yaml/master/dashboard-service.yaml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h1",{attrs:{id:"master上面查看pod"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#master上面查看pod"}},[s._v("#")]),s._v(" master上面查看pod")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl get pod  -o wide  --all-namespaces\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h1",{attrs:{id:"dashboard访问"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#dashboard访问"}},[s._v("#")]),s._v(" dashboard访问")]),s._v(" "),e("p",[s._v("http://10.1.1.100:8080/ui")]),s._v(" "),e("p",[s._v("some exception ...")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl describe pods kubernetes-dashboard-1607234690-3bnk2 --namespace=kube-system")]),s._v("\n\n  1s    1s    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("kubelet k8s-node2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("           Warning   FailedSync  Error syncing pod, skipping: failed to "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"StartContainer"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes-dashboard"')]),s._v(" with CrashLoopBackOff: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Back-off 10s restarting failed container=kubernetes-dashboard pod=kubernetes-dashboard-980055440-l9zl5_kube-system(870d02e1-7810-11e7-9517-000c296a54e8)"')]),s._v("\n  \n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("解决方案"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim kubenetes-dashboard.yaml")]),s._v("\n- --apiserver改成ip，不要使用域名\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("访问kubernetes dashboard UI报错\nError: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dial tcp 10.0.66.2:9090: getsockopt: connection timed out'")]),s._v("\nTrying to reach: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://10.0.66.2:9090/'")]),s._v("\n\n原因是master节点和node节点flannel 的网络通信有问题\n解决方法： \n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".检查flannel配置；依次重启master和node节点flannel\nsystemctl restart flanneld\n在重建\nkubectl create -f dashboard-controller.yaml\nkubectl create -f dashboard-service.yaml\n\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".检查iptables -L -n ，检查node节点上的FORWARD 查看转发是否是drop，如果是drop，则开启\niptables -P FORWARD ACCEPT\n在master可以curl通 http://10.0.66.2:9090\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("p",[s._v("以下为参考资料")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("https://www.cnblogs.com/zhenyuyaodidiao/p/6500897.html\nhttps://blog.csdn.net/bbwangj/article/details/81701300\nhttps://andrewpqc.github.io/2018/04/23/setup-kubernetes-cluster-with-kubeadm/\nhttps://andrewpqc.github.io/2018/04/24/setup-k8s-dashboard-on-cluster/\nhttps://www.cnblogs.com/djhull/archive/2016/12/02/6125130.html\nhttps://blog.csdn.net/xts_huangxin/article/details/51130223\nhttps://blog.csdn.net/weixin_34054866/article/details/87525597\n\nhttps://blog.csdn.net/wt334502157/article/details/83992120\nhttps://www.cnblogs.com/allcloud/p/7614123.html\nhttps://hub.docker.com\nhttps://my.oschina.net/u/2539854/blog/3023384\nhttps://www.cnblogs.com/lion.net/p/10408510.html\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("p",[s._v("常用命令备忘")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl create -f kubedns-rc.yaml\nkubectl create -f kubedns-svc.yaml\nkubectl create -f dashboard-controller.yaml\nkubectl create -f dashboard-service.yaml\n\nkubectl delete -f dashboard-controller.yaml\nkubectl delete -f dashboard-service.yaml\nkubectl delete -f kubedns-rc.yaml\nkubectl delete -f kubedns-svc.yaml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubectl -s http://k8s-master:8080 get node\nkubectl get pods --namespace kube-system\nkubectl get pod  -o wide  --all-namespaces\nkubectl describe pod kube-dns-598252076-hks4w --namespace"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kube-system\nkubectl logs -f kubernetes-dashboard-2106745705-zz1qp -n kube-system\nkubectl logs -f kube-dns-2842662617-65n8h -n kube-system -c kubedns\nkubectl logs -f kube-dns-2842662617-65n8h -n kube-system -c dnsmasq-metrics\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#master删除节点")]),s._v("\nkubectl delete node node2\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#看日志")]),s._v("\nkubectl logs -f kubernetes-dashboard-2891849301-9g3hb -n kube-system\nkubectl logs -f kube-dns-3298054597-lk7gf -n kube-system -c kubedns\nkubectl logs -f kube-dns-2842662617-w7t5q -n kube-system -c dnsmasq-metrics\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#登陆docker实例")]),s._v("\nkubectl get pods\nkubectl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it nginx-3873632884-zhfzt -- /bin/bash\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);