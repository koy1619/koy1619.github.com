(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{393:function(s,e,a){"use strict";a.r(e);var n=a(2),t=Object(n.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("手动部署的k8s集群, 需要为master节点手动设置taints")]),s._v(" "),a("p",[s._v("设置taint")]),s._v(" "),a("p",[s._v("语法:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl taint node "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("effect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("   \n     其中"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("effect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" 可取值: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" NoSchedule "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" PreferNoSchedule "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NoExecute "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      NoSchedule: 一定不能被调度\n      PreferNoSchedule: 尽量不要调度\n      NoExecute: 不仅不会调度, 还会驱逐Node上已有的Pod\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("示例:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl taint node node1 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("key1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("value1:NoSchedule\nkubectl taint node node1 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("key1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("value1:NoExecute\nkubectl taint node node1 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("key2")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("value2:NoSchedule\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("查看taint：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl describe node node1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("删除taint:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl taint node node1 key1:NoSchedule-  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里的key可以不用指定value")]),s._v("\nkubectl taint node node1 key1:NoExecute-\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl taint node node1 key1-  删除指定key所有的effect")]),s._v("\nkubectl taint node node1 key2:NoSchedule-\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("master节点设置taint")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl taint nodes master1 node-role.kubernetes.io/master"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(":NoSchedule\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"custom-block warning"},[a("p",[s._v("注意⚠️ : 为master设置的这个taint中, node-role.kubernetes.io/master为key, value为空, effect为NoSchedule")])]),s._v(" "),a("p",[s._v("如果输入命令时, 你丢掉了=符号, 写成了node-role.kubernetes.io/master:NoSchedule, 会报error: at least one taint update is required错误")]),s._v(" "),a("p",[s._v("容忍tolerations主节点的taints")]),s._v(" "),a("p",[s._v("以上面为 master1 设置的 taints 为例, 你需要为你的 yaml 文件中添加如下配置, 才能容忍 master 节点的污点")]),s._v(" "),a("p",[s._v("在 pod 的 spec 中设置 tolerations 字段")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('tolerations:\n- key: "node-role.kubernetes.io/master"\n  operator: "Equal"\n  value: ""\n  effect: "NoSchedule"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("hr"),s._v(" "),a("p",[s._v("####补充####")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置集群标签和污点")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意:由于我们master节点也安装了kubelet")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#此时不容易发现那个节点是master，那个节点是node，可以给节点设置一个角色标签")]),s._v("\n\n\n$ kubectl label node "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.29")]),s._v(".202.145 node-role.kubernetes.io/master"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n$ kubectl label node "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.29")]),s._v(".202.151 node-role.kubernetes.io/master"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n$ kubectl label node "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.29")]),s._v(".202.155 node-role.kubernetes.io/master"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n$ kubectl label node "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.29")]),s._v(".202.159 node-role.kubernetes.io/node"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看集群节点状态")]),s._v("\n$ kubectl  get nodes\nNAME             STATUS   ROLES    AGE    VERSION\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.29")]),s._v(".202.145   Ready    master   14h    v1.16.0\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.29")]),s._v(".202.151   Ready    master   14h    v1.16.0\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.29")]),s._v(".202.155   Ready    master   14h    v1.16.0\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.29")]),s._v(".202.159   Ready    node     7m7s   v1.16.0\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置污点，不允许k8s调度pod到master节点")]),s._v("\n$ kubectl taint nodes "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.29")]),s._v(".202.145 node-role.kubernetes.io/master"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(":NoSchedule\n$ kubectl taint nodes "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.29")]),s._v(".202.151 node-role.kubernetes.io/master"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(":NoSchedule\n$ kubectl taint nodes "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.29")]),s._v(".202.155 node-role.kubernetes.io/master"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(":NoSchedule\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 此时正常的业务容器不会调度到master节点上")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 给pod配置容忍")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" pod.yml\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\ntolerations:\n- key: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node-role.kubernetes.io/master"')]),s._v("\n  operator: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Equal"')]),s._v("\n  value: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n  effect: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NoSchedule"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#或者")]),s._v("\ntolerations:\n- key: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node-role.kubernetes.io/master"')]),s._v("\n  operator: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Exists"')]),s._v("\n  effect: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NoSchedule"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意:理解Taints,Tolerations和Affinity")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Taints 和 Node affinity 是对立的概念，用来允许一个 node 拒绝某一类 pods")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Taints 和 tolerations 配合起来可以保证 pods 不会被调度到不合适的 nodes 上干活")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#一个 node 上可以有多个 taints")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将tolerations 应用到 pods 来允许被调度到合适的 nodes 上干活")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br")])]),a("p",[s._v("参考官方手册")]),s._v(" "),a("p",[s._v("https://kubernetes.io/zh/docs/concepts/configuration/taint-and-toleration/")])])}),[],!1,null,null,null);e.default=t.exports}}]);