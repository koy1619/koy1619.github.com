<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta charset="utf-8">
<title>mysql双主主键冲突排查修复 - linux48</title>
<meta name="description" content="">
<meta name="author" content="">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1">
<link rel="stylesheet" href="assets/css/bulma.min.css">
<link rel="stylesheet" href="assets/css/app.css">
<!--[if lt IE 9]>
<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
<link rel="shortcut icon" href="">
</head>
<body>

<nav class="columns navbar">
  <div class="column logo is-3 is-offset-1">
    <a class="is-brand" href="index.html">
      linux48
    </a>
  </div>
</nav>

<div class="columns content">
  <div class="column is-2-desktop is-3-widescreen is-hidden-touch">
  </div>
  <div class="column article-container is-11-tablet is-8-desktop is-6-widescreen">
    <div class="breadcrumb-area"><a href="index.html" class="breadcrumb-item">Home</a><span class="breadcrumb-delimiter"> &gt; </span><a href="2015-07-22-Primary-key-conflicts.html" class="breadcrumb-item">mysql双主主键冲突排查修复</a></div>
    <h1 class="article-title">mysql双主主键冲突排查修复</h1>
    
  <p>作者：<a href="http://linux48.com" target="_blank">Chris</a></p>


    <div class="article">
      <h2 id="背景">背景 <a class="markdownIt-Anchor" href="#背景">#</a></h2>
<p>线上A和B互为主主，A为业务写库，B为读库</p>
<p>19号下午收到短信报警A的slave delay，果断VPN上去数据库查看到</p>
<pre><code>Last_SQL_Error: Error 'Duplicate entry '4960446' for key 'transaction_id'' on query. Default database
</code></pre>
<p>又是熟悉的主键冲突，但是这个时候不能让业务出现任何问题，就果断在A</p>
<!-- more -->
<pre class="hljs"><code>mysql&gt; STOP SLAVE;
mysql&gt; SET GLOBAL sql_slave_skip_counter = 1;
mysql&gt; START SLAVE;
</code></pre>
<p>经过2次重复的上述操作，同步OK了，然后根据这两条报错的主键ID在两台数据库查询发现都不一样，<br>
此时我清楚的知道已经有2条数据差异了，如果不及时处理早晚有一天被掩盖的问题会再次爆发出来。</p>
<p>后来经过一些列的排查之后知道问题所在了</p>
<p>因为7月2号晚上在B<code>alter</code>表的时候，导致B锁表，而A还在写入，并且正好在更新服务，导致数据的差异</p>
<p>查<code>general log</code>得知7月19号人为的在B上插入了两条<code>transaction_id=&quot;4960446&quot;</code>和<code>transaction_id=&quot;4960426&quot;</code>的记录和A的id冲突，导致A同步挂掉</p>
<p>因为A为业务写库，所以现在需要把A上这两条正确的数据插入到B，并在B上面删除错误的。</p>
<p>由于这个是自增的主键，所以还不好操作，下面大概就测试环境详细说明一下复现方案以及解决办法。</p>
<hr>
<h2 id="复现方案">复现方案 <a class="markdownIt-Anchor" href="#复现方案">#</a></h2>
<blockquote>
<ul>
<li>192.168.1.52  模拟线上A 负责写入</li>
<li>192.168.1.42  模拟线上B 负责读取</li>
</ul>
</blockquote>
<h3 id="设置mycnf，差开自增id">设置my.cnf，差开自增ID <a class="markdownIt-Anchor" href="#设置mycnf，差开自增id">#</a></h3>
<p>52配置</p>
<pre><code>auto-increment-increment=10
auto-increment-offset=8
</code></pre>
<p>42配置</p>
<pre><code>auto-increment-increment=10
auto-increment-offset=6
</code></pre>
<h3 id="创建测试表">创建测试表 <a class="markdownIt-Anchor" href="#创建测试表">#</a></h3>
<p>随便在其中一台的test库中创建测试表，双主自动同步到另一台</p>
<pre class="hljs"><code><span class="hljs-keyword">use</span> <span class="hljs-keyword">test</span>;

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`test`</span> (
  <span class="hljs-string">`qrpay_id`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'主键'</span>,
  <span class="hljs-string">`transaction_id`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span>,
  PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`qrpay_id`</span>),
  <span class="hljs-keyword">UNIQUE</span> <span class="hljs-keyword">KEY</span> <span class="hljs-string">`transaction_id`</span> (<span class="hljs-string">`transaction_id`</span>) <span class="hljs-keyword">USING</span> BTREE
) <span class="hljs-keyword">ENGINE</span>=<span class="hljs-keyword">InnoDB</span> AUTO_INCREMENT=<span class="hljs-number">896</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CHARSET</span>=utf8;
</code></pre>
<h3 id="插入测试数据">插入测试数据 <a class="markdownIt-Anchor" href="#插入测试数据">#</a></h3>
<p>在52插入测试数据，可以发现&quot;qrpay_id&quot;的值是依照 auto-increment-offset 格式的, 同步过去也是如此</p>
<pre class="hljs"><code>INSERT INTO `<span class="hljs-built_in">test</span>` VALUES (<span class="hljs-string">'null'</span>,<span class="hljs-string">'1'</span>);
INSERT INTO `<span class="hljs-built_in">test</span>` VALUES (<span class="hljs-string">'null'</span>,<span class="hljs-string">'2'</span>);
INSERT INTO `<span class="hljs-built_in">test</span>` VALUES (<span class="hljs-string">'null'</span>,<span class="hljs-string">'3'</span>);
</code></pre>
<p>在42插入测试数据，可以发现&quot;qrpay_id&quot;的值是依照 auto-increment-offset 格式的, 同步过去也是如此</p>
<pre class="hljs"><code>INSERT INTO `<span class="hljs-built_in">test</span>` VALUES (<span class="hljs-string">'null'</span>,<span class="hljs-string">'4'</span>);
INSERT INTO `<span class="hljs-built_in">test</span>` VALUES (<span class="hljs-string">'null'</span>,<span class="hljs-string">'5'</span>);
INSERT INTO `<span class="hljs-built_in">test</span>` VALUES (<span class="hljs-string">'null'</span>,<span class="hljs-string">'6'</span>);
</code></pre>
<h3 id="模拟同步异常">模拟同步异常 <a class="markdownIt-Anchor" href="#模拟同步异常">#</a></h3>
<p>停掉42的同步</p>
<pre><code>slave stop;
</code></pre>
<p>并在52上插入数据</p>
<pre><code>INSERT INTO `test` VALUES ('null','7');
</code></pre>
<p>在42上插入数据</p>
<pre><code>INSERT INTO `test` VALUES ('null','7');
</code></pre>
<p>开启42的同步</p>
<pre><code>slave start;
</code></pre>
<p>在两边都show slave status \G; 可以发现都提示</p>
<pre><code>Error 'Duplicate entry '7' for key 'transaction_id'' on query. Default database: 'test'. Query: 'INSERT INTO `test` VALUES ('null','7')'
</code></pre>
<p>因为停掉了42的同步，所以插入到52的数据不会同步到42，并且也在42上面插入了相同值的transaction_id，同步到52的时候就导致了主键重复，最后开启42的同步，双方都互相冲突</p>
<p>这个时候两边主从都是挂掉的，然后两边都跳过这个错误</p>
<pre><code>stop slave;
set global sql_slave_skip_counter=1;
slave start;
</code></pre>
<p>再show slave status \G;查看正常</p>
<h3 id="模拟数据差异1">模拟数据差异1 <a class="markdownIt-Anchor" href="#模拟数据差异1">#</a></h3>
<p>在42上面删掉transaction_id刚才冲突的那条transaction_id='7'的记录,按照qrpay_id找</p>
<pre><code>delete from test where qrpay_id='1166';
</code></pre>
<p>继续在52写入测试数据</p>
<pre class="hljs"><code>INSERT INTO `<span class="hljs-built_in">test</span>` VALUES (<span class="hljs-string">'null'</span>,<span class="hljs-string">'8'</span>);
INSERT INTO `<span class="hljs-built_in">test</span>` VALUES (<span class="hljs-string">'null'</span>,<span class="hljs-string">'9'</span>);
INSERT INTO `<span class="hljs-built_in">test</span>` VALUES (<span class="hljs-string">'null'</span>,<span class="hljs-string">'10'</span>);
</code></pre>
<p>这个时候52上面比42的多了一条transaction_id='7'的记录</p>
<p>以上目地是模拟出真实数据库A比B多数据的场景</p>
<h3 id="修复同步">修复同步 <a class="markdownIt-Anchor" href="#修复同步">#</a></h3>
<p>在42上插入数据</p>
<pre><code>INSERT INTO `test` VALUES ('null','7');
</code></pre>
<p>这时因为52上已有transaction_id='7'的记录的值导致52同步挂掉</p>
<p>只有52报</p>
<pre><code>Error 'Duplicate entry '7' for key 'transaction_id'' on query. Default database: 'test'. Query: 'INSERT INTO `test` VALUES ('null','7')'
</code></pre>
<p>在52上跳过错误</p>
<pre><code>stop slave;
set global sql_slave_skip_counter=1;
slave start;
</code></pre>
<p>再show slave status \G;查看正常</p>
<p>52继续插入数据</p>
<pre class="hljs"><code>INSERT INTO `<span class="hljs-built_in">test</span>` VALUES (<span class="hljs-string">'null'</span>,<span class="hljs-string">'11'</span>);
INSERT INTO `<span class="hljs-built_in">test</span>` VALUES (<span class="hljs-string">'null'</span>,<span class="hljs-string">'12'</span>);
INSERT INTO `<span class="hljs-built_in">test</span>` VALUES (<span class="hljs-string">'null'</span>,<span class="hljs-string">'13'</span>);
</code></pre>
<p>发现42也健康的同步过来了</p>
<h3 id="复现完毕">复现完毕 <a class="markdownIt-Anchor" href="#复现完毕">#</a></h3>
<p>数据差异为transaction_id='7'这条记录,需要修复</p>
<hr>
<h2 id="线上解决方案">线上解决方案 <a class="markdownIt-Anchor" href="#线上解决方案">#</a></h2>
<h3 id="备份线上数据表">备份线上数据表 <a class="markdownIt-Anchor" href="#备份线上数据表">#</a></h3>
<p>晚上12点过后备份A和B的<code>test</code>表（需要恢复的表，为了隐私这里用test代替）</p>
<p>还好这张表里只有100多万条数据，很快就备份出来了，要不然备份锁表就不能这样搞了</p>
<h3 id="导库到测试">导库到测试 <a class="markdownIt-Anchor" href="#导库到测试">#</a></h3>
<p>次日上班处理</p>
<p>停掉测试环境52，42双方的slave</p>
<p>线上A备份导入到52的test库，线上B备份导入到42的test库,两个库的input_date框在同一时间,并比对一下条数记录是否一致</p>
<pre class="hljs"><code>    delete from <span class="hljs-built_in">test</span> <span class="hljs-built_in">where</span> input_date &gt;= <span class="hljs-string">'2015-07-22 00:00:00'</span>
    select count(*) from <span class="hljs-built_in">test</span>
</code></pre>
<p>双方重新 记录<strong><code>show master status</code></strong>的值  并<strong><code>change master</code></strong></p>
<p>开启双方<code>slave</code>,这个时候双方的数据就有差异，而不会双向同步问题数据咯</p>
<h3 id="修复数据">修复数据 <a class="markdownIt-Anchor" href="#修复数据">#</a></h3>
<p>因为52和42是双主模式，具体正确数据以线上A导入到52的数据为准</p>
<p>在52上面执行下面命令，来检测数据的一致性</p>
<pre><code>pt-table-checksum --nocheck-replication-filters  --no-check-binlog-format  --replicate=test.checksums  --databases=test --tables=test  --host=localhost    --password=123456
</code></pre>
<pre class="hljs"><code>tip:
参数解释
--nocheck-replication-filters ：不检查复制过滤器，建议启用。后面可以用--databases来指定需要检查的数据库。
--no-check-binlog-format      : 不检查复制的binlog模式，要是binlog模式是ROW，则会报错。
--replicate-check-only :只显示不同步的信息。
--replicate=   ：把checksum的信息写入到指定表中，建议直接写到被检查的数据库当中。 
--databases=   ：指定需要被检查的数据库，多个则用逗号隔开。
--tables=      ：指定需要被检查的表，多个用逗号隔开
h=127.0.0.1    ：Master的地址
u=root         ：用户名
p=123456       ：密码
P=3306         ：端口


输出解释
TS            ：完成检查的时间。
ERRORS        ：检查时候发生错误和警告的数量。
DIFFS         ：差异的条数。当指定--no-replicate-check时，会一直为0，当指定--replicate-check-only会显示不同的信息。
ROWS          ：表的行数。
CHUNKS        ：被划分到表中的块的数目。
SKIPPED       ：由于错误或警告或过大，则跳过块的数目。
TIME          ：执行的时间。
TABLE         ：被检查的表名。
</code></pre>
<p>由于线上A和B已经存在差异，所以肯定DIFFS是一个非0的值</p>
<p>需要在42创建checksum用户供52使用</p>
<pre><code>grant SELECT, PROCESS, SUPER, REPLICATION SLAVE on *.* to checksum @'192.168.1.52' identified by '123456' ;
flush privileges;
</code></pre>
<p>在52执行下面命令，通过（--print）打印出需要修复数据的sql语句，然后记录下来，然后经过处理，手动的拿去线上B去行执行，让他们数据保持一致性</p>
<pre><code>pt-table-sync --replicate=test.checksums h=localhost,u=root,p=123456 h=192.168.1.42,u=checksum,p=123456 --print --charset=utf8
</code></pre>
<p>tip:为什么要print直接打印出来问题sql，这是因为pt-table-sync会重建数据，所以有一定的风险，最好提前备份好数据。如果仍然不放心，可以使用它提供的「print」选项，它会打印出相应的SQL，你可以审查一下到底执行了那些操作，然后通过手动执行来完成同步, <strong><code>--charset=utf8</code></strong>  这个参数是让打印出来的sql语句中的汉字正常显示，不然会是乱码。</p>
<pre><code>也可以通过(--execute)直接修复，但是建议千万不要这么做。
</code></pre>
<h2 id="附：">附： <a class="markdownIt-Anchor" href="#附：">#</a></h2>
<p>-----------------Percona Toolkit INSTALL-------------------------</p>
<pre class="hljs"><code>yum install perl-ExtUtils-CBuilder perl-ExtUtils-MakeMaker -y
yum perl-DBD-MySQL -y
yum perl-Time-HiRes -y
yum perl-TermReadKey -y
yum perl-DBI


wget https://www.percona.com/downloads/percona-toolkit/2.2.14/tarball/percona-toolkit-2.2.14.tar.gz

tar zxvf percona-toolkit-2.2.14.tar.gz 
<span class="hljs-built_in">cd</span> percona-toolkit-2.2.14
perl Makefile.PL PREFIX=/usr/<span class="hljs-built_in">local</span>/percona-toolkit
make
make install
<span class="hljs-built_in">echo</span> <span class="hljs-string">"PATH=<span class="hljs-variable">$PATH</span>:/usr/local/percona-toolkit"</span> &gt;&gt; /etc/profile
<span class="hljs-built_in">echo</span> <span class="hljs-string">"export PATH"</span> &gt;&gt; /etc/profile
<span class="hljs-built_in">source</span> /etc/profile
</code></pre>

      
    </div>
        
        <h2>您的评论</h2>
        <div id="disqus_thread"></div>
        <script>
          var disqus_config = function () {
            this.page.url = location.origin + location.pathname;
            this.page.identifier = location.pathname;
            if (this.page.identifier.substr(-11) === '/index.html') {
              this.page.identifier = this.page.identifier.substr(
                0,
                this.page.identifier.length - 10
              );
            }
          };

          (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');
            s.src = '//linux48.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
          })();
        </script>
      

    <div class="level article-bar is-mobile">
      <div class="level-item has-text-centered">
        <a title="previous page" class="previouse-article-link" href="2015-07-30-sql-concat.html"><span class="icon icon-previous" data-icon="previous"></span><span class="link-content">&laquo; Previous</span></a>
      </div>
      <div class="level-item has-text-centered">
        <a title="font size" class="link-item link-item-size">
          <span class="icon icon-size" data-icon="size"></span>
        </a>
      </div>
      <div class="level-item has-text-centered">
        <a title="table of content" class="link-item link-item-toc">
          <span class="icon icon-toc" data-icon="toc"></span>
        </a>
      </div>
      <div class="level-item has-text-centered">
        <a title="top" href="#">
          <span class="icon icon-up" data-icon="up"></span>
          <span class="link-content">⤊ Top</span>
        </a>
      </div>
      <div class="level-item has-text-centered">
        <a title="next page" class="next-article-link" href="2015-07-15-mysql-dual-master.html"><span class="icon icon-next" data-icon="next"></span><span class="link-content">Next &raquo;</span></a>
      </div>
    </div>
  </div>
  <div class="column is-2-widescreen is-hidden">
  </div>
</div>

<div class="columns foot">
  <div class="column is-3 is-offset-9 build-by">
    Build by <a href="https://github.com/ruanyf/loppo" target="_blank">Loppo</a> 0.5.1
  </div>
</div>

<div class="book-toc notification is-warning is-hidden">
  <h3>目录&nbsp;<span class="title-close"><a class="button is-danger"> Close </a></span></h3>
  <ul class="chapter-area"><li class="chapter-item "><a href="2017-05-24-redis-twemproxy.html">基于Twemproxy的Redis集群方案</a></li><li class="chapter-item "><a href="2017-02-28-zabbix-redis.html">zabbix使用自动发现规则自动化监控redis多实例</a></li><li class="chapter-item "><a href="2016-07-06-zabbix3.0-mail.html">zabbix 3.0邮件报警</a></li><li class="chapter-item "><a href="2016-06-30-hive-hdfs.html">hive整合hadoop通过flume+hue收集日志</a></li><li class="chapter-item "><a href="2016-05-27-mysql-duplicate-records.html">MySQL查询表内重复记录</a></li><li class="chapter-item "><a href="2016-05-24-free-ssl.html">Startssl免费SSL证书+Nginx搭建https</a></li><li class="chapter-item "><a href="2016-05-16-flume.html">flume+hdfs构建大数据</a></li><li class="chapter-item "><a href="2016-04-21-notepad.html">数据库维护文本编辑技巧记录</a></li><li class="chapter-item "><a href="2016-04-20-mysql-in-paixu.html">MySQL查询按IN的顺序输出结果</a></li><li class="chapter-item "><a href="2016-04-14-cisco-firewall-ha.html">CISCO ASA5520 HA 配置</a></li><li class="chapter-item "><a href="2016-04-09-centos7-config-bond.html">centos7配置bond和bond跨网段改IP</a></li><li class="chapter-item "><a href="2016-02-03-centos-install-bugzilla.html">CentOS下Nginx配置Perl运行Bugzilla</a></li><li class="chapter-item "><a href="2015-11-12-centos-install-maven.html">CentOS上搭建私有maven仓库</a></li><li class="chapter-item "><a href="2015-10-8-mysql-some-question.html">mysql You cant specify target table</a></li><li class="chapter-item "><a href="2015-10-30-mysql-row-usedisk.html">mysql中查看数据库中所有表的记录数</a></li><li class="chapter-item "><a href="2015-10-29-zabbix-proxy-install.html">zabbix的proxy端安装配置</a></li><li class="chapter-item "><a href="2015-10-28-zabbix-agent-install.html">zabbix的agent端安装配置</a></li><li class="chapter-item "><a href="2015-10-27-mysql-AVG-MIN-SUM.html">mysql求平均值、最小和总值</a></li><li class="chapter-item "><a href="2015-10-21-mysql-every-hour.html">mysql取每隔一小时数据</a></li><li class="chapter-item "><a href="2015-08-27-Write-through-back.html">阵列Cache写机制：Write-through与Write-back</a></li><li class="chapter-item "><a href="2015-08-03-win10-cisco-vpn-repair.html">Repair Cisco vpnclient on windows10</a></li><li class="chapter-item "><a href="2015-07-30-sql-concat.html">MYSQL在一个字段值前面加字符串</a></li><li class="chapter-item chapter-item-current"><a href="2015-07-22-Primary-key-conflicts.html">mysql双主主键冲突排查修复</a></li><li class="chapter-item "><a href="2015-07-15-mysql-dual-master.html">mysql双主互备设计搭建</a></li><li class="chapter-item "><a href="2015-07-07-svn-admin.html">CentOS6安装subversion 可视化管理工具iF.SVNAdmin</a></li><li class="chapter-item "><a href="2015-07-06-rhel-yum.html">Red Hat Enterprise Linux Server YUM配置</a></li><li class="chapter-item "><a href="2015-06-25-mysql-log.html">mysql全局日志开启</a></li><li class="chapter-item "><a href="2015-06-08-php-fpm-backlog.html">关于PHP-FPM的backlog</a></li><li class="chapter-item "><a href="2015-06-05-mysql-grant.html">MySQL的Grant赋权命令详解</a></li><li class="chapter-item "><a href="2015-06-03-bitnami-gitlab-port.html">bitnami版gitlab修改端口</a></li><li class="chapter-item "><a href="2015-03-13-awstats-install.html">awstats日志分析安装</a></li><li class="chapter-item "><a href="2015-03-07-h3c-vlan.html">H3C划分VLAN命令</a></li><li class="chapter-item "><a href="2015-03-05-redis-easy-install.html">Redis安装及主从配置</a></li><li class="chapter-item "><a href="2015-01-21-shadowsocks-python-node.html">shadowsocks的python和nodejs版搭建</a></li><li class="chapter-item "><a href="2015-01-07-ruby-Syntax-error-Invalid-GBK.html">ruby环境sass编译中文出现 Invalid GBK character</a></li><li class="chapter-item "><a href="2015-01-06-mysql-m-s-s.html">如何搭master-slave-slave</a></li><li class="chapter-item "><a href="2015-01-06-mysql5.1-ms.html">Mysql5.1主从服务设置</a></li><li class="chapter-item "><a href="2015-01-06-linux-rm-luanma.html">linux下删除乱码文件</a></li><li class="chapter-item "><a href="2014-12-17-SVNListParentPath.html">利用SVNListParentPath增加http浏览仓库根目录的功能</a></li><li class="chapter-item "><a href="2014-12-15-Chrome-css-failed.html">Chrome 浏览器加载 css Failed to load resource</a></li><li class="chapter-item "><a href="2014-12-04-centos-gitlab-yijian.html">centos gitlab一键安装备份恢复和迁移</a></li><li class="chapter-item "><a href="2014-12-02-linux-sar.html">linux sar命令</a></li><li class="chapter-item "><a href="2014-11-24-ruby-on-rails-err.html">ruby on rails 报错解决</a></li><li class="chapter-item "><a href="2014-11-18-awk-note.html">AWK统计随笔记录</a></li><li class="chapter-item "><a href="2014-11-12-svn-force-commit.html">SVN强制提交commit</a></li><li class="chapter-item "><a href="2014-11-12-rm-list-too-long.html">rm Argument list too long的解决办法</a></li><li class="chapter-item "><a href="2014-11-12-crontab-linux-lessthan.html">Crontab导致Linux的线程数枯竭</a></li><li class="chapter-item "><a href="2014-11-11-shell-ftp-uplod.html">用二句Shell命令实现FTP批量上传文件夹</a></li><li class="chapter-item "><a href="2014-11-10-redis-disk-memory-err.html">redis 写磁盘出错Cannot allocate memory</a></li><li class="chapter-item "><a href="2014-10-19-Jekyll_Variables.html">Jekyll目录结构与变量</a></li><li class="chapter-item "><a href="2014-10-19-git_common_command.html">Git 常用命令整理</a></li><li class="chapter-item "><a href="2014-10-18-windows_configuration_Jekyll.html">Windows平台配置Jekyll环境并与GitHub连接</a></li><li class="chapter-item "><a href="2014-08-21-centos-kvm-install.html">Redhat/CentOS系统KVM虚拟机安装过程详解</a></li><li class="chapter-item "><a href="2014-08-18-Sublime-add-youjian.html">将sublime text添加到右键菜单中</a></li><li class="chapter-item "><a href="2014-08-13-Sublime-python-build.html">Sublime Text 3设置python编译支持环境设置</a></li><li class="chapter-item "><a href="2014-08-11-shell-syntax-error.html">SHELL syntax error:unexpected end of file 提示错误</a></li><li class="chapter-item "><a href="2014-07-31-mysql-daxiaoxie.html">Windows下MySQL无法区分大小写解决方案</a></li><li class="chapter-item "><a href="2014-07-31-CentOS-NFS-mount.html">CentOS NFS的安装配置、启动及mount挂载方法</a></li><li class="chapter-item "><a href="2014-07-30-tencent-yun-repo.html">腾讯云的YUM repo</a></li><li class="chapter-item "><a href="2014-07-29-mysql-dump-all.html">Mysqldump参数大全</a></li><li class="chapter-item "><a href="2014-07-28-git-del-err-commit.html">git删除错误提交的commit</a></li><li class="chapter-item "><a href="2014-07-25-mysql-instet-other-table.html">MySql中把一个表的数据插入到另一个表中的实现</a></li><li class="chapter-item "><a href="2014-07-25-centos-install-ossec.html">centos安装ossec</a></li><li class="chapter-item "><a href="2014-07-24-phpmyadmin-error.html">访问phpmyadmin错误</a></li><li class="chapter-item "><a href="2014-07-13-black-apple.html">厚黑苹果售后</a></li><li class="chapter-item "><a href="2014-06-25-wordpress-google-css.html">wordpress引用google开放css加载不到解决方法</a></li><li class="chapter-item "><a href="2014-06-25-nginx-https.html">centos下nginx的https配置</a></li><li class="chapter-item "><a href="2014-05-30-rsync.html">rsync同步部署</a></li><li class="chapter-item "><a href="2014-05-15-saltstack1.html">使用saltstack批量管理服务器 （一）</a></li><li class="chapter-item "><a href="2014-04-18-msmtpmutt.html">msmtp+mutt 服务器批量发送邮件</a></li><li class="chapter-item "><a href="2014-04-14-zabbix-server-install.html">zabbix的server端安装配置</a></li><li class="chapter-item "><a href="2014-04-05-wordpress-them-only-one.html">wordpress后台主题只有一个解决方法</a></li><li class="chapter-item "><a href="2014-01-30-many-php-version.html">多版本php共存搭建</a></li><li class="chapter-item "><a href="2013-11-06-linux-memery-cat.html">linux查看内存相关命令</a></li><li class="chapter-item "><a href="2013-07-07-github-easy-install.html">github安装使用</a></li><li class="chapter-item "><a href="2013-06-30-localhost-127.0.0.1.html">localhost 与 127.0.0.1 的区别</a></li><li class="chapter-item "><a href="2013-06-15-rsync-del-hailiang.html">使用rsync删除海量文件</a></li><li class="chapter-item "><a href="2013-06-08-disk-data-recovery.html">记录一次服务器数据恢复</a></li><li class="chapter-item "><a href="2013-06-03-1nginx-502.html">记录一次nginx 502</a></li><li class="chapter-item "><a href="2013-06-02-linux-nohup.html">linux命令后台运行详解</a></li><li class="chapter-item "><a href="2013-06-01-disk-inode.html">深入理解磁盘inode</a></li><li class="chapter-item "><a href="2013-05-09-mysql-error-1064.html">MySQL错误ERROR 1064 (type=myisam出错)</a></li><li class="chapter-item "><a href="2013-01-04-centos-php-oracle.html">centos6.2下php支持oracle</a></li><li class="chapter-item "><a href="2012-12-27-oracle-startup-failure.html">oracle startup failure</a></li><li class="chapter-item "><a href="2012-12-27-oracle-startup.html">oracle startup 故障：ORA-00845: MEMORY_TARGET</a></li><li class="chapter-item "><a href="2012-12-27-ora-01102-cannot-mount-database-in-exclusive-mode.html">ORA-01102: cannot mount database in EXCLUSIVE mode</a></li><li class="chapter-item "><a href="2012-12-20-centos-install-oracle-11g.html">centos install oracle 11g</a></li><li class="chapter-item "><a href="2012-11-14-mysql-slow-log.html">Mysql慢查询设置</a></li><li class="chapter-item "><a href="2012-11-14-mysql-ms-error.html">MYSQL主从同步故障事件</a></li><li class="chapter-item "><a href="2012-08-10-python-mysqldb-install.html">CentOS下python-mysqldb安装事件</a></li><li class="chapter-item "><a href="2012-08-03-sqlite-source-upgrade.html">sqlite3源码升级事件</a></li><li class="chapter-item "><a href="2012-08-01-centos6-pythonsqlite3.html">centos6.2升级python后处理sqlite3库事件</a></li><li class="chapter-item "><a href="2012-07-30-mysql5-5-ms.html">mysql5.5版本主从搭建</a></li><li class="chapter-item "><a href="2012-07-18-repair-yum.html">误卸载python导致yum无法使用修复事件</a></li><li class="chapter-item "><a href="2012-07-18-reload-upgrade-python.html">Centos平滑升级python事件</a></li><li class="chapter-item "><a href="2012-07-18-nginx413.html">Nginx出现“413 Request Entity Too Large”错误解决方法</a></li><li class="chapter-item "><a href="2012-07-06-nginx-apache-mulu-bd.html">Nginx、Apache目录浏览功能</a></li><li class="chapter-item "><a href="2012-06-27-yum-lamp-tomcat.html">CentOS yum安装配置LAMP+tomcat</a></li><li class="chapter-item "><a href="2012-06-11-ios-jiangji.html">ios5.0.1降级4.3.3事件</a></li><li class="chapter-item "><a href="2012-05-17-ocr-Tesseract.html">OCR之Tesseract的linux下安装</a></li><li class="chapter-item "><a href="2012-05-04-memcached-easy-install.html">memcached简易安装</a></li><li class="chapter-item "><a href="2012-04-11-centos-install-snmp.html">centos下snmp客户端安装</a></li><li class="chapter-item "><a href="2012-03-13-iptables-shell.html">一篇很不错的iptables的shell</a></li><li class="chapter-item "><a href="2012-03-07-cisco-fudong-luyou.html">思科静态浮动路由配置</a></li><li class="chapter-item "><a href="hello-world.html">Hello World</a></li></ul>
</div>

<div class="progress-indicator"></div>

<!-- SCRIPTS -->
<script>
  var LOPPO = {};
  LOPPO.current_path = '2015-07-22-Primary-key-conflicts.md';
  LOPPO.relative_root_path = '';
  LOPPO.article_toc = "<ul class=\"markdownIt-TOC\">\n<li><a href=\"#%E8%83%8C%E6%99%AF\">背景</a></li>\n<li><a href=\"#%E5%A4%8D%E7%8E%B0%E6%96%B9%E6%A1%88\">复现方案</a>\n<ul>\n<li><a href=\"#%E8%AE%BE%E7%BD%AEmycnf%EF%BC%8C%E5%B7%AE%E5%BC%80%E8%87%AA%E5%A2%9Eid\">设置my.cnf，差开自增ID</a></li>\n<li><a href=\"#%E5%88%9B%E5%BB%BA%E6%B5%8B%E8%AF%95%E8%A1%A8\">创建测试表</a></li>\n<li><a href=\"#%E6%8F%92%E5%85%A5%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE\">插入测试数据</a></li>\n<li><a href=\"#%E6%A8%A1%E6%8B%9F%E5%90%8C%E6%AD%A5%E5%BC%82%E5%B8%B8\">模拟同步异常</a></li>\n<li><a href=\"#%E6%A8%A1%E6%8B%9F%E6%95%B0%E6%8D%AE%E5%B7%AE%E5%BC%821\">模拟数据差异1</a></li>\n<li><a href=\"#%E4%BF%AE%E5%A4%8D%E5%90%8C%E6%AD%A5\">修复同步</a></li>\n<li><a href=\"#%E5%A4%8D%E7%8E%B0%E5%AE%8C%E6%AF%95\">复现完毕</a></li>\n</ul>\n</li>\n<li><a href=\"#%E7%BA%BF%E4%B8%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88\">线上解决方案</a>\n<ul>\n<li><a href=\"#%E5%A4%87%E4%BB%BD%E7%BA%BF%E4%B8%8A%E6%95%B0%E6%8D%AE%E8%A1%A8\">备份线上数据表</a></li>\n<li><a href=\"#%E5%AF%BC%E5%BA%93%E5%88%B0%E6%B5%8B%E8%AF%95\">导库到测试</a></li>\n<li><a href=\"#%E4%BF%AE%E5%A4%8D%E6%95%B0%E6%8D%AE\">修复数据</a></li>\n</ul>\n</li>\n<li><a href=\"#%E9%99%84%EF%BC%9A\">附：</a></li>\n</ul>\n";
</script>
<script src="assets/js/app.js"></script>
</body>
</html>

