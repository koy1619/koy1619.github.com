<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta charset="utf-8">
<title>centos安装ossec - linux48</title>
<meta name="description" content="">
<meta name="author" content="">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1">
<link rel="stylesheet" href="assets/css/bulma.min.css">
<link rel="stylesheet" href="assets/css/app.css">
<!--[if lt IE 9]>
<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
<link rel="shortcut icon" href="">
</head>
<body>

<nav class="columns navbar">
  <div class="column logo is-3 is-offset-1">
    <a class="is-brand" href="index.html">
      linux48
    </a>
  </div>
</nav>

<div class="columns content">
  <div class="column is-2-desktop is-3-widescreen is-hidden-touch">
  </div>
  <div class="column article-container is-11-tablet is-8-desktop is-6-widescreen">
    <div class="breadcrumb-area"><a href="index.html" class="breadcrumb-item">Home</a><span class="breadcrumb-delimiter"> &gt; </span><a href="2014-07-25-centos-install-ossec.html" class="breadcrumb-item">centos安装ossec</a></div>
    <h1 class="article-title">centos安装ossec</h1>
    
  <p>作者：<a href="http://linux48.com" target="_blank">Chris</a></p>


    <div class="article">
      <p>OSSEC是一款由Trend Micro（趋势科技）开发的开源的基于主机的入侵检测系统，可以简称为HIDS。它具备日志分析，文件完整性检查，策略监控，rootkit检测，实时报警以及联动响应等功能。它支持多种操作系统：Linux、Windows、MacOS、Solaris、HP-UX、AIX。属于企业安全之利器。</p>
<p>详细的介绍和文档可以参考官网网站：</p>
<p><a href="http://www.ossec.net/" target="_blank" rel="noopener">http://www.ossec.net/</a></p>
<p>##<mark><mark><mark><mark><mark><mark><mark><mark>服务端安装</mark></mark></mark></mark></mark></mark></mark></mark></p>
<pre><code>计算机名：ossec-server.com
IP地址：10.10.16.1
</code></pre>
<p>###server端支持环境安装<!-- more --></p>
<p>首先我们安装需要用到的关联库和软件，由于我们最终是需要把日志导入到MySQL中进行分析，以及需要通过web程序对报警结果进行展示，同时需要把本机当做SMTP，所以需要在本机安装MySQL、Apache和sendmail服务。在当前的终端中执行如下命令：</p>
<pre><code>[root@ossec-server ~]# yum install wget gcc make mysql mysql-server mysql-devel httpd php php-mysql sendmail
启动httpd、mysql、sendmail服务
[root@ossec-server ~]# /etc/init.d/httpd start
[root@ossec-server ~]# /etc/init.d/mysqld start
[root@ossec-server ~]# /etc/init.d/sendmail start
</code></pre>
<p>下面创建数据库以方便我们下面的安装配置，连接到本机的MySQL，然后执行如下命令：</p>
<pre><code>[root@ossec-server ~]# mysql -uroot -p
mysql&gt; create database ossec;
mysql&gt; grant INSERT,SELECT,UPDATE,CREATE,DELETE,EXECUTE on ossec.* to ossec@localhost;
mysql&gt; set password for ossec@localhost=PASSWORD('ossec');
mysql&gt; flush privileges;
mysql&gt; exit
</code></pre>
<p>###安装OSSEC服务端程序</p>
<p>首先通过官网的链接下载当前的最新稳定版本 2.7 的服务端包，同时解压。</p>
<pre><code>[root@ossec-server ~]# wget http://www.ossec.net/files/ossec-hids-2.7.1.tar.gz
[root@ossec-server ~]# tar zxf ossec-hids-2.7.1.tar.gz
[root@ossec-server ~]# cd ossec-hids-2.7.1
</code></pre>
<p>为了使OSSEC支持MySQL，需要在安装前执行make setdb命令，如下</p>
<pre><code>[root@ossec-server ossec-hids-2.7.1]# cd src; make setdb; cd ..
</code></pre>
<p>看到如下的信息说明可以正常支持MySQL：</p>
<pre><code>Info: Compiled with MySQL support.
</code></pre>
<p>下面进入安装步骤，执行install.sh脚本，同时按照下面的信息进行填写：</p>
<pre class="hljs"><code>[root@ossec-server ossec-hids-2.7.1]<span class="hljs-comment"># sh install.sh </span>
<span class="hljs-built_in">which</span>: no host <span class="hljs-keyword">in</span> (/usr/<span class="hljs-built_in">local</span>/sbin:/usr/<span class="hljs-built_in">local</span>/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin:/usr/<span class="hljs-built_in">local</span>/mysql/bin:/usr/<span class="hljs-built_in">local</span>/jdk1.7.0_09//bin:/root/bin)

  ** Para instalação em português, escolha [br].
  ** 要使用中文进行安装, 请选择 [cn].
  ** Fur eine deutsche Installation wohlen Sie [de].
  ** Για εγκατάσταση στα Ελληνικά, επιλέξτε [el].
  ** For installation <span class="hljs-keyword">in</span> English, choose [en].
  ** Para instalar en Español , eliga [es].
  ** Pour une installation en français, choisissez [fr]
  ** A Magyar nyelvű telepítéshez válassza [hu].
  ** Per l<span class="hljs-string">'installazione in Italiano, scegli [it].
  ** 日本語でインストールします．選択して下さい．[jp].
  ** Voor installatie in het Nederlands, kies [nl].
  ** Aby instalować w języku Polskim, wybierz [pl].
  ** Для инструкций по установке на русском ,введите [ru].
  ** Za instalaciju na srpskom, izaberi [sr].
  ** Türkçe kurulum için seçin [tr].
  (en/br/cn/de/el/es/fr/hu/it/jp/nl/pl/ru/sr/tr) [en]: cn
which: no host in (/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin:/usr/local/mysql/bin:/usr/local/jdk1.7.0_09//bin:/root/bin)
 OSSEC HIDS v2.7.1 安装脚本 - http://www.ossec.net
 
 您将开始 OSSEC HIDS 的安装.
 请确认在您的机器上已经正确安装了 C 编译器.
 如果您有任何疑问或建议,请给 dcid@ossec.net (或 daniel.cid@gmail.com) 发邮件.
 
  - 系统类型: Linux ossec-server.com 2.6.32-431.el6.x86_64
  - 用户: root
  - 主机: ossec-server.com


  -- 按 ENTER 继续或 Ctrl-C 退出. --



1- 您希望哪一种安装 (server, agent, local or help)? server

  - 选择了 Server 类型的安装.

2- 正在初始化安装环境.

 - 请选择 OSSEC HIDS 的安装路径 [/usr/local/ossec]: /usr/local/ossec

    - OSSEC HIDS 将安装在  /usr/local/ossec .


3- 正在配置 OSSEC HIDS.

  3.1- 您希望收到e-mail告警吗? (y/n) [y]: y
   - 请输入您的 e-mail 地址? koy1619@linux.com
   - 请输入您的 SMTP 服务器IP或主机名 ? 127.0.0.1

  3.2- 您希望运行系统完整性检测模块吗? (y/n) [y]: y

   - 系统完整性检测模块将被部署.

  3.3- 您希望运行 rootkit检测吗? (y/n) [y]: y

   - rootkit检测将被部署.
       
  3.4- 关联响应允许您在分析已接收事件的基础上执行一个
       已定义的命令.
       例如,你可以阻止某个IP地址的访问或禁止某个用户的访问权限.
       更多的信息,您可以访问:
       http://www.ossec.net/en/manual.html#active-response
   - 您希望开启联动(active response)功能吗? (y/n) [y]: y


     - 关联响应已开启

   - 默认情况下, 我们开启了主机拒绝和防火墙拒绝两种响应.
     第一种情况将添加一个主机到 /etc/hosts.deny.
     第二种情况将在iptables(linux)或ipfilter(Solaris,
     FreeBSD 或 NetBSD）中拒绝该主机的访问.
   - 该功能可以用以阻止 SSHD 暴力攻击, 端口扫描和其他
     一些形式的攻击. 同样你也可以将他们添加到其他地方,
     例如将他们添加为 snort 的事件.

   - 您希望开启防火墙联动(firewall-drop)功能吗? (y/n) [y]: y

     - 防火墙联动(firewall-drop)当事件级别 &gt;= 6 时被启动

   - 联动功能默认的白名单是:
      - 10.10.16.1

   - 您希望添加更多的IP到白名单吗? (y/n)? [n]: n

  3.5- 您希望接收远程机器syslog吗 (port 514 udp)? (y/n) [y]: y

   - 远程机器syslog将被接收.

  3.6- 设置配置文件以分析一下日志:
    -- /var/log/messages
    -- /var/log/secure
    -- /var/log/maillog

                            
 -如果你希望监控其他文件, 只需要在配置文件ossec.conf中
  添加新的一项. 
  任何关于配置的疑问您都可以在 http://www.ossec.net 找到答案.


  --- 按 ENTER 以继续 ---
</span></code></pre>
<p>最后敲回车即可安装到<code>/usr/local/ossec</code>,注意上面的<code>email</code>地址和<code>白名单</code>后面可以在配置文件中修改。</p>
<p>###OSSEC服务端配置<br>
上面只是安装好了OSSEC服务端，下面则是为了配置服务端，使其工作正常。执行下面命令启用数据库支持：</p>
<pre><code>[root@ossec-server ossec-hids-2.7.1]# /usr/local/ossec/bin/ossec-control enable database
</code></pre>
<p>然后导入MySQL表结构到MySQL中：</p>
<pre><code>[root@ossec-server ossec-hids-2.7.1]# mysql -uossec -p ossec &lt; src/os_dbd/mysql.schema
</code></pre>
<p>修改配置文件的权限，否则会启动服务失败：</p>
<pre><code>[root@ossec-server ossec-hids-2.7.1]# chmod u+w /usr/local/ossec/etc/ossec.conf
</code></pre>
<p>然后编辑ossec.conf文件，在ossec_config中添加MySQL配置：</p>
<pre class="hljs"><code>  &lt;database_output&gt;
      &lt;hostname&gt;localhost&lt;/hostname&gt;
      &lt;username&gt;ossec&lt;/username&gt;
      &lt;password&gt;ossec&lt;/password&gt;
      &lt;database&gt;ossec&lt;/database&gt;
      &lt;<span class="hljs-built_in">type</span>&gt;mysql&lt;/<span class="hljs-built_in">type</span>&gt;
  &lt;/database_output&gt;
</code></pre>
<p>由于我们在前面的安装过程中支持接受远程机器的syslog，所以我们还需要对ossec.conf文件中的syslog部分进行配置，修改ossec.conf文件，按照下面的内容进行修改，把我们网段可以全添加进去：</p>
<pre class="hljs"><code>  &lt;remote&gt;
    &lt;connection&gt;syslog&lt;/connection&gt;
    &lt;allowed-ips&gt;10.10.16.0/24&lt;/allowed-ips&gt;
  &lt;/remote&gt;
</code></pre>
<p>然后添加我们需要监控的客户机的白名单IP地址</p>
<pre class="hljs"><code>  &lt;global&gt;
    &lt;white_list&gt;127.0.0.1&lt;/white_list&gt;
    &lt;white_list&gt;^localhost.localdomain$&lt;/white_list&gt;
    &lt;white_list&gt;10.10.16.2&lt;/white_list&gt;
    &lt;white_list&gt;10.10.16.3&lt;/white_list&gt;
    &lt;white_list&gt;10.10.16.4&lt;/white_list&gt;
    ...
  &lt;/global&gt;
</code></pre>
<p>如果有多个邮件的收件人需要添加</p>
<pre class="hljs"><code>  &lt;global&gt;
    &lt;email_notification&gt;yes&lt;/email_notification&gt;
    &lt;email_to&gt;koy@linux.com&lt;/email_to&gt;
    &lt;email_to&gt;koy2@linux.com&lt;/email_to&gt;
    &lt;email_to&gt;koy3@linux.com&lt;/email_to&gt;
    &lt;smtp_server&gt;127.0.0.1&lt;/smtp_server&gt;
    &lt;email_from&gt;ossecm@ossec-server.com&lt;/email_from&gt;
  &lt;/global&gt;
</code></pre>
<p>在服务器上添加客户端，执行如下命令，按照提示进行输：</p>
<pre class="hljs"><code>[root@ossec-server ossec-hids-2.7.1]<span class="hljs-comment"># /usr/local/ossec/bin/manage_agents </span>


****************************************
* OSSEC HIDS v2.7.1 Agent manager.     *
* The following options are available: *
****************************************
   (A)dd an agent (A).
   (E)xtract key <span class="hljs-keyword">for</span> an agent (E).
   (L)ist already added agents (L).
   (R)emove an agent (R).
   (Q)uit.
Choose your action: A,E,L,R or Q: A

- Adding a new agent (use <span class="hljs-string">'\q'</span> to <span class="hljs-built_in">return</span> to the main menu).
  Please provide the following:
   * A name <span class="hljs-keyword">for</span> the new agent: client1
   * The IP Address of the new agent: 10.10.16.2
   * An ID <span class="hljs-keyword">for</span> the new agent[001]: 001
Agent information:
   ID:001
   Name:client1
   IP Address:10.10.16.2

Confirm adding it?(y/n): y
Agent added.


****************************************
* OSSEC HIDS v2.7.1 Agent manager.     *
* The following options are available: *
****************************************
   (A)dd an agent (A).
   (E)xtract key <span class="hljs-keyword">for</span> an agent (E).
   (L)ist already added agents (L).
   (R)emove an agent (R).
   (Q)uit.
Choose your action: A,E,L,R or Q: 
</code></pre>
<p>添加完客户端之后，还需要生成密钥，选择E选项</p>
<pre class="hljs"><code>****************************************
* OSSEC HIDS v2.7.1 Agent manager.     *
* The following options are available: *
****************************************
   (A)dd an agent (A).
   (E)xtract key <span class="hljs-keyword">for</span> an agent (E).
   (L)ist already added agents (L).
   (R)emove an agent (R).
   (Q)uit.
Choose your action: A,E,L,R or Q: e

Available agents: 
   ID: 001, Name: client1, IP: 10.10.16.2
Provide the ID of the agent to extract the key (or <span class="hljs-string">'\q'</span> to quit): 001

Agent key information <span class="hljs-keyword">for</span> <span class="hljs-string">'001'</span> is: 
MDAyIGNsaWVudDEgMTAuMTAuMTYuMiA2MDQ3NTc4NDBmZWE4ZTkyZDcxYjk3ZGY4NmNmMzIyY2Y0OGIwNjRlMTE2NDM5Yzk2Y2JkMGEyMDllNTVmMGQ4

** Press ENTER to <span class="hljs-built_in">return</span> to the main menu.
</code></pre>
<p>到现在就可以启动我们的ossec服务端了。</p>
<pre><code>[root@ossec-server ossec-hids-2.7.1]# /usr/local/ossec/bin/ossec-control start
</code></pre>
<p>查看监听端口</p>
<pre class="hljs"><code>[root@ossec-server analogi-master]<span class="hljs-comment"># netstat -antup|grep ossec</span>
tcp        0      0 127.0.0.1:43425             127.0.0.1:3306              ESTABLISHED 1841/ossec-dbd      
udp        0      0 0.0.0.0:514                 0.0.0.0:*                               1865/ossec-remoted  
udp        0      0 0.0.0.0:1514                0.0.0.0:*                               1866/ossec-remoted  
[root@ossec-server analogi-master]<span class="hljs-comment"># </span>
</code></pre>
<p>如果开启iptables，则需要开放这2个UDP端口到client</p>
<p>##<mark><mark><mark><mark><mark><mark><mark><mark>客户端安装</mark></mark></mark></mark></mark></mark></mark></mark></p>
<pre><code>计算机名：client1.com
IP地址：10.10.16.2
</code></pre>
<p>客户端也需要安装gcc编译器</p>
<pre><code>[root@client1 ~]# yum -y install gcc
</code></pre>
<p>安装ossec客户端程序</p>
<pre class="hljs"><code>[root@client1 ossec-hids-2.7.1]<span class="hljs-comment"># sh install.sh </span>

  ** Para instalação em português, escolha [br].
  ** 要使用中文进行安装, 请选择 [cn].
  ** Fur eine deutsche Installation wohlen Sie [de].
  ** Για εγκατάσταση στα Ελληνικά, επιλέξτε [el].
  ** For installation <span class="hljs-keyword">in</span> English, choose [en].
  ** Para instalar en Español , eliga [es].
  ** Pour une installation en français, choisissez [fr]
  ** A Magyar nyelvű telepítéshez válassza [hu].
  ** Per l<span class="hljs-string">'installazione in Italiano, scegli [it].
  ** 日本語でインストールします．選択して下さい．[jp].
  ** Voor installatie in het Nederlands, kies [nl].
  ** Aby instalować w języku Polskim, wybierz [pl].
  ** Для инструкций по установке на русском ,введите [ru].
  ** Za instalaciju na srpskom, izaberi [sr].
  ** Türkçe kurulum için seçin [tr].
  (en/br/cn/de/el/es/fr/hu/it/jp/nl/pl/ru/sr/tr) [en]: cn
 OSSEC HIDS v2.7.1 安装脚本 - http://www.ossec.net
 
 您将开始 OSSEC HIDS 的安装.
 请确认在您的机器上已经正确安装了 C 编译器.
 如果您有任何疑问或建议,请给 dcid@ossec.net (或 daniel.cid@gmail.com) 发邮件.
 
  - 系统类型: Linux client1.com 2.6.32-279.el6.x86_64
  - 用户: root
  - 主机: client1.com


  -- 按 ENTER 继续或 Ctrl-C 退出. --



1- 您希望哪一种安装 (server, agent, local or help)? agent

  - 选择了 Agent(client) 类型的安装.

2- 正在初始化安装环境.

 - 请选择 OSSEC HIDS 的安装路径 [/usr/local/ossec]: /usr/local/ossec

    - OSSEC HIDS 将安装在  /usr/local/ossec .

3- 正在配置 OSSEC HIDS.

  3.1- 请输入 OSSEC HIDS 服务器的IP地址或主机名: 10.10.16.1

   - 添加服务器IP  10.10.16.1

  3.2- 您希望运行系统完整性检测模块吗? (y/n) [y]: y

   - 系统完整性检测模块将被部署.

  3.3- 您希望运行 rootkit检测吗? (y/n) [y]: y

   - rootkit检测将被部署.

  3.4 - 您希望开启联动(active response)功能吗? (y/n) [y]: y


  3.5- 设置配置文件以分析一下日志:
    -- /var/log/messages
    -- /var/log/secure
    -- /var/log/maillog

                            
 -如果你希望监控其他文件, 只需要在配置文件ossec.conf中
  添加新的一项. 
  任何关于配置的疑问您都可以在 http://www.ossec.net 找到答案.


  --- 按 ENTER 以继续 ---
</span></code></pre>
<p>敲玩回车即可完成安装，然后需要添加一下密钥，把刚才在server端生成的密钥复制下来</p>
<pre class="hljs"><code>[root@client1 ossec-hids-2.7.1]<span class="hljs-comment"># /usr/local/ossec/bin/manage_agents</span>


****************************************
* OSSEC HIDS v2.7.1 Agent manager.     *
* The following options are available: *
****************************************
   (I)mport key from the server (I).
   (Q)uit.
Choose your action: I or Q: i

* Provide the Key generated by the server.
* The best approach is to cut and paste it.
*** OBS: Do not include spaces or new lines.

Paste it here (or <span class="hljs-string">'\q'</span> to quit): MDAyIGNsaWVudDEgMTAuMTAuMTYuMiA2MDQ3NTc4NDBmZWE4ZTkyZDcxYjk3ZGY4NmNmMzIyY2Y0OGIwNjRlMTE2NDM5Yzk2Y2JkMGEyMDllNTVmMGQ4

Agent information:
   ID:001
   Name:client1
   IP Address:10.10.16.2

Confirm adding it?(y/n): y
Added.
** Press ENTER to <span class="hljs-built_in">return</span> to the main menu.



****************************************
* OSSEC HIDS v2.7.1 Agent manager.     *
* The following options are available: *
****************************************
   (I)mport key from the server (I).
   (Q)uit.
Choose your action: I or Q: 
</code></pre>
<p>这样即可完成client端安装，启动ossec服务</p>
<pre><code>[root@client1 ossec-hids-2.7.1]# /usr/local/ossec/bin/ossec-control start 
</code></pre>
<p>之后就可以收到服务器log更新的邮件了，但是这样子还不够，我们需要通过更加直观的方式统一集中式的查看服务器的log情况，这就需要安装web-gui</p>
<p>##<mark><mark><mark><mark><mark><mark><mark><mark>WEB-GUI安装</mark></mark></mark></mark></mark></mark></mark></mark><br>
ossec官方提供的ossec-wui    <a href="https://github.com/ossec/ossec-wui" target="_blank" rel="noopener">https://github.com/ossec/ossec-wui</a><br>
github开源analogi-master   <a href="https://github.com/ECSC/analogi/archive/master.zip" target="_blank" rel="noopener">https://github.com/ECSC/analogi/archive/master.zip</a></p>
<p>###ossec官方ossec-wui 安装方法<br>
下载解压之后放到apache的web目录，并加apache用户权限</p>
<pre><code>[root@ossec-server ossec-wui-master]# chown -R apache.apache /usr/local/httpd/htdocs/ossec-wui-master/
</code></pre>
<p>执行安装脚本</p>
<pre class="hljs"><code>[root@ossec-server ossec-wui-master]<span class="hljs-comment"># sh setup.sh </span>
Setting up ossec ui...

Username: root
New password: 
Re-type new password: 
Adding password <span class="hljs-keyword">for</span> user root
Enter your web server user name (e.g. apache, www, nobody, www-data, ...)
apache
sed：<span class="hljs-_">-e</span> 表达式 <span class="hljs-comment">#1，字符 22：未终止的“s”命令</span>
Enter your OSSEC install directory path (e.g. /var/ossec)
/usr/<span class="hljs-built_in">local</span>/ossec
You must restart your web server after this setup is done.

Setup completed successfuly.
</code></pre>
<p>修改配置文件中的ossec_dir路径</p>
<pre class="hljs"><code>[root@ossec-server ossec-wui-master]<span class="hljs-comment"># vim /usr/local/httpd/htdocs/ossec-wui-master/ossec_conf.php </span>
&lt;?php

/* OSSEC Configuration <span class="hljs-keyword">for</span> the UI. Make sure to <span class="hljs-built_in">set</span>
 * right ossec_dir <span class="hljs-keyword">in</span> here. If your server does not
 * have much memory available, reduce the max_alerts
 * variable to something smaller.
 */

/* Ossec directory */
<span class="hljs-variable">$ossec_dir</span>=<span class="hljs-string">"/usr/local/ossec"</span>;


/* Maximum alerts per page */
<span class="hljs-variable">$ossec_max_alerts_per_page</span> = 1000;


/* Default search values */
<span class="hljs-variable">$ossec_search_level</span> = 7;
<span class="hljs-variable">$ossec_search_time</span> = 14400;


/* Default refreshing time */
<span class="hljs-variable">$ossec_refresh_time</span> = 90;

?&gt;
</code></pre>
<p>修改<code>php.ini</code></p>
<pre><code> max_execution_time = 180
 max_input_time = 180
 memory_limit = 30M
</code></pre>
<p>重启web服务即可查看web界面</p>
<figure><img src="http://segmentfault.com/img/bVcKTN" alt=""></figure>
<p>###github开源analogi安装方法<br>
下载并解压放到web目录，只需要修改一下mysql的连接池就ok</p>
<pre class="hljs"><code>[root@ossec-server analogi-master]<span class="hljs-comment"># mv db_ossec.php.new db_ossec.php</span>
[root@ossec-server analogi-master]<span class="hljs-comment"># vim db_ossec.php</span>
&lt;?php
/*
 * Copyright (c) 2012 Andy <span class="hljs-string">'Rimmer'</span> Shepherd &lt;andrew.shepherd@ecsc.co.uk&gt; (ECSC Ltd).
 * This program is free software; Distributed under the terms of the GNU GPL v3.
 */

define (<span class="hljs-string">'DB_USER_O'</span>, <span class="hljs-string">'ossec'</span>);
define (<span class="hljs-string">'DB_PASSWORD_O'</span>, <span class="hljs-string">'ossec'</span>);
define (<span class="hljs-string">'DB_HOST_O'</span>, <span class="hljs-string">'localhost'</span>);
define (<span class="hljs-string">'DB_NAME_O'</span>, <span class="hljs-string">'ossec'</span>);

<span class="hljs-variable">$db_ossec</span> = mysql_connect (DB_HOST_O, DB_USER_O, DB_PASSWORD_O) OR die (<span class="hljs-string">'Could not connect to SQL : '</span> . mysql_error() . <span class="hljs-string">"&lt;br/&gt;Click &lt;a href='' onclick='document.cookie=\"ossecdbjs=;expires=Thu, 01 Jan 1970 00:00:00 GMT\"' &gt;HERE&lt;/a&gt; to s
elect your main OSSEC DB"</span>);

mysql_select_db (DB_NAME_O, <span class="hljs-variable">$db_ossec</span>) OR die (<span class="hljs-string">'Could not select the database : '</span> . mysql_error() . <span class="hljs-string">"&lt;br/&gt;Click &lt;a href='' onclick='document.cookie=\"ossecdbjs=;expires=Thu, 01 Jan 1970 00:00:00 GMT\"' &gt;HERE&lt;/a&gt; to select your main OSSE
C DB"</span>);

?&gt;
</code></pre>
<p>web预览<br>
<img src="http://segmentfault.com/img/bVcKTZ" alt="请输入图片描述"></p>
<p>###FAQ：<br>
发现无数据或者是看不到客户端，请查看<code>iptables</code>是否开放<code>udp</code>的<code>514</code>和<code>1514</code>端口并查看是否监听</p>
<p>web查看显示的时间不正确，可修改<code>php.ini</code>的date.timezone = Asia/Shanghai即可</p>
<p>sendmail邮件发不出，可修改查看主机名是否规范,需要检查以下地方,修改完毕重启sendmail即可</p>
<pre class="hljs"><code>[root@ossec-server analogi-master]<span class="hljs-comment"># cat /etc/hosts</span>
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
127.0.0.1 ossec-server.com
10.10.16.1 ossec-server.com
[root@ossec-server analogi-master]<span class="hljs-comment"># cat /etc/sysconfig/network</span>
NETWORKING=yes
HOSTNAME=ossec-server.com
[root@ossec-server analogi-master]<span class="hljs-comment"># hostname</span>
ossec-server.com
</code></pre>

      
    </div>
        
        <h2>您的评论</h2>
        <div id="disqus_thread"></div>
        <script>
          var disqus_config = function () {
            this.page.url = location.origin + location.pathname;
            this.page.identifier = location.pathname;
            if (this.page.identifier.substr(-11) === '/index.html') {
              this.page.identifier = this.page.identifier.substr(
                0,
                this.page.identifier.length - 10
              );
            }
          };

          (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');
            s.src = '//linux48.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
          })();
        </script>
      

    <div class="level article-bar is-mobile">
      <div class="level-item has-text-centered">
        <a title="previous page" class="previouse-article-link" href="2014-07-25-mysql-instet-other-table.html"><span class="icon icon-previous" data-icon="previous"></span><span class="link-content">&laquo; Previous</span></a>
      </div>
      <div class="level-item has-text-centered">
        <a title="font size" class="link-item link-item-size">
          <span class="icon icon-size" data-icon="size"></span>
        </a>
      </div>
      <div class="level-item has-text-centered">
        <a title="table of content" class="link-item link-item-toc">
          <span class="icon icon-toc" data-icon="toc"></span>
        </a>
      </div>
      <div class="level-item has-text-centered">
        <a title="top" href="#">
          <span class="icon icon-up" data-icon="up"></span>
          <span class="link-content">⤊ Top</span>
        </a>
      </div>
      <div class="level-item has-text-centered">
        <a title="next page" class="next-article-link" href="2014-07-24-phpmyadmin error.html"><span class="icon icon-next" data-icon="next"></span><span class="link-content">Next &raquo;</span></a>
      </div>
    </div>
  </div>
  <div class="column is-2-widescreen is-hidden">
  </div>
</div>

<div class="columns foot">
  <div class="column is-3 is-offset-9 build-by">
    Build by <a href="https://github.com/ruanyf/loppo" target="_blank">Loppo</a> 0.5.1
  </div>
</div>

<div class="book-toc notification is-warning is-hidden">
  <h3>目录&nbsp;<span class="title-close"><a class="button is-danger"> Close </a></span></h3>
  <ul class="chapter-area"><li class="chapter-item "><a href="2017-02-28-zabbix-redis.html">zabbix使用自动发现规则自动化监控redis多实例</a></li><li class="chapter-item "><a href="2016-07-06-zabbix3.0-mail.html">zabbix 3.0邮件报警</a></li><li class="chapter-item "><a href="2016-06-30-hive-hdfs.html">hive整合hadoop通过flume+hue收集日志</a></li><li class="chapter-item "><a href="2016-05-27-mysql-duplicate-records.html">MySQL查询表内重复记录</a></li><li class="chapter-item "><a href="2016-05-24-free-ssl.html">Startssl免费SSL证书+Nginx搭建https</a></li><li class="chapter-item "><a href="2016-05-16-flume.html">flume+hdfs构建大数据</a></li><li class="chapter-item "><a href="2016-04-21-notepad.html">数据库维护文本编辑技巧记录</a></li><li class="chapter-item "><a href="2016-04-20-mysql-in-paixu.html">MySQL查询按IN的顺序输出结果</a></li><li class="chapter-item "><a href="2016-04-14-cisco-firewall-ha.html">CISCO ASA5520 HA 配置</a></li><li class="chapter-item "><a href="2016-04-09-centos7-config-bond.html">centos7配置bond和bond跨网段改IP</a></li><li class="chapter-item "><a href="2016-02-03-centos-install-bugzilla.html">CentOS下Nginx配置Perl运行Bugzilla</a></li><li class="chapter-item "><a href="2015-11-12-centos-install-maven.html">CentOS上搭建私有maven仓库</a></li><li class="chapter-item "><a href="2015-10-8-mysql-some-question.html">mysql You cant specify target table</a></li><li class="chapter-item "><a href="2015-10-30-mysql-row-usedisk.html">mysql中查看数据库中所有表的记录数</a></li><li class="chapter-item "><a href="2015-10-29-zabbix-proxy-install.html">zabbix的proxy端安装配置</a></li><li class="chapter-item "><a href="2015-10-28-zabbix-agent-install.html">zabbix的agent端安装配置</a></li><li class="chapter-item "><a href="2015-10-27-mysql-AVG-MIN-SUM.html">mysql求平均值、最小和总值</a></li><li class="chapter-item "><a href="2015-10-21-mysql-every-hour.html">mysql取每隔一小时数据</a></li><li class="chapter-item "><a href="2015-08-27-Write-through-back.html">阵列Cache写机制：Write-through与Write-back</a></li><li class="chapter-item "><a href="2015-08-03-win10-cisco-vpn-repair.html">Repair Cisco vpnclient on windows10</a></li><li class="chapter-item "><a href="2015-07-30-sql-concat.html">MYSQL在一个字段值前面加字符串</a></li><li class="chapter-item "><a href="2015-07-22-Primary-key-conflicts.html">mysql双主主键冲突排查修复</a></li><li class="chapter-item "><a href="2015-07-15-mysql-dual-master.html">mysql双主互备设计搭建</a></li><li class="chapter-item "><a href="2015-07-07-svn-admin.html">CentOS6安装subversion 可视化管理工具iF.SVNAdmin</a></li><li class="chapter-item "><a href="2015-07-06-rhel-yum.html">Red Hat Enterprise Linux Server YUM配置</a></li><li class="chapter-item "><a href="2015-06-25-mysql-log.html">mysql全局日志开启</a></li><li class="chapter-item "><a href="2015-06-08-php-fpm-backlog.html">关于PHP-FPM的backlog</a></li><li class="chapter-item "><a href="2015-06-05-mysql-grant.html">MySQL的Grant赋权命令详解</a></li><li class="chapter-item "><a href="2015-06-03-bitnami-gitlab-port.html">bitnami版gitlab修改端口</a></li><li class="chapter-item "><a href="2015-03-13-awstats-install.html">awstats日志分析安装</a></li><li class="chapter-item "><a href="2015-03-07-h3c-vlan.html">H3C划分VLAN命令</a></li><li class="chapter-item "><a href="2015-03-05-redis-easy-install.html">Redis安装及主从配置</a></li><li class="chapter-item "><a href="2015-01-21-shadowsocks-python-node.html">shadowsocks的python和nodejs版搭建</a></li><li class="chapter-item "><a href="2015-01-07-ruby-Syntax-error-Invalid-GBK .html">ruby环境sass编译中文出现 Invalid GBK character</a></li><li class="chapter-item "><a href="2015-01-06-mysql-m-s-s.html">如何搭master-slave-slave</a></li><li class="chapter-item "><a href="2015-01-06-mysql5.1-ms.html">Mysql5.1主从服务设置</a></li><li class="chapter-item "><a href="2015-01-06-linux-rm-luanma.html">linux下删除乱码文件</a></li><li class="chapter-item "><a href="2014-12-17-SVNListParentPath.html">利用SVNListParentPath增加http浏览仓库根目录的功能</a></li><li class="chapter-item "><a href="2014-12-15-Chrome-css-failed.html">Chrome 浏览器加载 css Failed to load resource</a></li><li class="chapter-item "><a href="2014-12-04-centos-gitlab-yijian.html">centos gitlab一键安装备份恢复和迁移</a></li><li class="chapter-item "><a href="2014-12-02-linux-sar.html">linux sar命令</a></li><li class="chapter-item "><a href="2014-11-24-ruby-on-rails-err.html">ruby on rails 报错解决</a></li><li class="chapter-item "><a href="2014-11-18-awk-note.html">AWK统计随笔记录</a></li><li class="chapter-item "><a href="2014-11-12-svn-force-commit.html">SVN强制提交commit</a></li><li class="chapter-item "><a href="2014-11-12-rm-list-too-long.html">rm Argument list too long的解决办法</a></li><li class="chapter-item "><a href="2014-11-12-crontab-linux-lessthan.html">Crontab导致Linux的线程数枯竭</a></li><li class="chapter-item "><a href="2014-11-11-shell-ftp-uplod.html">用二句Shell命令实现FTP批量上传文件夹</a></li><li class="chapter-item "><a href="2014-11-10-redis-disk-memory-err.html">redis 写磁盘出错Cannot allocate memory</a></li><li class="chapter-item "><a href="2014-10-19-Jekyll_Variables.html">Jekyll目录结构与变量</a></li><li class="chapter-item "><a href="2014-10-19-git_common_command.html">Git 常用命令整理</a></li><li class="chapter-item "><a href="2014-10-18-windows_configuration_Jekyll.html">Windows平台配置Jekyll环境并与GitHub连接</a></li><li class="chapter-item "><a href="2014-08-21-centos-kvm-install.html">Redhat/CentOS系统KVM虚拟机安装过程详解</a></li><li class="chapter-item "><a href="2014-08-18-Sublime-add-youjian.html">将sublime text添加到右键菜单中</a></li><li class="chapter-item "><a href="2014-08-13-Sublime-python-build.html">Sublime Text 3设置python编译支持环境设置</a></li><li class="chapter-item "><a href="2014-08-11-shell-syntax-error.html">SHELL syntax error:unexpected end of file 提示错误</a></li><li class="chapter-item "><a href="2014-07-31-mysql-daxiaoxie.html">Windows下MySQL无法区分大小写解决方案</a></li><li class="chapter-item "><a href="2014-07-31-CentOS-NFS-mount.html">CentOS NFS的安装配置、启动及mount挂载方法</a></li><li class="chapter-item "><a href="2014-07-30-tencent-yun-repo.html">腾讯云的YUM repo</a></li><li class="chapter-item "><a href="2014-07-29-mysql-dump-all.html">Mysqldump参数大全</a></li><li class="chapter-item "><a href="2014-07-28-git-del-err-commit.html">git删除错误提交的commit</a></li><li class="chapter-item "><a href="2014-07-25-mysql-instet-other-table.html">MySql中把一个表的数据插入到另一个表中的实现</a></li><li class="chapter-item chapter-item-current"><a href="2014-07-25-centos-install-ossec.html">centos安装ossec</a></li><li class="chapter-item "><a href="2014-07-24-phpmyadmin error.html">访问phpmyadmin错误</a></li><li class="chapter-item "><a href="2014-07-13-black apple.html">厚黑苹果售后</a></li><li class="chapter-item "><a href="2014-06-25-wordpress google css.html">wordpress引用google开放css加载不到解决方法</a></li><li class="chapter-item "><a href="2014-06-25-nginx https.html">centos下nginx的https配置</a></li><li class="chapter-item "><a href="2014-05-30-rsync.html">rsync同步部署</a></li><li class="chapter-item "><a href="2014-05-15-saltstack1.html">使用saltstack批量管理服务器 （一）</a></li><li class="chapter-item "><a href="2014-04-18-msmtpmutt.html">msmtp+mutt 服务器批量发送邮件</a></li><li class="chapter-item "><a href="2014-04-14-zabbix server install.html">zabbix的server端安装配置</a></li><li class="chapter-item "><a href="2014-04-05-wordpress them only one.html">wordpress后台主题只有一个解决方法</a></li><li class="chapter-item "><a href="2014-01-30-many-php-version.html">多版本php共存搭建</a></li><li class="chapter-item "><a href="2013-11-06-linux memery cat.html">linux查看内存相关命令</a></li><li class="chapter-item "><a href="2013-07-07-github easy install.html">github安装使用</a></li><li class="chapter-item "><a href="2013-06-30-localhost-127.0.0.1.html">localhost 与 127.0.0.1 的区别</a></li><li class="chapter-item "><a href="2013-06-15-rsync del hailiang.html">使用rsync删除海量文件</a></li><li class="chapter-item "><a href="2013-06-08-disk-data-recovery.html">记录一次服务器数据恢复</a></li><li class="chapter-item "><a href="2013-06-03-1nginx-502.html">记录一次nginx 502</a></li><li class="chapter-item "><a href="2013-06-02-linux nohup.html">linux命令后台运行详解</a></li><li class="chapter-item "><a href="2013-06-01-disk inode.html">深入理解磁盘inode</a></li><li class="chapter-item "><a href="2013-05-09-mysql error 1064.html">MySQL错误ERROR 1064 (type=myisam出错)</a></li><li class="chapter-item "><a href="2013-01-04-centos php oracle.html">centos6.2下php支持oracle</a></li><li class="chapter-item "><a href="2012-12-27-oracle-startup-failure.html">oracle startup failure</a></li><li class="chapter-item "><a href="2012-12-27-oracle-startup.html">'oracle startup 故障：ORA-00845: MEMORY_TARGET'</a></li><li class="chapter-item "><a href="2012-12-27-ora-01102-cannot-mount-database-in-exclusive-mode.html">'ORA-01102: cannot mount database in EXCLUSIVE mode'</a></li><li class="chapter-item "><a href="2012-12-20-centos-install-oracle-11g.html">centos install oracle 11g</a></li><li class="chapter-item "><a href="2012-11-14-mysql-slow-log.html">Mysql慢查询设置</a></li><li class="chapter-item "><a href="2012-11-14-mysql-ms-error.html">MYSQL主从同步故障事件</a></li><li class="chapter-item "><a href="2012-08-10-python-mysqldb-install.html">CentOS下python-mysqldb安装事件</a></li><li class="chapter-item "><a href="2012-08-03-sqlite-source-upgrade.html">sqlite3源码升级事件</a></li><li class="chapter-item "><a href="2012-08-01-centos6-pythonsqlite3.html">centos6.2升级python后处理sqlite3库事件</a></li><li class="chapter-item "><a href="2012-07-30-mysql5-5-ms.html">mysql5.5版本主从搭建</a></li><li class="chapter-item "><a href="2012-07-18-repair-yum.html">误卸载python导致yum无法使用修复事件</a></li><li class="chapter-item "><a href="2012-07-18-reload-upgrade-python.html">Centos平滑升级python事件</a></li><li class="chapter-item "><a href="2012-07-18-nginx413.html">Nginx出现“413 Request Entity Too Large”错误解决方法</a></li><li class="chapter-item "><a href="2012-07-06-nginx-apache-mulu-bd.html">Nginx、Apache目录浏览功能</a></li><li class="chapter-item "><a href="2012-06-27-yum-lamp-tomcat.html">CentOS yum安装配置LAMP+tomcat</a></li><li class="chapter-item "><a href="2012-06-11-ios-jiangji.html">ios5.0.1降级4.3.3事件</a></li><li class="chapter-item "><a href="2012-05-17-ocr-Tesseract.html">OCR之Tesseract的linux下安装</a></li><li class="chapter-item "><a href="2012-05-04-memcached-easy-install.html">memcached简易安装</a></li><li class="chapter-item "><a href="2012-04-11-centos-install-snmp.html">centos下snmp客户端安装</a></li><li class="chapter-item "><a href="2012-03-13-iptables-shell.html">一篇很不错的iptables的shell</a></li><li class="chapter-item "><a href="2012-03-07-cisco-fudong-luyou.html">思科静态浮动路由配置</a></li><li class="chapter-item "><a href="hello-world.html">Hello World</a></li></ul>
</div>

<div class="progress-indicator"></div>

<!-- SCRIPTS -->
<script>
  var LOPPO = {};
  LOPPO.current_path = '2014-07-25-centos-install-ossec.md';
  LOPPO.relative_root_path = '';
  LOPPO.article_toc = "";
</script>
<script src="assets/js/app.js"></script>
</body>
</html>

