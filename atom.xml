<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[linux48]]></title>
  
  <link href="/atom.xml" rel="self"/>
  <link href="http://linux48.com/"/>
  <updated>2017-02-28T03:35:19.000Z</updated>
  <id>http://linux48.com/</id>
  
  <author>
    <name><![CDATA[koy]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[zabbix使用自动发现规则自动化监控redis多实例]]></title>
    <link href="http://linux48.com//archives/454/"/>
    <id>http://linux48.com//archives/454/</id>
    <published>2017-02-27T16:00:00.000Z</published>
    <updated>2017-02-28T03:35:19.000Z</updated>
    <content type="html"><![CDATA[<p>zabbix使用自动发现规则自动化监控redis多实例，废话不多说，直接撸代码。</p>
<h1 id="zabbix-agent">zabbix-agent</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/<span class="built_in">local</span>/zabbix-agent/redis.sh</span><br><span class="line"></span><br><span class="line"><span class="shebang">#!/bin/bash</span><br><span class="line"></span></span><br><span class="line"><span class="function"><span class="title">redis</span></span>() &#123;</span><br><span class="line">            port=($(sudo netstat -tpln | awk -F <span class="string">"[ :]+"</span> <span class="string">'/redis/ &amp;&amp; /0.0.0.0/ &#123;print $5&#125;'</span>))</span><br><span class="line">            <span class="built_in">printf</span> <span class="string">'&#123;\n'</span></span><br><span class="line">            <span class="built_in">printf</span> <span class="string">'\t"data":[\n'</span></span><br><span class="line">               <span class="keyword">for</span> key <span class="keyword">in</span> <span class="variable">$&#123;!port[@]&#125;</span></span><br><span class="line">                   <span class="keyword">do</span></span><br><span class="line">                       <span class="keyword">if</span> [[ <span class="string">"<span class="variable">$&#123;#port[@]&#125;</span>"</span> <span class="operator">-gt</span> <span class="number">1</span> &amp;&amp; <span class="string">"<span class="variable">$&#123;key&#125;</span>"</span> <span class="operator">-ne</span> <span class="string">"<span class="variable">$(($&#123;#port[@]&#125;-1)</span>)"</span> ]];<span class="keyword">then</span></span><br><span class="line">              socket=`ps aux|grep <span class="variable">$&#123;port[$&#123;key&#125;</span>]&#125;|grep -v grep|awk -F <span class="string">'='</span> <span class="string">'&#123;print $10&#125;'</span>|cut <span class="operator">-d</span> <span class="string">' '</span> <span class="operator">-f</span> <span class="number">1</span>`</span><br><span class="line">                          <span class="built_in">printf</span> <span class="string">'\t &#123;\n'</span></span><br><span class="line">                          <span class="built_in">printf</span> <span class="string">"\t\t\t\"&#123;#REDISPORT&#125;\":\"<span class="variable">$&#123;port[$&#123;key&#125;</span>]&#125;\"&#125;,\n"</span></span><br><span class="line">                     <span class="keyword">else</span> [[ <span class="string">"<span class="variable">$&#123;key&#125;</span>"</span> <span class="operator">-eq</span> <span class="string">"((<span class="variable">$&#123;#port[@]&#125;</span>-1))"</span> ]]</span><br><span class="line">              socket=`ps aux|grep <span class="variable">$&#123;port[$&#123;key&#125;</span>]&#125;|grep -v grep|awk -F <span class="string">'='</span> <span class="string">'&#123;print $10&#125;'</span>|cut <span class="operator">-d</span> <span class="string">' '</span> <span class="operator">-f</span> <span class="number">1</span>`</span><br><span class="line">                          <span class="built_in">printf</span> <span class="string">'\t &#123;\n'</span></span><br><span class="line">                          <span class="built_in">printf</span> <span class="string">"\t\t\t\"&#123;#REDISPORT&#125;\":\"<span class="variable">$&#123;port[$&#123;key&#125;</span>]&#125;\"&#125;\n"</span></span><br><span class="line">                       <span class="keyword">fi</span></span><br><span class="line">               <span class="keyword">done</span></span><br><span class="line">                          <span class="built_in">printf</span> <span class="string">'\t ]\n'</span></span><br><span class="line">                          <span class="built_in">printf</span> <span class="string">'&#125;\n'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$1</span></span><br></pre></td></tr></table></figure>
<p>由于此脚本需要使用zabbix用户调用<code>netstat</code>命令，故需要允许zabbix用户无密码运行，同时关闭<code>requiretty</code></p>
<p>然后给与755权限，并修改用户与组为zabbix<br><a id="more"></a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"zabbix ALL=(root) NOPASSWD:/bin/netstat"</span>&gt;&gt;/etc/sudoers</span><br><span class="line">sed -i <span class="string">'s/^Defaults.*.requiretty/#Defaults    requiretty/'</span> /etc/sudoers</span><br><span class="line">chmod <span class="number">755</span> /usr/<span class="built_in">local</span>/zabbix-agent/etc/redis.sh</span><br><span class="line">chown -R zabbix.zabbix /usr/<span class="built_in">local</span>/zabbix-agent/etc/redis.sh</span><br></pre></td></tr></table></figure>
<p>添加UserParameter</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@redis conf]<span class="comment"># cat /usr/local/zabbix-agent/etc/zabbix_agentd.conf</span></span><br><span class="line">UnsafeUserParameters=<span class="number">1</span></span><br><span class="line">UserParameter=zabbix_low_discovery[*],sh /usr/<span class="built_in">local</span>/zabbix-agent/etc/redis.sh <span class="variable">$1</span></span><br><span class="line">UserParameter=redis_stats[*],(<span class="built_in">echo</span> info; sleep <span class="number">1</span>) | telnet <span class="number">127.0</span>.<span class="number">0.1</span> <span class="variable">$1</span>   <span class="number">2</span>&gt;&amp;<span class="number">1</span> |grep -w <span class="variable">$2</span>|cut <span class="operator">-d</span> : <span class="operator">-f</span>2</span><br></pre></td></tr></table></figure>
<p>以下为实现原理</p>
<p>自动发现规则<strong>zabbix_low_discovery</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@redis conf]<span class="comment"># su zabbix</span></span><br><span class="line">[zabbix@redis conf]$ sh /usr/<span class="built_in">local</span>/zabbix-agent/etc/redis.sh</span><br><span class="line">&#123;</span><br><span class="line">        <span class="string">"data"</span>:[</span><br><span class="line">         &#123;</span><br><span class="line">                        <span class="string">"&#123;#REDISPORT&#125;"</span>:<span class="string">"6379"</span>&#125;,</span><br><span class="line">         &#123;</span><br><span class="line">                        <span class="string">"&#123;#REDISPORT&#125;"</span>:<span class="string">"26379"</span>&#125;,</span><br><span class="line">         &#123;</span><br><span class="line">                        <span class="string">"&#123;#REDISPORT&#125;"</span>:<span class="string">"16379"</span>&#125;</span><br><span class="line">         ]</span><br><span class="line">&#125;</span><br><span class="line">[zabbix@redis conf]$</span><br></pre></td></tr></table></figure></p>
<p><strong>redis_stats</strong>的<strong>item</strong>获取利用<strong>telnet</strong>端口格式化各项参数信息<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@redis conf]<span class="comment"># su zabbix</span></span><br><span class="line">[zabbix@zhenru025 conf]$ (<span class="built_in">echo</span> info; sleep <span class="number">1</span>) | telnet <span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">6379</span>   <span class="number">2</span>&gt;&amp;<span class="number">1</span> |grep -w used_memory|cut <span class="operator">-d</span> : <span class="operator">-f</span>2   </span><br><span class="line"><span class="number">25109752</span></span><br></pre></td></tr></table></figure></p>
<h1 id="zabbix_server">zabbix_server</h1><p>使用zabbix_get获取zabbix_agent的redis键值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix ebuy]<span class="comment"># /usr/local/zabbix-server/bin/zabbix_get -s 10.10.10.3 -k zabbix_low_discovery[redis]</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="string">"data"</span>:[</span><br><span class="line">         &#123;</span><br><span class="line">                        <span class="string">"&#123;#REDISPORT&#125;"</span>:<span class="string">"6379"</span>&#125;,</span><br><span class="line">         &#123;</span><br><span class="line">                        <span class="string">"&#123;#REDISPORT&#125;"</span>:<span class="string">"26379"</span>&#125;,</span><br><span class="line">         &#123;</span><br><span class="line">                        <span class="string">"&#123;#REDISPORT&#125;"</span>:<span class="string">"16379"</span>&#125;</span><br><span class="line">         ]</span><br><span class="line">&#125;</span><br><span class="line">[root@zabbix ebuy]<span class="comment"># </span></span><br><span class="line">[root@zabbix ebuy]<span class="comment"># /usr/local/zabbix-server/bin/zabbix_get -s 10.10.10.3 -k redis_stats[6379,total_connections_received] </span></span><br><span class="line"><span class="number">63711</span></span><br></pre></td></tr></table></figure>
<p>以上配置完毕，测试没问题就万事俱备，导入<a href="http://pan.baidu.com/s/1eSIamJK" target="_blank" rel="external">模板</a>就OK！</p>
<p>至于网上一些文章说还需要设置正则表达式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">设置正则</span><br><span class="line">在“管理”—&gt; “一般”—&gt;“正则表达式”里，选择“新的正则表达式”</span><br><span class="line">设置如下(填写所有redis的端口号)：</span><br><span class="line">name：Redis regex</span><br><span class="line">Result TRUE  = ^(<span class="number">6380</span>|<span class="number">6381</span>)$</span><br></pre></td></tr></table></figure>
<p>我使用的是<strong>Zabbix 3.2.3</strong>版本，不用设置正则也可以。</p>
<p>以下为监控图像，可根据自身业务需求设置相应的触发器报警机制。</p>
<p><img src="http://wx3.sinaimg.cn/mw690/45d8cb2dgy1fd60w61t5lj20k10f9n2x.jpg" alt=""></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>zabbix使用自动发现规则自动化监控redis多实例，废话不多说，直接撸代码。</p>
<h1 id="zabbix-agent">zabbix-agent</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/<span class="built_in">local</span>/zabbix-agent/redis.sh</span><br><span class="line"></span><br><span class="line"><span class="shebang">#!/bin/bash</span><br><span class="line"></span></span><br><span class="line"><span class="function"><span class="title">redis</span></span>() &#123;</span><br><span class="line">            port=($(sudo netstat -tpln | awk -F <span class="string">"[ :]+"</span> <span class="string">'/redis/ &amp;&amp; /0.0.0.0/ &#123;print $5&#125;'</span>))</span><br><span class="line">            <span class="built_in">printf</span> <span class="string">'&#123;\n'</span></span><br><span class="line">            <span class="built_in">printf</span> <span class="string">'\t"data":[\n'</span></span><br><span class="line">               <span class="keyword">for</span> key <span class="keyword">in</span> <span class="variable">$&#123;!port[@]&#125;</span></span><br><span class="line">                   <span class="keyword">do</span></span><br><span class="line">                       <span class="keyword">if</span> [[ <span class="string">"<span class="variable">$&#123;#port[@]&#125;</span>"</span> <span class="operator">-gt</span> <span class="number">1</span> &amp;&amp; <span class="string">"<span class="variable">$&#123;key&#125;</span>"</span> <span class="operator">-ne</span> <span class="string">"<span class="variable">$(($&#123;#port[@]&#125;-1)</span>)"</span> ]];<span class="keyword">then</span></span><br><span class="line">              socket=`ps aux|grep <span class="variable">$&#123;port[$&#123;key&#125;</span>]&#125;|grep -v grep|awk -F <span class="string">'='</span> <span class="string">'&#123;print $10&#125;'</span>|cut <span class="operator">-d</span> <span class="string">' '</span> <span class="operator">-f</span> <span class="number">1</span>`</span><br><span class="line">                          <span class="built_in">printf</span> <span class="string">'\t &#123;\n'</span></span><br><span class="line">                          <span class="built_in">printf</span> <span class="string">"\t\t\t\"&#123;#REDISPORT&#125;\":\"<span class="variable">$&#123;port[$&#123;key&#125;</span>]&#125;\"&#125;,\n"</span></span><br><span class="line">                     <span class="keyword">else</span> [[ <span class="string">"<span class="variable">$&#123;key&#125;</span>"</span> <span class="operator">-eq</span> <span class="string">"((<span class="variable">$&#123;#port[@]&#125;</span>-1))"</span> ]]</span><br><span class="line">              socket=`ps aux|grep <span class="variable">$&#123;port[$&#123;key&#125;</span>]&#125;|grep -v grep|awk -F <span class="string">'='</span> <span class="string">'&#123;print $10&#125;'</span>|cut <span class="operator">-d</span> <span class="string">' '</span> <span class="operator">-f</span> <span class="number">1</span>`</span><br><span class="line">                          <span class="built_in">printf</span> <span class="string">'\t &#123;\n'</span></span><br><span class="line">                          <span class="built_in">printf</span> <span class="string">"\t\t\t\"&#123;#REDISPORT&#125;\":\"<span class="variable">$&#123;port[$&#123;key&#125;</span>]&#125;\"&#125;\n"</span></span><br><span class="line">                       <span class="keyword">fi</span></span><br><span class="line">               <span class="keyword">done</span></span><br><span class="line">                          <span class="built_in">printf</span> <span class="string">'\t ]\n'</span></span><br><span class="line">                          <span class="built_in">printf</span> <span class="string">'&#125;\n'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$1</span></span><br></pre></td></tr></table></figure>
<p>由于此脚本需要使用zabbix用户调用<code>netstat</code>命令，故需要允许zabbix用户无密码运行，同时关闭<code>requiretty</code></p>
<p>然后给与755权限，并修改用户与组为zabbix<br>]]>
    
    </summary>
    
      <category term="监控 zabbix redis" scheme="http://linux48.com/tags/%E7%9B%91%E6%8E%A7-zabbix-redis/"/>
    
      <category term="zabbix" scheme="http://linux48.com/categories/zabbix/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[zabbix 3.0邮件报警]]></title>
    <link href="http://linux48.com//archives/453/"/>
    <id>http://linux48.com//archives/453/</id>
    <published>2016-07-05T16:00:00.000Z</published>
    <updated>2016-07-06T04:23:49.000Z</updated>
    <content type="html"><![CDATA[<p>安装zabbix 3.0之后，写的脚本一直发信不成功,手动执行时可以的。<br>那是因为zabbix3.0之后，可以自定义参数了。所以不写参数，它是不会传参数的。<br>在2.x版本不存在这个问题，默认会传3个参数。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat alert_mail.log</span></span><br><span class="line">sendEmail[<span class="number">9271</span>]: ERROR =&gt; You must specify at least one recipient via -t, -cc, or -bcc</span><br><span class="line"><span class="comment"># cat alert_sms.log</span></span><br><span class="line">手机机号码不能为空</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>进入zabbix管理页面<br>点击管理-&gt;报警媒介类型 点击最右边的创建媒体类型</p>
<p>输入脚本名称，类型选择脚本<br>添加以下3个参数，分别对应sendEmail.sh脚本需要的3个参数：收件人地址、主题、详细内容</p>
<blockquote>
<ul>
<li>{ALERT.SENDTO}</li>
<li>{ALERT.SUBJECT}</li>
<li>{ALERT.MESSAGE}</li>
</ul>
</blockquote>
<p><img src="http://r5.loli.io/ruEVne.png" alt=""></p>
<p>邮件发送脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/sh</span></span><br><span class="line"><span class="comment">#$1, $2, $3 mean Recipient, Subject and Message</span></span><br><span class="line"></span><br><span class="line">to=<span class="variable">$1</span></span><br><span class="line">subject=<span class="variable">$2</span></span><br><span class="line">body=<span class="variable">$3</span></span><br><span class="line"></span><br><span class="line">DATE=`date <span class="string">"+%Y%m%d %H:%M:%S"</span>`</span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/zabbix-server/share/zabbix/alertscripts</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$DATE</span> &gt;&gt;alert_mail.log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MAIL=<span class="string">'/usr/local/zabbix-server/share/zabbix/alertscripts/sendEmail'</span></span><br><span class="line"><span class="variable">$MAIL</span> <span class="operator">-s</span> smtp.test.com.cn <span class="operator">-f</span> zabbix@test.com.cn -t <span class="string">"<span class="variable">$to</span>"</span> -xu zabbix@test.com.cn -xp <span class="string">'test2015test2015'</span> -u <span class="string">"<span class="variable">$subject</span>"</span> -m <span class="string">"<span class="variable">$body</span>"</span> -o &gt;&gt; alert_mail.log</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$1</span> &gt;&gt; alert_mail.log</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$2</span> &gt;&gt; alert_mail.log</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$3</span> &gt;&gt; alert_mail.log</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p>安装zabbix 3.0之后，写的脚本一直发信不成功,手动执行时可以的。<br>那是因为zabbix3.0之后，可以自定义参数了。所以不写参数，它是不会传参数的。<br>在2.x版本不存在这个问题，默认会传3个参数。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat alert_mail.log</span></span><br><span class="line">sendEmail[<span class="number">9271</span>]: ERROR =&gt; You must specify at least one recipient via -t, -cc, or -bcc</span><br><span class="line"><span class="comment"># cat alert_sms.log</span></span><br><span class="line">手机机号码不能为空</span><br></pre></td></tr></table></figure>]]>
    
    </summary>
    
      <category term="监控" scheme="http://linux48.com/tags/%E7%9B%91%E6%8E%A7/"/>
    
      <category term="zabbix" scheme="http://linux48.com/categories/zabbix/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[hive整合hadoop通过flume+hue收集日志]]></title>
    <link href="http://linux48.com//archives/452/"/>
    <id>http://linux48.com//archives/452/</id>
    <published>2016-06-29T16:00:00.000Z</published>
    <updated>2016-06-30T08:54:23.000Z</updated>
    <content type="html"><![CDATA[<p>hive作为hadoop集群架构之上的一个架构，通过一种类SQL的解析引擎来将作业转换成map/reduce执行的任务。</p>
<p>本文主要是分享基本的安装与使用经验。hive的实质是将表对应到HDFS中的目录。</p>
<h1 id="准备工作">准备工作</h1><h2 id="添加环境变量">添加环境变量</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_HOME=<span class="string">"/usr/local/jdk1.7.0_09"</span></span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$CLASSPATH</span>:<span class="variable">$JAVA_HOME</span>/lib:<span class="variable">$JAVA_HOME</span>/jre/lib</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=<span class="string">"/home/hadoop/hadoop-2.6.4"</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_CONF_DIR=<span class="variable">$HADOOP_HOME</span>/etc/hadoop/</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$CLASSPATH</span>:<span class="variable">$HADOOP_HOME</span>/lib</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HADOOP_HOME</span>/bin:<span class="variable">$HADOOP_HOME</span>/sbin</span><br><span class="line"><span class="built_in">export</span> HADOOP_USER_CLASSPATH_FIRST=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> HIVE_HOME=<span class="string">"/home/hadoop/apache-hive-2.1.0-bin"</span></span><br><span class="line"><span class="built_in">export</span> CLASSPATH=<span class="variable">$CLASSPATH</span>:<span class="variable">$HIVE_HOME</span>/lib</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HIVE_HOME</span>/bin:<span class="variable">$HIVE_HOME</span>/conf</span><br></pre></td></tr></table></figure>
<h2 id="设置公钥本机免登陆密码">设置公钥本机免登陆密码</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br><span class="line">cp <span class="regexp">/root/</span>.ssh<span class="regexp">/id_rsa.pub  /</span>root<span class="regexp">/.ssh/</span>authorized_keys</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h1 id="安装java环境">安装java环境</h1><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tar zxvf jdk-<span class="number">7</span>u9-linux-x64.tar.gz</span><br><span class="line">mv jdk1.<span class="number">7.0</span>_09<span class="regexp">/ /u</span>sr<span class="regexp">/local/</span></span><br><span class="line"></span><br><span class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/jdk1.7.0_09/</span>bin<span class="regexp">/java /u</span>sr<span class="regexp">/bin/</span></span><br><span class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/jdk1.7.0_09/</span>bin<span class="regexp">/javac /u</span>sr<span class="regexp">/bin/</span></span><br><span class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/jdk1.7.0_09/</span>bin<span class="regexp">/jar /u</span>sr<span class="regexp">/bin/</span></span><br></pre></td></tr></table></figure>
<h1 id="安装hadoop">安装hadoop</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">wget http://www.apache.org/dyn/closer.cgi/hadoop/common/hadoop-2.6.4/hadoop-2.6.4.tar.gz</span><br><span class="line">tar zxvf hadoop-2.6.4.tar.gz</span><br><span class="line">cd hadoop-2.6.4</span><br><span class="line">vim etc/hadoop/hadoop-env.sh</span><br><span class="line">export JAVA_HOME=/usr/local/jdk1.7.0_09</span><br><span class="line">vim etc/hadoop/core-site.xml</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="title">value</span>&gt;</span>/home/ebuy/hadoop/hadoop-2.6.4/tmp<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 如没有配置hadoop.tmp.dir参数，此时系统默认的临时目录为：/tmp/hadoo-hadoop</span><br><span class="line">		而这个目录在每次重启后都会被干掉，必须重新执行format才行，否则会出错。 --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="title">description</span>&gt;</span>A base for other temporary directories.<span class="tag">&lt;/<span class="title">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- file system properties --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="title">name</span>&gt;</span>fs.default.name<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="title">value</span>&gt;</span>hdfs://localhost:9000<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="启动及验证hadoop">启动及验证hadoop</h1><h2 id="格式化HDFS文件系统">格式化HDFS文件系统</h2><p><code>hadoop namenode -format</code></p>
<h2 id="启动hadoop">启动hadoop</h2><p><code>sh sbin/start-all.sh</code></p>
<p><a href="http://10.127.0.5:50070" target="_blank" rel="external">http://10.127.0.5:50070</a></p>
<h2 id="hdfs常用命令">hdfs常用命令</h2><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -<span class="keyword">mkdir</span> /tmp/hive</span><br><span class="line">hdfs dfs -ls  /tmp/hive/*</span><br><span class="line">hdfs dfs -cat /tmp/hive/<span class="number">123</span> |  wc -l</span><br><span class="line">hdfs dfs -<span class="keyword">chmod</span> <span class="number">755</span> /tmp/</span><br><span class="line">hdfs dfs -rmr /tmp/*</span><br><span class="line">hdfs dfs -<span class="keyword">mkdir</span> /user/hive/warehouse</span><br><span class="line">hdfs dfs -<span class="keyword">chmod</span> <span class="number">755</span> /user/hive/warehouse</span><br></pre></td></tr></table></figure>
<h1 id="安装hive">安装hive</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">wget http://mirrors.hust.edu.cn/apache/hive/hive-1.2.1/apache-hive-1.2.1-bin.tar.gz</span><br><span class="line">tar zxvf apache-hive-1.2.1-bin.tar.gz</span><br><span class="line">cd apache-hive-1.2.1-bin</span><br><span class="line">cd conf</span><br><span class="line">cp hive-default.xml.template   hive-site.xml</span><br><span class="line">cp hive-exec-log4j.properties.template  hive-exec-log4j.properties</span><br><span class="line">cp hive-log4j.properties.template  hive-log4j.properties</span><br><span class="line">cp hive-env.sh.template hive-env.sh</span><br><span class="line">vim hive-env.sh</span><br><span class="line">HADOOP_HOME=/home/ebuy/hadoop/hadoop-2.6.4</span><br><span class="line">export HIVE_CONF_DIR=/home/ebuy/hadoop/apache-hive-1.2.1-bin/conf</span><br><span class="line">cat hive-site.xml </span><br><span class="line"><span class="tag">&lt;<span class="title">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- MySQ的URL配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">value</span>&gt;</span>jdbc:mysql://144.232.134.58:3306/hive?createDatabaseIfNotExist=true<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 此处JDBC的驱动务必加上，对应的数据配置对应的驱动--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">value</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="title">description</span>&gt;</span>Driver class name for a JDBC metastore<span class="tag">&lt;/<span class="title">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 数据库的用户名配置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">value</span>&gt;</span>hive<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 数据库密码配置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">name</span>&gt;</span>javax.jdo.option.ConnectionPassword<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">value</span>&gt;</span>hive<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- HDFS路径hive表的存放位置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">name</span>&gt;</span>hive.metastore.warehouse.dir<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">value</span>&gt;</span>hdfs://localhost:9000//user/hive/warehouse<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--HDFS路径，用于存储不同 map/reduce 阶段的执行计划和这些阶段的中间输出结果。 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">name</span>&gt;</span>hive.exec.scratchdir<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">value</span>&gt;</span>/tmp<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">name</span>&gt;</span>mapred.child.java.opts<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">value</span>&gt;</span>-Xmx4096m<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 日志的记录位置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">name</span>&gt;</span>hive.querylog.location<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">value</span>&gt;</span>/home/ebuy/hadoop/apache-hive-1.2.1-bin/logs<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">name</span>&gt;</span>hive.metastore.local<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">value</span>&gt;</span>false<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">name</span>&gt;</span>hive.server2.thrift.port<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">value</span>&gt;</span>10000<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">name</span>&gt;</span>hive.server2.thrift.bind.host<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">value</span>&gt;</span>localhost<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>mysql连接驱动hive没有自带；需拷贝mysql-connector-java-5.1.21.jar到lib下,同时mysql据数据建表授权！</p>
<p>在HDFS上，新建hive的数据存储目录，以及MapReduce执行过程，生成的临时文件目录，执行命令如下，并赋值权限</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -mkidr /tmp  </span><br><span class="line">hdfs dfs -mkidr /<span class="built_ins">user</span>/hive/warehouse  </span><br><span class="line">hdfs dfs -chmod g+w /tmp  </span><br><span class="line">hdfs dfs -chmod g+w /<span class="built_ins">user</span>/hive/warehouse</span><br></pre></td></tr></table></figure>
<h1 id="启动hive_执行建表命令并导入数据">启动hive 执行建表命令并导入数据</h1><p>执行命令</p>
<p><code>./bin/hive</code></p>
<h1 id="Hiveserver2启动">Hiveserver2启动</h1><p>HiveServer2作为一种服务接口，允许Hive远程客户端执行查询并返回结果；默认监听端口为10000。当前实现基于Thrift的RPC调用。是HiveServer的改进版本，支持多客户端的并发和权限控制.</p>
<p><code>./bin/hiveserver2</code></p>
<h1 id="fulme+HUE">fulme+HUE</h1><p><a href="https://linux48.com/archives/449/">fulme+HUE配置</a></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim hue<span class="regexp">/desktop/</span>conf/pseudo-distributed.ini</span><br><span class="line">hive_server_host=localhost</span><br><span class="line">hive_server_port=<span class="number">10000</span></span><br><span class="line">hive_conf_dir=<span class="regexp">/home/</span>ebuy<span class="regexp">/hadoop/</span>apache-hive-<span class="number">1.2</span>.1-bin/conf</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p>hive作为hadoop集群架构之上的一个架构，通过一种类SQL的解析引擎来将作业转换成map/reduce执行的任务。</p>
<p>本文主要是分享基本的安装与使用经验。hive的实质是将表对应到HDFS中的目录。</p>
<h1 id="准备工作">准备工作</h1><h2 id="添加环境变量">添加环境变量</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_HOME=<span class="string">"/usr/local/jdk1.7.0_09"</span></span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$CLASSPATH</span>:<span class="variable">$JAVA_HOME</span>/lib:<span class="variable">$JAVA_HOME</span>/jre/lib</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=<span class="string">"/home/hadoop/hadoop-2.6.4"</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_CONF_DIR=<span class="variable">$HADOOP_HOME</span>/etc/hadoop/</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$CLASSPATH</span>:<span class="variable">$HADOOP_HOME</span>/lib</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HADOOP_HOME</span>/bin:<span class="variable">$HADOOP_HOME</span>/sbin</span><br><span class="line"><span class="built_in">export</span> HADOOP_USER_CLASSPATH_FIRST=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> HIVE_HOME=<span class="string">"/home/hadoop/apache-hive-2.1.0-bin"</span></span><br><span class="line"><span class="built_in">export</span> CLASSPATH=<span class="variable">$CLASSPATH</span>:<span class="variable">$HIVE_HOME</span>/lib</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HIVE_HOME</span>/bin:<span class="variable">$HIVE_HOME</span>/conf</span><br></pre></td></tr></table></figure>
<h2 id="设置公钥本机免登陆密码">设置公钥本机免登陆密码</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br><span class="line">cp <span class="regexp">/root/</span>.ssh<span class="regexp">/id_rsa.pub  /</span>root<span class="regexp">/.ssh/</span>authorized_keys</span><br></pre></td></tr></table></figure>]]>
    
    </summary>
    
      <category term="hadoop" scheme="http://linux48.com/tags/hadoop/"/>
    
      <category term="大数据" scheme="http://linux48.com/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="hadoop" scheme="http://linux48.com/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/hadoop/"/>
    
      <category term="hive" scheme="http://linux48.com/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/hadoop/hive/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[MySQL查询表内重复记录]]></title>
    <link href="http://linux48.com//archives/451/"/>
    <id>http://linux48.com//archives/451/</id>
    <published>2016-05-26T16:00:00.000Z</published>
    <updated>2016-05-27T08:18:18.000Z</updated>
    <content type="html"><![CDATA[<p>MySQL查询表内重复记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1.查找表中多余的重复记录，重复记录是根据单个字段（peopleId）来判断</span></span><br><span class="line"><span class="operator"><span class="keyword">select</span> * <span class="keyword">from</span> people</span><br><span class="line"><span class="keyword">where</span> peopleId <span class="keyword">in</span> (<span class="keyword">select</span> peopleId <span class="keyword">from</span> people <span class="keyword">group</span> <span class="keyword">by</span> peopleId <span class="keyword">having</span> <span class="keyword">count</span>(peopleId) &gt; <span class="number">1</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">-- 2.删除表中多余的重复记录，重复记录是根据单个字段（peopleId）来判断，只留有一个记录</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> people</span><br><span class="line"><span class="keyword">where</span> peopleId <span class="keyword">in</span> (<span class="keyword">select</span> peopleId <span class="keyword">from</span> people <span class="keyword">group</span> <span class="keyword">by</span> peopleId <span class="keyword">having</span> <span class="keyword">count</span>(peopleId) &gt; <span class="number">1</span>)</span><br><span class="line"><span class="keyword">and</span> <span class="keyword">min</span>(id) <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> id <span class="keyword">from</span> people <span class="keyword">group</span> <span class="keyword">by</span> peopleId <span class="keyword">having</span> <span class="keyword">count</span>(peopleId )&gt;<span class="number">1</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">-- 3.查找表中多余的重复记录（多个字段）</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> vitae a</span><br><span class="line"><span class="keyword">where</span> (a.peopleId,a.seq) <span class="keyword">in</span> (<span class="keyword">select</span> peopleId,seq <span class="keyword">from</span> vitae <span class="keyword">group</span> <span class="keyword">by</span> peopleId,seq <span class="keyword">having</span> <span class="keyword">count</span>(*) &gt; <span class="number">1</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">-- 4.删除表中多余的重复记录（多个字段），只留有rowid最小的记录</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> vitae a</span><br><span class="line"><span class="keyword">where</span> (a.peopleId,a.seq) <span class="keyword">in</span> (<span class="keyword">select</span> peopleId,seq <span class="keyword">from</span> vitae <span class="keyword">group</span> <span class="keyword">by</span> peopleId,seq <span class="keyword">having</span> <span class="keyword">count</span>(*) &gt; <span class="number">1</span>)</span><br><span class="line"><span class="keyword">and</span> rowid <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> <span class="keyword">min</span>(rowid) <span class="keyword">from</span> vitae <span class="keyword">group</span> <span class="keyword">by</span> peopleId,seq <span class="keyword">having</span> <span class="keyword">count</span>(*)&gt;<span class="number">1</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">-- 5.查找表中多余的重复记录（多个字段），不包含rowid最小的记录</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> vitae a</span><br><span class="line"><span class="keyword">where</span> (a.peopleId,a.seq) <span class="keyword">in</span> (<span class="keyword">select</span> peopleId,seq <span class="keyword">from</span> vitae <span class="keyword">group</span> <span class="keyword">by</span> peopleId,seq <span class="keyword">having</span> <span class="keyword">count</span>(*) &gt; <span class="number">1</span>)</span><br><span class="line"><span class="keyword">and</span> rowid <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> <span class="keyword">min</span>(rowid) <span class="keyword">from</span> vitae <span class="keyword">group</span> <span class="keyword">by</span> peopleId,seq <span class="keyword">having</span> <span class="keyword">count</span>(*)&gt;<span class="number">1</span>)</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>eg :</p>
<p>在A表中存在一个字段“name”，<br>而且不同记录之间的“name”值有可能会相同，<br>现在就是需要查询出在该表中的各记录之间，“name”值存在重复的项；</p>
<pre><code><span class="keyword">Select</span> Name,Count<span class="comment">(*) From A Group By Name Having Count(*)</span> &gt; <span class="number">1</span>
</code></pre><p>如果还查性别也相同大则如下:</p>
<pre><code><span class="keyword">Select</span> Name,sex,Count<span class="comment">(*) From A Group By Name,sex Having Count(*)</span> &gt; <span class="number">1</span>
</code></pre>]]></content>
    <summary type="html">
    <![CDATA[<p>MySQL查询表内重复记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1.查找表中多余的重复记录，重复记录是根据单个字段（peopleId）来判断</span></span><br><span class="line"><span class="operator"><span class="keyword">select</span> * <span class="keyword">from</span> people</span><br><span class="line"><span class="keyword">where</span> peopleId <span class="keyword">in</span> (<span class="keyword">select</span> peopleId <span class="keyword">from</span> people <span class="keyword">group</span> <span class="keyword">by</span> peopleId <span class="keyword">having</span> <span class="keyword">count</span>(peopleId) &gt; <span class="number">1</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">-- 2.删除表中多余的重复记录，重复记录是根据单个字段（peopleId）来判断，只留有一个记录</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> people</span><br><span class="line"><span class="keyword">where</span> peopleId <span class="keyword">in</span> (<span class="keyword">select</span> peopleId <span class="keyword">from</span> people <span class="keyword">group</span> <span class="keyword">by</span> peopleId <span class="keyword">having</span> <span class="keyword">count</span>(peopleId) &gt; <span class="number">1</span>)</span><br><span class="line"><span class="keyword">and</span> <span class="keyword">min</span>(id) <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> id <span class="keyword">from</span> people <span class="keyword">group</span> <span class="keyword">by</span> peopleId <span class="keyword">having</span> <span class="keyword">count</span>(peopleId )&gt;<span class="number">1</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">-- 3.查找表中多余的重复记录（多个字段）</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> vitae a</span><br><span class="line"><span class="keyword">where</span> (a.peopleId,a.seq) <span class="keyword">in</span> (<span class="keyword">select</span> peopleId,seq <span class="keyword">from</span> vitae <span class="keyword">group</span> <span class="keyword">by</span> peopleId,seq <span class="keyword">having</span> <span class="keyword">count</span>(*) &gt; <span class="number">1</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">-- 4.删除表中多余的重复记录（多个字段），只留有rowid最小的记录</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> vitae a</span><br><span class="line"><span class="keyword">where</span> (a.peopleId,a.seq) <span class="keyword">in</span> (<span class="keyword">select</span> peopleId,seq <span class="keyword">from</span> vitae <span class="keyword">group</span> <span class="keyword">by</span> peopleId,seq <span class="keyword">having</span> <span class="keyword">count</span>(*) &gt; <span class="number">1</span>)</span><br><span class="line"><span class="keyword">and</span> rowid <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> <span class="keyword">min</span>(rowid) <span class="keyword">from</span> vitae <span class="keyword">group</span> <span class="keyword">by</span> peopleId,seq <span class="keyword">having</span> <span class="keyword">count</span>(*)&gt;<span class="number">1</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">-- 5.查找表中多余的重复记录（多个字段），不包含rowid最小的记录</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> vitae a</span><br><span class="line"><span class="keyword">where</span> (a.peopleId,a.seq) <span class="keyword">in</span> (<span class="keyword">select</span> peopleId,seq <span class="keyword">from</span> vitae <span class="keyword">group</span> <span class="keyword">by</span> peopleId,seq <span class="keyword">having</span> <span class="keyword">count</span>(*) &gt; <span class="number">1</span>)</span><br><span class="line"><span class="keyword">and</span> rowid <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> <span class="keyword">min</span>(rowid) <span class="keyword">from</span> vitae <span class="keyword">group</span> <span class="keyword">by</span> peopleId,seq <span class="keyword">having</span> <span class="keyword">count</span>(*)&gt;<span class="number">1</span>)</span></span><br></pre></td></tr></table></figure>]]>
    
    </summary>
    
      <category term="sql语句" scheme="http://linux48.com/tags/sql%E8%AF%AD%E5%8F%A5/"/>
    
      <category term="database" scheme="http://linux48.com/categories/database/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Startssl免费SSL证书+Nginx搭建https]]></title>
    <link href="http://linux48.com//archives/450/"/>
    <id>http://linux48.com//archives/450/</id>
    <published>2016-05-23T16:00:00.000Z</published>
    <updated>2016-05-24T13:23:06.000Z</updated>
    <content type="html"><![CDATA[<p>看到好多小伙伴们都使用了HTTPS<br>所以为了更好的提高国内用户的访问体验（装13。。）在下也试试看</p>
<h1 id="必备条件">必备条件</h1><blockquote>
<p>你要有个域名!!!<br>你要有台server!<br>你要有备案号!!!<br>你要有备案号!!!<br>你要有备案号!!!</p>
</blockquote>
<p>以上ok！那么下面我们就开搞！！</p>
<a id="more"></a>
<h1 id="注册StartSSL账号">注册StartSSL账号</h1><p>需要注意注册成功之后需要保存登陆证书并双击导入到系统；<br>然后登陆选择Authenticate进行登陆，需使用IE或者Microsoft Edge浏览器，由于会弹出证书允许提示，所以chrome无法加载证书<br><img src="http://r6.loli.io/Bzq2Yn.png" alt=""></p>
<h1 id="申请免费StartSSL证书">申请免费StartSSL证书</h1><p>登陆后进入 Validations Wizard，验证你要添加 ssl 支持的域名<br><img src="http://r5.loli.io/INB7jm.png" alt=""><br><img src="http://r6.loli.io/Fruy6b.png" alt=""><br><img src="http://r.loli.io/nuqMba.png" alt=""><br>按照提示添加OK！</p>
<p>进入 Certificates Wizard，并选择 Web Servers SSL/TLS Certificates<br><img src="http://r.loli.io/yiQvEb.png" alt=""><br><img src="http://r6.loli.io/n2qe22.png" alt=""><br>这里需要注意可以使用官方提供的<code>StartComTool.exe</code>生成CSR<br>也可以使用<code>openssl</code>命令生成CSR</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="number">3</span>-<span class="number">225</span> ~]<span class="comment"># openssl req -newkey rsa:2048 -keyout linux48.key -out linux48.csr                 </span></span><br><span class="line">Generating a <span class="number">2048</span> bit RSA private key</span><br><span class="line">......................+++</span><br><span class="line">........................................................+++</span><br><span class="line">writing new private key to <span class="string">'linux48.key'</span></span><br><span class="line">Enter PEM pass phrase:</span><br><span class="line">Verifying - Enter PEM pass phrase:</span><br><span class="line">-----</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter <span class="string">'.'</span>, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (<span class="number">2</span> letter code) [XX]:CN</span><br><span class="line">State or Province Name (full name) []:ShangHai</span><br><span class="line">Locality Name (eg, city) [Default City]:ShangHai</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:linux48.com</span><br><span class="line">Organizational Unit Name (eg, section) []:linux48.com</span><br><span class="line">Common Name (eg, your name or your server<span class="string">'s hostname) []:*.linux48.com</span><br><span class="line">Email Address []:admin@linux48.com</span><br><span class="line"></span><br><span class="line">Please enter the following '</span>extra<span class="string">' attributes</span><br><span class="line">to be sent with your certificate request</span><br><span class="line">A challenge password []:</span><br><span class="line">An optional company name []:</span><br><span class="line">[root@3-225 ~]#cat linux48.csr  ##复制粘贴到Certificate Signing Request (CSR):</span></span><br></pre></td></tr></table></figure>
<p>点击<strong>here</strong>下载证书<br><img src="http://r5.loli.io/fy2EFb.png" alt=""><br><img src="http://r6.loli.io/uYvyey.png" alt=""></p>
<h1 id="SSL证书的上传和nginx配置">SSL证书的上传和nginx配置</h1><p>把此crt文件重命名linux48.crt<br><img src="http://r6.loli.io/VvEbie.png" alt=""></p>
<p>还有刚才<code>openssl</code>命令生成的key<br><img src="http://r.loli.io/EBNr2u.png" alt=""></p>
<p>以上两个文件上传到web服务器；并重启nginx</p>
<p>需要注意的是启动nginx会提示输入PEM的密码，就是之前<code>openssl</code>生成的时候指定的密码<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ62phtamqlZ vhost]<span class="comment"># /usr/local/nginx/sbin/nginx</span></span><br><span class="line">Enter PEM pass phrase:</span><br><span class="line">[root@iZ62phtamqlZ vhost]<span class="comment">#</span></span><br></pre></td></tr></table></figure></p>
<p>以下为nginx配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ62phtamqlZ vhost]<span class="comment"># cat linux48.com.conf </span></span><br><span class="line"><span class="built_in">log</span>_format  linux48.com  <span class="string">'$remote_addr - $remote_user [$time_local] "$request" '</span></span><br><span class="line">             <span class="string">'$status $body_bytes_sent "$http_referer" '</span></span><br><span class="line">             <span class="string">'"$http_user_agent" $http_x_forwarded_for'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">server</span><br><span class="line">        &#123;</span><br><span class="line">                listen       <span class="number">443</span>;</span><br><span class="line">                server_name linux48.com www.linux48.com;</span><br><span class="line">                index index.html index.htm index.php default.html default.htm default.php;</span><br><span class="line">                root  /home/wwwroot/linux48.com/public;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    ssl                  on;</span><br><span class="line">    ssl_certificate      /home/wwwroot/linux48.crt;</span><br><span class="line">    ssl_certificate_key  /home/wwwroot/linux48.key;</span><br><span class="line">    ssl_session_timeout  <span class="number">5</span>m;</span><br><span class="line">    ssl_protocols SSLv2 SSLv3 TLSv1;</span><br><span class="line">    ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;</span><br><span class="line">    ssl_prefer_server_ciphers on;</span><br><span class="line"></span><br><span class="line">                location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$</span><br><span class="line">                        &#123;</span><br><span class="line">                                expires      <span class="number">30</span>d;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                location ~ .*\.(js|css)?$</span><br><span class="line">                        &#123;</span><br><span class="line">                                expires      <span class="number">12</span>h;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                access_<span class="built_in">log</span>  /home/wwwlogs/access.log  linux48.com;</span><br><span class="line">                error_page <span class="number">404</span> = /<span class="number">404</span>.html;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">server</span><br><span class="line">        &#123;</span><br><span class="line">                listen       <span class="number">80</span>;</span><br><span class="line">                server_name linux48.com www.linux48.com;</span><br><span class="line">                rewrite ^(.*) https://linux48.com<span class="variable">$1</span> permanent;</span><br><span class="line">        &#125;</span><br><span class="line">[root@iZ62phtamqlZ vhost]<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p><strong>请注意： 免费SSL证书仅适合于个人网站或非电子商务网站，不显示单位名称，仅起到加密传输信息的作用，并不能证明网站的真实身份。</strong></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>看到好多小伙伴们都使用了HTTPS<br>所以为了更好的提高国内用户的访问体验（装13。。）在下也试试看</p>
<h1 id="必备条件">必备条件</h1><blockquote>
<p>你要有个域名!!!<br>你要有台server!<br>你要有备案号!!!<br>你要有备案号!!!<br>你要有备案号!!!</p>
</blockquote>
<p>以上ok！那么下面我们就开搞！！</p>]]>
    
    </summary>
    
      <category term="SSL" scheme="http://linux48.com/tags/SSL/"/>
    
      <category term="https" scheme="http://linux48.com/tags/https/"/>
    
      <category term="openssl" scheme="http://linux48.com/tags/openssl/"/>
    
      <category term="大数据" scheme="http://linux48.com/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[flume+hdfs构建大数据]]></title>
    <link href="http://linux48.com//archives/449/"/>
    <id>http://linux48.com//archives/449/</id>
    <published>2016-05-15T16:00:00.000Z</published>
    <updated>2016-05-16T07:29:27.000Z</updated>
    <content type="html"><![CDATA[<h1 id="hadoop">hadoop</h1><p><a href="http://hadoop.apache.org/docs/r1.0.4/cn/" target="_blank" rel="external">http://hadoop.apache.org/docs/r1.0.4/cn/</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -mkdir /ebuyposp</span><br><span class="line">hdfs dfs -mkdir /ebuyposp2</span><br><span class="line">hdfs dfs -ls /</span><br><span class="line"></span><br><span class="line">hdfs dfs -cat /ebuyposp1/k1_.<span class="number">1462357028642</span></span><br><span class="line">hdfs dfs -rm -r <span class="operator">-f</span> -skipTrash /ebuyposp/*</span><br><span class="line">hdfs dfs -rm -r <span class="operator">-f</span> -skipTrash /ebuyposp2/*</span><br><span class="line">hdfs dfs -rm -r <span class="operator">-f</span> -skipTrash /ebuyposp2</span><br><span class="line">hdfs dfs -rm -r <span class="operator">-f</span> -skipTrash /<span class="built_in">test</span>20160428</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h1 id="file_roll格式">file_roll格式</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># clientAgent</span></span><br><span class="line">clientAgent.channels = c1</span><br><span class="line">clientAgent.sources = s1</span><br><span class="line">clientAgent.sinks = k1 k2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># clientAgent Spooling Directory Source</span></span><br><span class="line">clientAgent.sources.s1.type = avro</span><br><span class="line">clientAgent.sources.s1.channels =c1</span><br><span class="line">clientAgent.sources.s1.bind = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">clientAgent.sources.s1.port = <span class="number">44444</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># clientAgent FileChannel</span></span><br><span class="line">clientAgent.channels.c1.type = memory</span><br><span class="line">clientAgent.channels.c1.capacity = <span class="number">200000000</span></span><br><span class="line">clientAgent.channels.c1.keep-alive = <span class="number">30</span></span><br><span class="line">clientAgent.channels.c1.write-timeout = <span class="number">30</span></span><br><span class="line">clientAgent.channels.c1.checkpoint-timeout=<span class="number">600</span></span><br><span class="line">clientAgent.channels.c1.transactionCapacity = <span class="number">1000</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># clientAgent Sinks</span></span><br><span class="line"><span class="comment"># k1 sink</span></span><br><span class="line">clientAgent.sinks.k1.channel = c1</span><br><span class="line">clientAgent.sinks.k1.type = file_roll</span><br><span class="line"></span><br><span class="line">clientAgent.sinks.k1.sink.directory = ./tmp1</span><br><span class="line">clientAgent.sinks.k1.sink.rollInterval=<span class="number">86400</span></span><br><span class="line">clientAgent.sinks.k1.sink.batchSize=<span class="number">100</span></span><br><span class="line">clientAgent.sinks.k1.sink.serializer=text</span><br><span class="line">clientAgent.sinks.k1.sink.serializer.appendNewline = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># connect to serverAgent</span></span><br><span class="line">clientAgent.sinks.k1.hostname = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">clientAgent.sinks.k1.port = <span class="number">41415</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># k2 sink</span></span><br><span class="line">clientAgent.sinks.k2.channel = c1</span><br><span class="line">clientAgent.sinks.k2.type = file_roll</span><br><span class="line"></span><br><span class="line">clientAgent.sinks.k2.sink.directory = ./tmp2</span><br><span class="line">clientAgent.sinks.k2.sink.rollInterval=<span class="number">86400</span></span><br><span class="line">clientAgent.sinks.k2.sink.batchSize=<span class="number">100</span></span><br><span class="line">clientAgent.sinks.k2.sink.serializer=text</span><br><span class="line">clientAgent.sinks.k2.sink.serializer.appendNewline = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># connect to CollectorBackupAgent</span></span><br><span class="line">clientAgent.sinks.k2.hostname = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">clientAgent.sinks.k2.port = <span class="number">41415</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># clientAgent sinks group</span></span><br><span class="line">clientAgent.sinkgroups = g1</span><br><span class="line">clientAgent.sinkgroups.g1.sinks = k1 k2</span><br><span class="line"><span class="comment"># load_balance type</span></span><br><span class="line">clientAgent.sinkgroups.g1.processor.type = load_balance</span><br><span class="line">clientAgent.sinkgroups.g1.processor.backoff = <span class="literal">true</span></span><br><span class="line">clientAgent.sinkgroups.g1.processor.selector = random</span><br><span class="line">clientAgent.sinkgroups.g1.processor.priority.k1 = <span class="number">10</span></span><br><span class="line">clientAgent.sinkgroups.g1.processor.priority.k2 = <span class="number">9</span></span><br></pre></td></tr></table></figure>
<h1 id="spooldir监听目录格式">spooldir监听目录格式</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># clientAgent</span></span><br><span class="line">clientAgent.channels = c1</span><br><span class="line">clientAgent.sources = s1</span><br><span class="line">clientAgent.sinks = k1 k2</span><br><span class="line"></span><br><span class="line"><span class="comment"># clientAgent Spooling Directory Source</span></span><br><span class="line">clientAgent.sources.s1.type = spooldir</span><br><span class="line"></span><br><span class="line"><span class="comment"># 监听目录</span></span><br><span class="line">clientAgent.sources.s1.spoolDir =/app/<span class="built_in">test</span>/ebuy3.<span class="number">0</span>/ebuyposp/logs/</span><br><span class="line"></span><br><span class="line">clientAgent.sources.s1.fileHeader = <span class="literal">true</span></span><br><span class="line"><span class="comment">#clientAgent.sources.s1.deletePolicy =immediate</span></span><br><span class="line">clientAgent.sources.s1.deletePolicy =never</span><br><span class="line">clientAgent.sources.s1.batchSize =<span class="number">1000</span></span><br><span class="line">clientAgent.sources.s1.channels =c1</span><br><span class="line">clientAgent.sources.s1.deserializer.maxLineLength =<span class="number">1048576</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># clientAgent FileChannel</span></span><br><span class="line">clientAgent.channels.c1.type = file</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查传输及断点续传等验证文件，可原理可参考MR合并小文件的方式</span></span><br><span class="line">clientAgent.channels.c1.checkpointDir = ./spool/checkpoint</span><br><span class="line"></span><br><span class="line"><span class="comment"># 传输数据</span></span><br><span class="line">clientAgent.channels.c1.dataDirs = ./spool/data</span><br><span class="line"></span><br><span class="line">clientAgent.channels.c1.capacity = <span class="number">200000000</span></span><br><span class="line">clientAgent.channels.c1.keep-alive = <span class="number">30</span></span><br><span class="line">clientAgent.channels.c1.write-timeout = <span class="number">30</span></span><br><span class="line">clientAgent.channels.c1.checkpoint-timeout=<span class="number">600</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># clientAgent Sinks</span></span><br><span class="line"><span class="comment"># k1 sink</span></span><br><span class="line">clientAgent.sinks.k1.channel = c1</span><br><span class="line">clientAgent.sinks.k1.type = avro</span><br><span class="line"></span><br><span class="line"><span class="comment"># connect to serverAgent</span></span><br><span class="line">clientAgent.sinks.k1.hostname = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">clientAgent.sinks.k1.port = <span class="number">41415</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># k2 sink</span></span><br><span class="line">clientAgent.sinks.k2.channel = c1</span><br><span class="line">clientAgent.sinks.k2.type = avro</span><br><span class="line"></span><br><span class="line"><span class="comment"># connect to CollectorBackupAgent</span></span><br><span class="line">clientAgent.sinks.k2.hostname = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">clientAgent.sinks.k2.port = <span class="number">41415</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># clientAgent sinks group</span></span><br><span class="line">clientAgent.sinkgroups = g1</span><br><span class="line">clientAgent.sinkgroups.g1.sinks = k1 k2</span><br><span class="line"></span><br><span class="line"><span class="comment"># load_balance type</span></span><br><span class="line">clientAgent.sinkgroups.g1.processor.type = load_balance</span><br><span class="line">clientAgent.sinkgroups.g1.processor.backoff = <span class="literal">true</span></span><br><span class="line">clientAgent.sinkgroups.g1.processor.selector = random</span><br><span class="line">clientAgent.sinkgroups.g1.processor.priority.k1 = <span class="number">10</span></span><br><span class="line">clientAgent.sinkgroups.g1.processor.priority.k2 = <span class="number">9</span></span><br></pre></td></tr></table></figure>
<h1 id="client传输到server">client传输到server</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># clientAgent</span></span><br><span class="line">clientAgent.channels = c1</span><br><span class="line">clientAgent.sources = s1</span><br><span class="line">clientAgent.sinks = k1 k2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># clientAgent Spooling Directory Source</span></span><br><span class="line">clientAgent.sources.s1.type = avro</span><br><span class="line">clientAgent.sources.s1.channels =c1</span><br><span class="line">clientAgent.sources.s1.bind = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">clientAgent.sources.s1.port = <span class="number">44444</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># clientAgent FileChannel</span></span><br><span class="line">clientAgent.channels.c1.type = memory</span><br><span class="line">clientAgent.channels.c1.capacity = <span class="number">200000000</span></span><br><span class="line">clientAgent.channels.c1.keep-alive = <span class="number">30</span></span><br><span class="line">clientAgent.channels.c1.write-timeout = <span class="number">30</span></span><br><span class="line">clientAgent.channels.c1.checkpoint-timeout=<span class="number">600</span></span><br><span class="line">clientAgent.channels.c1.transactionCapacity = <span class="number">1000</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># clientAgent Sinks</span></span><br><span class="line"><span class="comment"># k1 sink</span></span><br><span class="line">clientAgent.sinks.k1.channel = c1</span><br><span class="line">clientAgent.sinks.k1.type = avro</span><br><span class="line"></span><br><span class="line"><span class="comment"># connect to serverAgent</span></span><br><span class="line">clientAgent.sinks.k1.hostname = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">clientAgent.sinks.k1.port = <span class="number">41415</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># k2 sink</span></span><br><span class="line">clientAgent.sinks.k2.channel = c1</span><br><span class="line">clientAgent.sinks.k2.type = avro</span><br><span class="line"></span><br><span class="line"><span class="comment"># connect to CollectorBackupAgent</span></span><br><span class="line">clientAgent.sinks.k2.hostname = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">clientAgent.sinks.k2.port = <span class="number">41415</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># clientAgent sinks group</span></span><br><span class="line">clientAgent.sinkgroups = g1</span><br><span class="line">clientAgent.sinkgroups.g1.sinks = k1 k2</span><br><span class="line"></span><br><span class="line"><span class="comment"># load_balance type</span></span><br><span class="line">clientAgent.sinkgroups.g1.processor.type = load_balance</span><br><span class="line">clientAgent.sinkgroups.g1.processor.backoff = <span class="literal">true</span></span><br><span class="line">clientAgent.sinkgroups.g1.processor.selector = random</span><br><span class="line">clientAgent.sinkgroups.g1.processor.priority.k1 = <span class="number">10</span></span><br><span class="line">clientAgent.sinkgroups.g1.processor.priority.k2 = <span class="number">9</span></span><br></pre></td></tr></table></figure>
<h1 id="server配置">server配置</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># serverAgent</span></span><br><span class="line">serverAgent.channels = c2</span><br><span class="line">serverAgent.sources = s2</span><br><span class="line">serverAgent.sinks =k1 k2</span><br><span class="line"></span><br><span class="line"><span class="comment"># serverAgent AvroSource</span></span><br><span class="line">serverAgent.sources.s2.type = avro</span><br><span class="line">serverAgent.sources.s2.bind = <span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line">serverAgent.sources.s2.port = <span class="number">41415</span></span><br><span class="line">serverAgent.sources.s2.channels = c2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># serverAgent FileChannel</span></span><br><span class="line">serverAgent.channels.c2.type = file</span><br><span class="line">serverAgent.channels.c2.checkpointDir =./spool/checkpoint</span><br><span class="line">serverAgent.channels.c2.dataDirs = ./spool/data</span><br><span class="line">serverAgent.channels.c2.capacity = <span class="number">200000000</span></span><br><span class="line">serverAgent.channels.c2.transactionCapacity=<span class="number">6000</span></span><br><span class="line">serverAgent.channels.c2.checkpointInterval=<span class="number">60000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># serverAgent hdfsSink</span></span><br><span class="line">serverAgent.sinks.k1.type = hdfs</span><br><span class="line">serverAgent.sinks.k1.channel = c2</span><br><span class="line">serverAgent.sinks.k1.hdfs.path = hdfs://localhost:<span class="number">9000</span>/ebuyposp1</span><br><span class="line">serverAgent.sinks.k1.hdfs.filePrefix =k1_%&#123;file&#125;</span><br><span class="line">serverAgent.sinks.k1.hdfs.inUsePrefix =_</span><br><span class="line">serverAgent.sinks.k1.hdfs.inUseSuffix =.tmp</span><br><span class="line">serverAgent.sinks.k1.hdfs.rollSize = <span class="number">0</span></span><br><span class="line">serverAgent.sinks.k1.hdfs.rollCount = <span class="number">0</span></span><br><span class="line">serverAgent.sinks.k1.hdfs.rollInterval = <span class="number">240</span></span><br><span class="line">serverAgent.sinks.k1.hdfs.writeFormat = Text</span><br><span class="line">serverAgent.sinks.k1.hdfs.fileType = DataStream</span><br><span class="line">serverAgent.sinks.k1.hdfs.batchSize = <span class="number">6000</span></span><br><span class="line">serverAgent.sinks.k1.hdfs.callTimeout = <span class="number">60000</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">serverAgent.sinks.k2.type = hdfs</span><br><span class="line">serverAgent.sinks.k2.channel = c2</span><br><span class="line">serverAgent.sinks.k2.hdfs.path = hdfs://localhost:<span class="number">9000</span>/ebuyposp2</span><br><span class="line">serverAgent.sinks.k2.hdfs.filePrefix =k2_%&#123;file&#125;</span><br><span class="line">serverAgent.sinks.k2.hdfs.inUsePrefix =_</span><br><span class="line">serverAgent.sinks.k2.hdfs.inUseSuffix =.tmp</span><br><span class="line">serverAgent.sinks.k2.hdfs.rollSize = <span class="number">0</span></span><br><span class="line">serverAgent.sinks.k2.hdfs.rollCount = <span class="number">0</span></span><br><span class="line">serverAgent.sinks.k2.hdfs.rollInterval = <span class="number">240</span></span><br><span class="line">serverAgent.sinks.k2.hdfs.writeFormat = Text</span><br><span class="line">serverAgent.sinks.k2.hdfs.fileType = DataStream</span><br><span class="line">serverAgent.sinks.k2.hdfs.batchSize = <span class="number">6000</span></span><br><span class="line">serverAgent.sinks.k2.hdfs.callTimeout = <span class="number">60000</span></span><br></pre></td></tr></table></figure>
<h1 id="HUE">HUE</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/cloudera/hue.git</span><br><span class="line">$ <span class="built_in">cd</span> hue</span><br><span class="line">$ make apps</span><br><span class="line">$ build/env/bin/hue runserver</span><br><span class="line">$ build/env/bin/supervisor</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="hadoop">hadoop</h1><p><a href="http://hadoop.apache.org/docs/r1.0.4/cn/">http://hadoop.apache.org/docs/r1.0.4/cn/</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -mkdir /ebuyposp</span><br><span class="line">hdfs dfs -mkdir /ebuyposp2</span><br><span class="line">hdfs dfs -ls /</span><br><span class="line"></span><br><span class="line">hdfs dfs -cat /ebuyposp1/k1_.<span class="number">1462357028642</span></span><br><span class="line">hdfs dfs -rm -r <span class="operator">-f</span> -skipTrash /ebuyposp/*</span><br><span class="line">hdfs dfs -rm -r <span class="operator">-f</span> -skipTrash /ebuyposp2/*</span><br><span class="line">hdfs dfs -rm -r <span class="operator">-f</span> -skipTrash /ebuyposp2</span><br><span class="line">hdfs dfs -rm -r <span class="operator">-f</span> -skipTrash /<span class="built_in">test</span>20160428</span><br></pre></td></tr></table></figure>]]>
    
    </summary>
    
      <category term="flume" scheme="http://linux48.com/tags/flume/"/>
    
      <category term="hadoop" scheme="http://linux48.com/tags/hadoop/"/>
    
      <category term="hdfs" scheme="http://linux48.com/tags/hdfs/"/>
    
      <category term="log4j" scheme="http://linux48.com/tags/log4j/"/>
    
      <category term="大数据" scheme="http://linux48.com/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="大数据" scheme="http://linux48.com/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[数据库维护文本编辑技巧记录]]></title>
    <link href="http://linux48.com//archives/448/"/>
    <id>http://linux48.com//archives/448/</id>
    <published>2016-04-20T16:00:00.000Z</published>
    <updated>2016-05-16T07:29:27.000Z</updated>
    <content type="html"><![CDATA[<p>作为一个非专业数据库维护人员，日常需要处理格式化大量文本来导入数据库，所以本文用以记录平时遇到的每一个记录！</p>
<h1 id="行首行尾加字符或者符号">行首行尾加字符或者符号</h1><blockquote>
<ul>
<li>工具notepad++</li>
</ul>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ctrl+<span class="literal">F</span> 选择替换，并勾选正则表达式</span><br><span class="line"></span><br><span class="line">行首  查找目标<span class="string">"^"</span>  替换为<span class="string">"目的字符串"</span></span><br><span class="line">行尾  查找目标<span class="string">"$"</span>  替换为<span class="string">"目的字符串"</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h1 id="删除大量空白行">删除大量空白行</h1><blockquote>
<ul>
<li>工具notepad++</li>
</ul>
</blockquote>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">方法一（插件处理）：</span><br><span class="line"></span><br><span class="line">先下载安装插件 TextFX，下载后重新启动下，然后在菜单栏找到 TextFX -&gt; TextFX Edit -&gt; Delete blank lines，即可。</span><br><span class="line"></span><br><span class="line">方法二（正则处理）：</span><br><span class="line"></span><br><span class="line">选择替换，把查找模式设置为正则表达式，在查找框中输入 "^<span class="command">\s</span>+"  ,替换框留空，点“全部替换”，即可(先全选)。</span><br><span class="line"></span><br><span class="line">方法三、"<span class="command">\r</span><span class="command">\n</span>"转义符替换（不包括有空格类符号的空行）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">按ctrl+h，跳出搜索替换框，把查找模式定义为扩展（<span class="command">\n</span>，<span class="command">\r</span>…） </span><br><span class="line"></span><br><span class="line">查找目标："<span class="command">\r</span><span class="command">\n</span><span class="command">\r</span><span class="command">\n</span>"  替换为："<span class="command">\r</span><span class="command">\n</span>"</span><br></pre></td></tr></table></figure>
<h1 id="批量替换文本内容导入数据库">批量替换文本内容导入数据库</h1><blockquote>
<ul>
<li>工具linux sed</li>
</ul>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">'1d'</span> /home/mysql/<span class="number">0418</span>.txt    <span class="comment">#删除第一行</span></span><br><span class="line"></span><br><span class="line">sed -i <span class="string">"s/原字符串/新字符串/g"</span></span><br><span class="line"></span><br><span class="line">sed -i <span class="string">"s/,/\t/g"</span> /home/mysql/<span class="number">0418</span>.txt   <span class="comment">#批量替换文本内的“逗号”(,)为“制表符“(Tab)</span></span><br><span class="line"></span><br><span class="line">chown -R mysql.mysql /home/mysql/<span class="number">0418</span>.txt</span><br><span class="line"></span><br><span class="line">LOAD DATA INFILE <span class="string">'/home/mysql/0418.txt'</span> INTO TABLE auth_<span class="built_in">limit</span>_customer(<span class="built_in">limit</span>_cardbin,<span class="built_in">limit</span>_card,<span class="built_in">limit</span>_customer);  <span class="comment">#按照字段顺序导入数据库</span></span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p>作为一个非专业数据库维护人员，日常需要处理格式化大量文本来导入数据库，所以本文用以记录平时遇到的每一个记录！</p>
<h1 id="行首行尾加字符或者符号">行首行尾加字符或者符号</h1><blockquote>
<ul>
<li>工具notepad++</li>
</ul>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ctrl+<span class="literal">F</span> 选择替换，并勾选正则表达式</span><br><span class="line"></span><br><span class="line">行首  查找目标<span class="string">"^"</span>  替换为<span class="string">"目的字符串"</span></span><br><span class="line">行尾  查找目标<span class="string">"$"</span>  替换为<span class="string">"目的字符串"</span></span><br></pre></td></tr></table></figure>]]>
    
    </summary>
    
      <category term="Sublime" scheme="http://linux48.com/tags/Sublime/"/>
    
      <category term="awk" scheme="http://linux48.com/tags/awk/"/>
    
      <category term="cat" scheme="http://linux48.com/tags/cat/"/>
    
      <category term="notepad" scheme="http://linux48.com/tags/notepad/"/>
    
      <category term="sed" scheme="http://linux48.com/tags/sed/"/>
    
      <category term="note" scheme="http://linux48.com/categories/note/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[MySQL查询按IN的顺序输出结果]]></title>
    <link href="http://linux48.com//archives/447/"/>
    <id>http://linux48.com//archives/447/</id>
    <published>2016-04-19T16:00:00.000Z</published>
    <updated>2016-05-16T07:29:27.000Z</updated>
    <content type="html"><![CDATA[<p>在用 SELECT 查询的时候，如果用到了 IN ，那么查询结果中的顺序并不是按照 IN 后面所给的顺序返回，而是按照默认的升序排列。</p>
<p>而如果想要让查询结果按照 IN 里面给的顺序的话，有最简单方法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> </span><br><span class="line">    * </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    a </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">FIELD</span>(</span><br><span class="line">        id,</span><br><span class="line">        <span class="string">'16556004'</span>,</span><br><span class="line">        <span class="string">'16552005'</span>,</span><br><span class="line">        <span class="string">'16558009'</span>,</span><br><span class="line">        <span class="string">'16551033'</span></span><br><span class="line">    )</span></span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p>在用 SELECT 查询的时候，如果用到了 IN ，那么查询结果中的顺序并不是按照 IN 后面所给的顺序返回，而是按照默认的升序排列。</p>
<p>而如果想要让查询结果按照 IN 里面给的顺序的话，有最简单方法：</p>
<figure class="highlight ]]>
    </summary>
    
      <category term="sql语句" scheme="http://linux48.com/tags/sql%E8%AF%AD%E5%8F%A5/"/>
    
      <category term="database" scheme="http://linux48.com/categories/database/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[CISCO ASA5520 HA 配置]]></title>
    <link href="http://linux48.com//archives/446/"/>
    <id>http://linux48.com//archives/446/</id>
    <published>2016-04-13T16:00:00.000Z</published>
    <updated>2016-04-14T07:10:37.000Z</updated>
    <content type="html"><![CDATA[<h1 id="主防火墙配置">主防火墙配置</h1><h2 id="接口配置">接口配置</h2><figure class="highlight monkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">GigabitEthernet0</span>/0</span></span><br><span class="line"> nameif outside</span><br><span class="line"> security-level <span class="number">0</span></span><br><span class="line"> ip address <span class="number">192.168</span>.<span class="number">2.226</span> <span class="number">255.255</span>.<span class="number">255.0</span> standby <span class="number">192.168</span>.<span class="number">2.241</span> </span><br><span class="line">!</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">GigabitEthernet0</span>/1</span></span><br><span class="line"> nameif inside</span><br><span class="line"> security-level <span class="number">100</span></span><br><span class="line"> ip address <span class="number">192.168</span>.<span class="number">100.1</span> <span class="number">255.255</span>.<span class="number">255.0</span> standby <span class="number">192.168</span>.<span class="number">100.4</span> </span><br><span class="line">!             </span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">GigabitEthernet0</span>/2</span></span><br><span class="line"> description STATE Failover <span class="class"><span class="keyword">Interface</span></span></span><br><span class="line">!</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">GigabitEthernet0</span>/3</span></span><br><span class="line"> description LAN Failover <span class="class"><span class="keyword">Interface</span></span></span><br></pre></td></tr></table></figure>
<h2 id="HA配置">HA配置</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">failover</span> lan unit primary</span><br><span class="line"></span><br><span class="line">failover lan interface HA GigabitEthernet0/<span class="number">3</span></span><br><span class="line">failover interface ip HA <span class="number">10.10.10.1</span> <span class="number">255.255.255.0</span> standby <span class="number">10.10.10.2</span></span><br><span class="line"></span><br><span class="line">failover link stateful GigabitEthernet0/<span class="number">2</span></span><br><span class="line">failover interface ip stateful <span class="number">10.10.11.1</span> <span class="number">255.255.255.252</span> standby <span class="number">10.10.11.2</span></span><br><span class="line"></span><br><span class="line">failover</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h1 id="备防火墙配置">备防火墙配置</h1><p><strong>HA配置</strong></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">failover</span> lan unit secondary</span><br><span class="line"></span><br><span class="line">failover lan interface HA GigabitEthernet0/<span class="number">3</span></span><br><span class="line">failover interface ip HA <span class="number">10.10.10.1</span> <span class="number">255.255.255.0</span> standby <span class="number">10.10.10.2</span></span><br><span class="line"></span><br><span class="line">failover link stateful GigabitEthernet0/<span class="number">2</span></span><br><span class="line">failover interface ip stateful <span class="number">10.10.11.1</span> <span class="number">255.255.255.252</span> standby <span class="number">10.10.11.2</span></span><br><span class="line"></span><br><span class="line">failover</span><br></pre></td></tr></table></figure>
<h1 id="结果检查">结果检查</h1><blockquote>
<ul>
<li>show failover</li>
</ul>
</blockquote>
<figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">Failover On </span><br><span class="line">Failover unit Primary</span><br><span class="line">Failover LAN Interface: HA GigabitEthernet0/<span class="number">3</span> <span class="params">(up)</span></span><br><span class="line">Unit Poll frequency <span class="number">1</span> seconds, holdtime <span class="number">15</span> seconds</span><br><span class="line">Interface Poll frequency <span class="number">5</span> seconds, holdtime <span class="number">25</span> seconds</span><br><span class="line">Interface Policy <span class="number">1</span></span><br><span class="line">Monitored Interfaces <span class="number">3</span> of <span class="number">250</span> maximum</span><br><span class="line">Version: Ours <span class="number">8.2</span><span class="params">(<span class="number">1</span>)</span>, Mate <span class="number">8.2</span><span class="params">(<span class="number">1</span>)</span></span><br><span class="line">Last Failover at: <span class="number">03</span>:<span class="number">45</span>:<span class="number">17</span> HKST Dec <span class="number">7</span> <span class="number">2015</span></span><br><span class="line">        This host: Primary - Active </span><br><span class="line">                Active time: <span class="number">98922458</span> <span class="params">(sec)</span></span><br><span class="line">                slot <span class="number">0</span>: ASA5520 hw/sw rev <span class="params">(<span class="number">2.0</span>/<span class="number">8.2</span><span class="params">(<span class="number">1</span>)</span>)</span> status <span class="params">(Up Sys)</span></span><br><span class="line">                  Interface outside <span class="params">(<span class="number">192.168</span>.<span class="number">2.226</span>)</span>: Normal <span class="params">(Waiting)</span></span><br><span class="line">                  Interface inside <span class="params">(<span class="number">192.168</span>.<span class="number">100.1</span>)</span>: Normal <span class="params">(Waiting)</span></span><br><span class="line">                  Interface management <span class="params">(<span class="number">0.0</span>.<span class="number">0.0</span>)</span>: Link Down <span class="params">(Waiting)</span></span><br><span class="line">                slot <span class="number">1</span>: empty</span><br><span class="line">        Other host: Secondary - Standby Ready </span><br><span class="line">                Active time: <span class="number">539</span> <span class="params">(sec)</span></span><br><span class="line">                slot <span class="number">0</span>: ASA5520 hw/sw rev <span class="params">(<span class="number">2.0</span>/<span class="number">8.2</span><span class="params">(<span class="number">1</span>)</span>)</span> status <span class="params">(Up Sys)</span></span><br><span class="line">                  Interface outside <span class="params">(<span class="number">192.168</span>.<span class="number">2.241</span>)</span>: Normal <span class="params">(Waiting)</span></span><br><span class="line">                  Interface inside <span class="params">(<span class="number">192.168</span>.<span class="number">100.4</span>)</span>: Normal <span class="params">(Waiting)</span></span><br><span class="line">                  Interface management <span class="params">(<span class="number">0.0</span>.<span class="number">0.0</span>)</span>: Link Down <span class="params">(Waiting)</span></span><br><span class="line">                slot <span class="number">1</span>: empty</span><br><span class="line"></span><br><span class="line">Stateful Failover Logical Update Statistics</span><br><span class="line">        Link : stateful GigabitEthernet0/<span class="number">2</span> <span class="params">(up)</span></span><br><span class="line">        Stateful Obj    xmit       xerr       rcv        rerr      </span><br><span class="line">        General         <span class="number">19566</span>      <span class="number">0</span>          <span class="number">19</span>         <span class="number">0</span>         </span><br><span class="line">        sys cmd         <span class="number">19</span>         <span class="number">0</span>          <span class="number">19</span>         <span class="number">0</span>         </span><br><span class="line">        up time         <span class="number">0</span>          <span class="number">0</span>          <span class="number">0</span>          <span class="number">0</span>         </span><br><span class="line">        RPC services    <span class="number">0</span>          <span class="number">0</span>          <span class="number">0</span>          <span class="number">0</span>         </span><br><span class="line">        TCP conn        <span class="number">18563</span>      <span class="number">0</span>          <span class="number">0</span>          <span class="number">0</span>         </span><br><span class="line">        UDP conn        <span class="number">699</span>        <span class="number">0</span>          <span class="number">0</span>          <span class="number">0</span>         </span><br><span class="line">        ARP tbl         <span class="number">279</span>        <span class="number">0</span>          <span class="number">0</span>          <span class="number">0</span>         </span><br><span class="line">        Xlate_Timeout   <span class="number">0</span>          <span class="number">0</span>          <span class="number">0</span>          <span class="number">0</span>         </span><br><span class="line">        VPN IKE upd     <span class="number">2</span>          <span class="number">0</span>          <span class="number">0</span>          <span class="number">0</span>         </span><br><span class="line">        VPN IPSEC upd   <span class="number">4</span>          <span class="number">0</span>          <span class="number">0</span>          <span class="number">0</span>         </span><br><span class="line">        VPN CTCP upd    <span class="number">0</span>          <span class="number">0</span>          <span class="number">0</span>          <span class="number">0</span>         </span><br><span class="line">        VPN SDI upd     <span class="number">0</span>          <span class="number">0</span>          <span class="number">0</span>          <span class="number">0</span>         </span><br><span class="line">        VPN DHCP upd    <span class="number">0</span>          <span class="number">0</span>          <span class="number">0</span>          <span class="number">0</span>         </span><br><span class="line">        SIP Session     <span class="number">0</span>          <span class="number">0</span>          <span class="number">0</span>          <span class="number">0</span>         </span><br><span class="line"></span><br><span class="line">        Logical Update Queue Information</span><br><span class="line">                        Cur     Max     Total</span><br><span class="line">        Recv Q:         <span class="number">0</span>       <span class="number">18</span>      <span class="number">154</span></span><br><span class="line">        Xmit Q:         <span class="number">0</span>       <span class="number">1024</span>    <span class="number">22916</span></span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="主防火墙配置">主防火墙配置</h1><h2 id="接口配置">接口配置</h2><figure class="highlight monkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">GigabitEthernet0</span>/0</span></span><br><span class="line"> nameif outside</span><br><span class="line"> security-level <span class="number">0</span></span><br><span class="line"> ip address <span class="number">192.168</span>.<span class="number">2.226</span> <span class="number">255.255</span>.<span class="number">255.0</span> standby <span class="number">192.168</span>.<span class="number">2.241</span> </span><br><span class="line">!</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">GigabitEthernet0</span>/1</span></span><br><span class="line"> nameif inside</span><br><span class="line"> security-level <span class="number">100</span></span><br><span class="line"> ip address <span class="number">192.168</span>.<span class="number">100.1</span> <span class="number">255.255</span>.<span class="number">255.0</span> standby <span class="number">192.168</span>.<span class="number">100.4</span> </span><br><span class="line">!             </span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">GigabitEthernet0</span>/2</span></span><br><span class="line"> description STATE Failover <span class="class"><span class="keyword">Interface</span></span></span><br><span class="line">!</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">GigabitEthernet0</span>/3</span></span><br><span class="line"> description LAN Failover <span class="class"><span class="keyword">Interface</span></span></span><br></pre></td></tr></table></figure>
<h2 id="HA配置">HA配置</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">failover</span> lan unit primary</span><br><span class="line"></span><br><span class="line">failover lan interface HA GigabitEthernet0/<span class="number">3</span></span><br><span class="line">failover interface ip HA <span class="number">10.10.10.1</span> <span class="number">255.255.255.0</span> standby <span class="number">10.10.10.2</span></span><br><span class="line"></span><br><span class="line">failover link stateful GigabitEthernet0/<span class="number">2</span></span><br><span class="line">failover interface ip stateful <span class="number">10.10.11.1</span> <span class="number">255.255.255.252</span> standby <span class="number">10.10.11.2</span></span><br><span class="line"></span><br><span class="line">failover</span><br></pre></td></tr></table></figure>]]>
    
    </summary>
    
      <category term="cisco" scheme="http://linux48.com/tags/cisco/"/>
    
      <category term="ha" scheme="http://linux48.com/tags/ha/"/>
    
      <category term="路由" scheme="http://linux48.com/tags/%E8%B7%AF%E7%94%B1/"/>
    
      <category term="网络交换" scheme="http://linux48.com/categories/%E7%BD%91%E7%BB%9C%E4%BA%A4%E6%8D%A2/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[centos7配置bond和bond跨网段改IP]]></title>
    <link href="http://linux48.com//archives/445/"/>
    <id>http://linux48.com//archives/445/</id>
    <published>2016-04-08T16:00:00.000Z</published>
    <updated>2016-04-09T09:39:04.000Z</updated>
    <content type="html"><![CDATA[<h2 id="一-_centos_7下查看网卡信息">一. centos 7下查看网卡信息</h2><p>命令 ip addr </p>
<p>最小化安装的Centos7系统并没有nano vim wget curl ifconfig lsof命令，这里首先安装一下</p>
<p><code>yum -y install nano vim wget curl net-tools lsof</code></p>
<p>安装后就可以使用ifconfig 等命令</p>
<p>配置bond</p>
<p>服务器有4个网卡分别为 ifcfg-em1 ifcfg-em2 ifcfg-em3 ifcfg-em4 网卡ifcfg-em1和ifcfg-em2配置bond0</p>
<a id="more"></a>
<p>翠花上配置</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> /etc/sysconfig/network-scripts</span><br><span class="line"><span class="keyword">cp</span> ifcfg-em1 ifcfg-bond0</span><br></pre></td></tr></table></figure>
<p>网卡配置<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-em1</span><br><span class="line"></span><br><span class="line"><span class="constant">DEVICE</span>=em1</span><br><span class="line"></span><br><span class="line"><span class="constant">NAME</span>=em1</span><br><span class="line"></span><br><span class="line"><span class="constant">TYPE</span>=Ethernet</span><br><span class="line"></span><br><span class="line"><span class="constant">BOOTPROTO</span>=none</span><br><span class="line"></span><br><span class="line"><span class="constant">ONBOOT</span>=yes</span><br><span class="line"></span><br><span class="line"><span class="constant">MASTER</span>=bond4</span><br><span class="line"></span><br><span class="line"><span class="constant">SLAVE</span>=yes</span><br></pre></td></tr></table></figure></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-em2</span><br><span class="line"></span><br><span class="line"><span class="constant">DEVICE</span>=em2</span><br><span class="line"></span><br><span class="line"><span class="constant">NAME</span>=em2</span><br><span class="line"></span><br><span class="line"><span class="constant">TYPE</span>=Ethernet</span><br><span class="line"></span><br><span class="line"><span class="constant">BOOTPROTO</span>=none</span><br><span class="line"></span><br><span class="line"><span class="constant">ONBOOT</span>=yes</span><br><span class="line"></span><br><span class="line"><span class="constant">MASTER</span>=bond4</span><br><span class="line"></span><br><span class="line"><span class="constant">SLAVE</span>=yes</span><br></pre></td></tr></table></figure>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-bond0</span><br><span class="line"></span><br><span class="line">DEVICE=bond0</span><br><span class="line"></span><br><span class="line">NAME=bond0</span><br><span class="line"></span><br><span class="line">TYPE=Ethernet</span><br><span class="line"></span><br><span class="line">ONBOOT=yes</span><br><span class="line"></span><br><span class="line">BOOTPROTO=none</span><br><span class="line"></span><br><span class="line">BONDING_MASTER=yes  (centos7 下必须有这条命令，和centos6.5的区别)</span><br><span class="line"></span><br><span class="line">IPADDR=<span class="keyword">*</span>.<span class="keyword">*</span>.<span class="keyword">*</span>.<span class="keyword">*</span></span><br><span class="line"></span><br><span class="line">GATEWAY=<span class="keyword">*</span>.<span class="keyword">*</span>.<span class="keyword">*</span>.<span class="keyword">*</span></span><br><span class="line"></span><br><span class="line">NETMASK=<span class="keyword">*</span>.<span class="keyword">*</span>.<span class="keyword">*</span>.<span class="keyword">*</span></span><br><span class="line"></span><br><span class="line">DNS1=<span class="keyword">*</span>.<span class="keyword">*</span>.<span class="keyword">*</span>.<span class="keyword">*</span></span><br><span class="line"></span><br><span class="line">DNS2=<span class="keyword">*</span>.<span class="keyword">*</span>.<span class="keyword">*</span>.<span class="keyword">*</span></span><br><span class="line"></span><br><span class="line">USERCTL=no</span><br><span class="line"></span><br><span class="line">BONDING_OPTS=<span class="string">"mode=1 miimon=100"</span></span><br></pre></td></tr></table></figure>
<p>重启网卡（centos7下重启命令和centos6.5不同）</p>
<p><code>systemctl  restart network</code></p>
<p>bonding状态查看</p>
<p><code>cat /proc/net/bonding/bond0</code></p>
<h2 id="二-关于网卡配置bond后需要更改IP到不同网段简单步骤">二.关于网卡配置bond后需要更改IP到不同网段简单步骤</h2><p>实验说明<br>服务器网卡em1、em2配置bond，IP地址为10.10.10.5<br>网卡em1和em2分别接在交换机SW1和SW2的五号端口在vlan10<br>因网络调整现在需要把交换机5号端口改到vlan20（114.80.218.*段）<br>bond的IP地址改为114.80.218.5</p>
<p>配置思路<br>借助单网卡配置多IP的方法，增加一块虚拟网卡配置上需要更改的新网段IP114.80.218.6<br>重启网卡然后更改交换机配置 划分端口到新valn 20，变更完成后。就可以使用114.80.218.6远程服务器<br>然后在更改ifcfg-bond0的ip为114.80.218.5 随后删除ifcfg-bond0:0 变更完成。<br>配置ifcfg-bond0:0的这种情景，可以应用更改在服务器没有远程管理口，人又不在服务器旁边。<br>但是可以远程管理现有服务器和交换机。万一更改不成功还可以回退。通过原IP远程服务器。</p>
<p>翠花上配置<br><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/sysconfig/network-scripts</span><br><span class="line"></span><br><span class="line">cp ifcfg-bond0 ifcfg-bond0:<span class="number">0</span></span><br><span class="line"></span><br><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-bond0:<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="variable">DEVICE=</span>bond0:<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="variable">NAME=</span>bond0:<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="variable">TYPE=</span>Ethernet</span><br><span class="line"></span><br><span class="line"><span class="variable">ONBOOT=</span>yes</span><br><span class="line"></span><br><span class="line"><span class="variable">BOOTPROTO=</span>none</span><br><span class="line"></span><br><span class="line"><span class="variable">BONDING_MASTER=</span>yes  (centos7 下必须有这条命令，和centos6.<span class="number">5</span>的区别)</span><br><span class="line"></span><br><span class="line"><span class="variable">IPADDR=</span><span class="number">114.80</span>.<span class="number">218.6</span></span><br><span class="line"></span><br><span class="line"><span class="variable">GATEWAY=</span><span class="number">114.80</span>.<span class="number">218.1</span></span><br><span class="line"></span><br><span class="line"><span class="variable">NETMASK=</span><span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line"></span><br><span class="line"><span class="variable">DNS1=</span><span class="number">202.96</span>.<span class="number">209.5</span></span><br><span class="line"></span><br><span class="line"><span class="variable">DNS2=</span><span class="number">202.96</span>.<span class="number">209.133</span></span><br><span class="line"></span><br><span class="line"><span class="variable">USERCTL=</span>no</span><br><span class="line"></span><br><span class="line"><span class="variable">BONDING_OPTS=</span><span class="string">"mode=1 miimon=100"</span></span><br></pre></td></tr></table></figure></p>
<p>重启网卡（centos7下重启命令和centos6.5不同）</p>
<p><code>systemctl  restart network</code></p>
<p>更改交换机配置把5号端口划分到vlan 20</p>
<p>ping 114.80.218.6可以到达</p>
<p>ssh 114.80.218.6 然后更改ifcfg-bond0的ip为114.80.218.5</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-bond0</span><br><span class="line"></span><br><span class="line"><span class="variable">DEVICE=</span>bond0</span><br><span class="line"></span><br><span class="line"><span class="variable">NAME=</span>bond0</span><br><span class="line"></span><br><span class="line"><span class="variable">TYPE=</span>Ethernet</span><br><span class="line"></span><br><span class="line"><span class="variable">ONBOOT=</span>yes</span><br><span class="line"></span><br><span class="line"><span class="variable">BOOTPROTO=</span>none</span><br><span class="line"></span><br><span class="line"><span class="variable">BONDING_MASTER=</span>yes  (centos7 下必须由这条命令，和centos6.<span class="number">5</span>的区别)</span><br><span class="line"></span><br><span class="line"><span class="variable">IPADDR=</span><span class="number">114.80</span>.<span class="number">218.5</span></span><br><span class="line"></span><br><span class="line"><span class="variable">GATEWAY=</span><span class="number">114.80</span>.<span class="number">218.1</span></span><br><span class="line"></span><br><span class="line"><span class="variable">NETMASK=</span><span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line"></span><br><span class="line"><span class="variable">DNS1=</span><span class="number">202.96</span>.<span class="number">209.5</span></span><br><span class="line"></span><br><span class="line"><span class="variable">DNS2=</span><span class="number">202.96</span>.<span class="number">209.133</span></span><br><span class="line"></span><br><span class="line"><span class="variable">USERCTL=</span>no</span><br><span class="line"></span><br><span class="line"><span class="variable">BONDING_OPTS=</span><span class="string">"mode=1 miimon=100"</span></span><br></pre></td></tr></table></figure>
<p>重启网卡（centos7下重启命令和centos6.5不同）</p>
<p><code>systemctl  restart network</code></p>
<p>ssh 114.80.218.5 删除ifcfg-bond0:0</p>
<p><code>cd /etc/sysconfig/network-scripts</code></p>
<p><code>rm -rf ifcfg-bond0:0</code></p>
<p>至此IP变更完成</p>
<p>关于测试<br>ping 114.80.218.5 </p>
<p>关闭交换机sw1的5号端口，没有掉包<br>开启交换机sw1的5号端口，等待端口起来</p>
<p>关闭交换机sw2的5号端口，没有掉包<br>开启交换机sw2的5号端口，等待端口起来<br>一切正常，收工</p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="一-_centos_7下查看网卡信息">一. centos 7下查看网卡信息</h2><p>命令 ip addr </p>
<p>最小化安装的Centos7系统并没有nano vim wget curl ifconfig lsof命令，这里首先安装一下</p>
<p><code>yum -y install nano vim wget curl net-tools lsof</code></p>
<p>安装后就可以使用ifconfig 等命令</p>
<p>配置bond</p>
<p>服务器有4个网卡分别为 ifcfg-em1 ifcfg-em2 ifcfg-em3 ifcfg-em4 网卡ifcfg-em1和ifcfg-em2配置bond0</p>]]>
    
    </summary>
    
      <category term="bond" scheme="http://linux48.com/tags/bond/"/>
    
      <category term="centos" scheme="http://linux48.com/tags/centos/"/>
    
      <category term="centos7" scheme="http://linux48.com/tags/centos7/"/>
    
      <category term="网络" scheme="http://linux48.com/categories/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[CentOS下Nginx配置Perl运行Bugzilla]]></title>
    <link href="http://linux48.com//archives/444/"/>
    <id>http://linux48.com//archives/444/</id>
    <published>2016-02-02T16:00:00.000Z</published>
    <updated>2016-04-09T09:12:49.000Z</updated>
    <content type="html"><![CDATA[<h1 id="安装LNMP">安装LNMP</h1><p>此处省略。。。</p>
<h1 id="安装perl-fcgi模块">安装perl-fcgi模块</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">yum -y install perl-FCGI</span><br><span class="line"></span><br><span class="line"><span class="comment">#或者源码编译安装</span></span><br><span class="line"></span><br><span class="line">wget http://search.cpan.org/CPAN/authors/id/F/FL/FLORA/FCGI-<span class="number">0.74</span>.tar.gz</span><br><span class="line">tar zxvf FCGI-<span class="number">0.74</span>.tar.gz </span><br><span class="line"><span class="built_in">cd</span> FCGI-<span class="number">0.74</span></span><br><span class="line">perl Makefile.PL</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h1 id="新建perl脚本用做fastcgi进程管理，保存为/usr/bin/perl-fastcgi-pl">新建perl脚本用做fastcgi进程管理，保存为/usr/bin/perl-fastcgi.pl</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="shebang">#! /bin/sh</span></span><br><span class="line"><span class="comment">#!/usr/bin/perl</span></span><br><span class="line"> </span><br><span class="line">use FCGI;</span><br><span class="line">use Socket;</span><br><span class="line">use POSIX qw(setsid);</span><br><span class="line"> </span><br><span class="line">require <span class="string">'syscall.ph'</span>;</span><br><span class="line"> </span><br><span class="line">&amp;daemonize;</span><br><span class="line"> </span><br><span class="line"><span class="comment">#this keeps the program alive or something after exec'ing perl scripts</span></span><br><span class="line"><span class="function"><span class="title">END</span></span>() &#123; &#125; <span class="function"><span class="title">BEGIN</span></span>() &#123; &#125;</span><br><span class="line">*CORE::GLOBAL::<span class="built_in">exit</span> = sub &#123; die <span class="string">"fakeexit\nrc="</span>.shift().<span class="string">"\n"</span>; &#125;;</span><br><span class="line"><span class="built_in">eval</span> q&#123;<span class="built_in">exit</span>&#125;;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$@</span>) &#123;</span><br><span class="line">    <span class="built_in">exit</span> unless <span class="variable">$@</span> =~ /^fakeexit/;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">&amp;main;</span><br><span class="line"> </span><br><span class="line">sub <span class="function"><span class="title">daemonize</span></span>() &#123;</span><br><span class="line">    <span class="built_in">chdir</span> <span class="string">'/'</span>                 or die <span class="string">"Can't chdir to /: $!"</span>;</span><br><span class="line">    defined(my <span class="variable">$pid</span> = fork)   or die <span class="string">"Can't fork: $!"</span>;</span><br><span class="line">    <span class="built_in">exit</span> <span class="keyword">if</span> <span class="variable">$pid</span>;</span><br><span class="line">    setsid                    or die <span class="string">"Can't start a new session: $!"</span>;</span><br><span class="line">    <span class="built_in">umask</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">sub main &#123;</span><br><span class="line">    <span class="comment">#$socket = FCGI::OpenSocket( "127.0.0.1:8999", 10 ); #use IP sockets</span></span><br><span class="line">        <span class="variable">$socket</span> = FCGI::OpenSocket( <span class="string">"/tmp/perl-fastcgi.sock"</span>, <span class="number">10</span> ); <span class="comment">#use IP sockets</span></span><br><span class="line">        <span class="variable">$request</span> = FCGI::Request( \*STDIN, \*STDOUT, \*STDERR, \%req_params, <span class="variable">$socket</span> );</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$request</span>) &#123; request_loop()&#125;;</span><br><span class="line">            FCGI::CloseSocket( <span class="variable">$socket</span> );</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">sub request_loop &#123;</span><br><span class="line">        <span class="keyword">while</span>( <span class="variable">$request</span>-&gt;Accept() &gt;= <span class="number">0</span> ) &#123;</span><br><span class="line"> </span><br><span class="line">           <span class="comment">#processing any STDIN input from WebServer (for CGI-POST actions)</span></span><br><span class="line">           <span class="variable">$stdin_passthrough</span> =<span class="string">''</span>;</span><br><span class="line">           <span class="variable">$req_len</span> = <span class="number">0</span> + <span class="variable">$req_params</span>&#123;<span class="string">'CONTENT_LENGTH'</span>&#125;;</span><br><span class="line">           <span class="keyword">if</span> ((<span class="variable">$req_params</span>&#123;<span class="string">'REQUEST_METHOD'</span>&#125; eq <span class="string">'POST'</span>) &amp;&amp; (<span class="variable">$req_len</span> != <span class="number">0</span>) )&#123;</span><br><span class="line">                my <span class="variable">$bytes_read</span> = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">while</span> (<span class="variable">$bytes_read</span> &lt; <span class="variable">$req_len</span>) &#123;</span><br><span class="line">                        my <span class="variable">$data</span> = <span class="string">''</span>;</span><br><span class="line">                        my <span class="variable">$bytes</span> = <span class="built_in">read</span>(STDIN, <span class="variable">$data</span>, (<span class="variable">$req_len</span> - <span class="variable">$bytes_read</span>));</span><br><span class="line">                        last <span class="keyword">if</span> (<span class="variable">$bytes</span> == <span class="number">0</span> || !defined(<span class="variable">$bytes</span>));</span><br><span class="line">                        <span class="variable">$stdin_passthrough</span> .= <span class="variable">$data</span>;</span><br><span class="line">                        <span class="variable">$bytes_read</span> += <span class="variable">$bytes</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="comment">#running the cgi app</span></span><br><span class="line">            <span class="keyword">if</span> ( (-x <span class="variable">$req_params</span>&#123;SCRIPT_FILENAME&#125;) &amp;&amp;  <span class="comment">#can I execute this?</span></span><br><span class="line">                 (<span class="operator">-s</span> <span class="variable">$req_params</span>&#123;SCRIPT_FILENAME&#125;) &amp;&amp;  <span class="comment">#Is this file empty?</span></span><br><span class="line">                 (-r <span class="variable">$req_params</span>&#123;SCRIPT_FILENAME&#125;)     <span class="comment">#can I read this file?</span></span><br><span class="line">            )&#123;</span><br><span class="line">        pipe(CHILD_RD, PARENT_WR);</span><br><span class="line">        my <span class="variable">$pid</span> = open(KID_TO_READ, <span class="string">"-|"</span>);</span><br><span class="line">        unless(defined(<span class="variable">$pid</span>)) &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Content-type: text/plain\r\n\r\n"</span>);</span><br><span class="line">                        <span class="built_in">print</span> <span class="string">"Error: CGI app returned no output - "</span>;</span><br><span class="line">                        <span class="built_in">print</span> <span class="string">"Executing <span class="variable">$req_params</span>&#123;SCRIPT_FILENAME&#125; failed !\n"</span>;</span><br><span class="line">            next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$pid</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            close(CHILD_RD);</span><br><span class="line">            <span class="built_in">print</span> PARENT_WR <span class="variable">$stdin_passthrough</span>;</span><br><span class="line">            close(PARENT_WR);</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">while</span>(my <span class="variable">$s</span> = &lt;KID_TO_READ&gt;) &#123; <span class="built_in">print</span> <span class="variable">$s</span>; &#125;</span><br><span class="line">            close KID_TO_READ;</span><br><span class="line">            waitpid(<span class="variable">$pid</span>, <span class="number">0</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    foreach <span class="variable">$key</span> ( keys %req_params)&#123;</span><br><span class="line">                       <span class="variable">$ENV</span>&#123;<span class="variable">$key</span>&#125; = <span class="variable">$req_params</span>&#123;<span class="variable">$key</span>&#125;;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment"># cd to the script's local directory</span></span><br><span class="line">                    <span class="keyword">if</span> (<span class="variable">$req_params</span>&#123;SCRIPT_FILENAME&#125; =~ /^(.*)\/[^\/]+$/) &#123;</span><br><span class="line">                            <span class="built_in">chdir</span> <span class="variable">$1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"> </span><br><span class="line">            close(PARENT_WR);</span><br><span class="line">            close(STDIN);</span><br><span class="line">            <span class="comment">#fcntl(CHILD_RD, F_DUPFD, 0);</span></span><br><span class="line">            syscall(&amp;SYS_dup2, fileno(CHILD_RD), <span class="number">0</span>);</span><br><span class="line">            <span class="comment">#open(STDIN, "&lt;&amp;CHILD_RD");</span></span><br><span class="line">            <span class="built_in">exec</span>(<span class="variable">$req_params</span>&#123;SCRIPT_FILENAME&#125;);</span><br><span class="line">            die(<span class="string">"exec failed"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"Content-type: text/plain\r\n\r\n"</span>);</span><br><span class="line">                <span class="built_in">print</span> <span class="string">"Error: No such CGI app - <span class="variable">$req_params</span>&#123;SCRIPT_FILENAME&#125; may not "</span>;</span><br><span class="line">                <span class="built_in">print</span> <span class="string">"exist or is not executable by this process.\n"</span>;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="新建init脚本，用于管理perl-fastcgi，保存为/etc/init-d/perl-fastcgi">新建init脚本，用于管理perl-fastcgi，保存为/etc/init.d/perl-fastcgi</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/sh</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># nginx – this script starts and stops the nginx daemon</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># chkconfig: - 85 15</span></span><br><span class="line"><span class="comment"># description: Nginx is an HTTP(S) server, HTTP(S) reverse \</span></span><br><span class="line"><span class="comment"># proxy and IMAP/POP3 proxy server</span></span><br><span class="line"><span class="comment"># processname: nginx</span></span><br><span class="line"><span class="comment"># config: /opt/nginx/conf/nginx.conf</span></span><br><span class="line"><span class="comment"># pidfile: /opt/nginx/logs/nginx.pid</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># Source function library.</span></span><br><span class="line">. /etc/rc.d/init.d/<span class="built_in">functions</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># Source networking configuration.</span></span><br><span class="line">. /etc/sysconfig/network</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Check that networking is up.</span></span><br><span class="line">[ <span class="string">"<span class="variable">$NETWORKING</span>"</span> = <span class="string">"no"</span> ] &amp;&amp; <span class="built_in">exit</span> <span class="number">0</span></span><br><span class="line"> </span><br><span class="line">perlfastcgi=<span class="string">"/usr/bin/perl-fastcgi.pl"</span></span><br><span class="line">prog=$(basename perl)</span><br><span class="line"> </span><br><span class="line">lockfile=/var/lock/subsys/perl-fastcgi</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="title">start</span></span>() &#123;</span><br><span class="line">    [ -x <span class="variable">$perlfastcgi</span> ] || <span class="built_in">exit</span> <span class="number">5</span></span><br><span class="line">    <span class="built_in">echo</span> -n $<span class="string">"Starting <span class="variable">$prog</span>: "</span></span><br><span class="line">    daemon <span class="variable">$perlfastcgi</span></span><br><span class="line">    retval=$?</span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    [ <span class="variable">$retval</span> <span class="operator">-eq</span> <span class="number">0</span> ] &amp;&amp; touch <span class="variable">$lockfile</span></span><br><span class="line">    <span class="built_in">return</span> <span class="variable">$retval</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="title">stop</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> -n $<span class="string">"Stopping <span class="variable">$prog</span>: "</span></span><br><span class="line">    killproc <span class="variable">$prog</span> -QUIT</span><br><span class="line">    retval=$?</span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    [ <span class="variable">$retval</span> <span class="operator">-eq</span> <span class="number">0</span> ] &amp;&amp; rm <span class="operator">-f</span> <span class="variable">$lockfile</span></span><br><span class="line">    <span class="built_in">return</span> <span class="variable">$retval</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="title">restart</span></span>() &#123;</span><br><span class="line">    stop</span><br><span class="line">    start</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="title">reload</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> -n $”Reloading <span class="variable">$prog</span>: ”</span><br><span class="line">    killproc <span class="variable">$nginx</span> -HUP</span><br><span class="line">    RETVAL=$?</span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="title">force_reload</span></span>() &#123;</span><br><span class="line">    restart</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">rh_status</span></span>() &#123;</span><br><span class="line">    status <span class="variable">$prog</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="title">rh_status_q</span></span>() &#123;</span><br><span class="line">    rh_status &gt;/dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line">    start)</span><br><span class="line">        rh_status_q &amp;&amp; <span class="built_in">exit</span> <span class="number">0</span></span><br><span class="line">        <span class="variable">$1</span></span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        rh_status_q || <span class="built_in">exit</span> <span class="number">0</span></span><br><span class="line">        <span class="variable">$1</span></span><br><span class="line">        ;;</span><br><span class="line">    restart)</span><br><span class="line">        <span class="variable">$1</span></span><br><span class="line">        ;;</span><br><span class="line">    reload)</span><br><span class="line">        rh_status_q || <span class="built_in">exit</span> <span class="number">7</span></span><br><span class="line">        <span class="variable">$1</span></span><br><span class="line">        ;;</span><br><span class="line">    force-reload)</span><br><span class="line">        force_reload</span><br><span class="line">        ;;</span><br><span class="line">    status)</span><br><span class="line">        rh_status</span><br><span class="line">        ;;</span><br><span class="line">    condrestart|try-restart)</span><br><span class="line">        rh_status_q || <span class="built_in">exit</span> <span class="number">0</span></span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        <span class="built_in">echo</span> $<span class="string">"Usage: <span class="variable">$0</span> &#123;start|stop|status|restart|condrestart|try-restart|reload|force-reload&#125;"</span></span><br><span class="line">        <span class="built_in">exit</span> <span class="number">2</span></span><br><span class="line">    <span class="keyword">esac</span></span><br></pre></td></tr></table></figure>
<h1 id="启动perl-fastcgi进程：">启动perl-fastcgi进程：</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /usr/bin/perl-fastcgi.pl </span><br><span class="line">chmod <span class="number">755</span> /etc/init.d/perl-fastcgi</span><br><span class="line">/etc/init.d/perl-fastcgi start</span><br><span class="line">chkconfig perl-fastcgi on</span><br></pre></td></tr></table></figure>
<h1 id="Nginx配置：">Nginx配置：</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/<span class="built_in">local</span>/nginx/conf/vhost/bugzilla.com.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  server &#123;</span><br><span class="line">        listen       <span class="number">80</span>;</span><br><span class="line">        server_name bugzilla.e-buychina.com.cn;</span><br><span class="line"></span><br><span class="line">        root   /app/www/bugzilla;</span><br><span class="line">        index  index.cgi index.pl index.html index.htm;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        location ~ .*\.(pl|cgi)$ &#123;</span><br><span class="line">        root /app/www/bugzilla;</span><br><span class="line">                gzip off;</span><br><span class="line">                include fastcgi_params;</span><br><span class="line">                fastcgi_pass  unix:/tmp/perl-fastcgi.sock;</span><br><span class="line">                fastcgi_index index.cgi;</span><br><span class="line">                fastcgi_param  SCRIPT_FILENAME  /<span class="variable">$document_root</span>/<span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h1 id="新建index-pl脚本测试，加x执行权限。">新建index.pl脚本测试，加x执行权限。</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/perl</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">"Content-type: text/html\n\n"</span>;</span><br><span class="line"><span class="built_in">print</span> <span class="string">"&lt;html&gt;&lt;body&gt;Hello, world.&lt;/body&gt;&lt;/html&gt;"</span>;</span><br></pre></td></tr></table></figure>
<p>如果正常就会显示Hello,world.</p>
<h1 id="安装bugzilla">安装bugzilla</h1><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">tar xf bugzilla-<span class="number">5.0</span>.<span class="number">2</span><span class="class">.tar</span><span class="class">.gz</span></span><br><span class="line">cd bugzilla-<span class="number">5.0</span>.<span class="number">1</span></span><br><span class="line">./checksetup<span class="class">.pl</span> --check-modules</span><br><span class="line">perl install-module<span class="class">.pl</span> --all</span><br><span class="line">./checksetup<span class="class">.pl</span></span><br><span class="line">vim localconfig</span><br><span class="line">./checksetup<span class="class">.pl</span></span><br><span class="line">chmod <span class="number">755</span> -R *</span><br></pre></td></tr></table></figure>
<h1 id="bugzilla发邮件">bugzilla发邮件</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">需要的Perl模块</span><br><span class="line">Net::SMTP //perl自带，不用安装</span><br><span class="line">Socket //perl自带，不用安装</span><br><span class="line">Sys::Hostname //perl自带，不用安装</span><br><span class="line">Authen::SASL （用使来验证邮件用户名和密码） //需要安装</span><br><span class="line">使用root身份用如下命令来安装Authen::SASL模块：</span><br><span class="line">root@server ~]<span class="comment"># cpan Authen::SASL</span></span><br><span class="line"></span><br><span class="line">测试模块是否安装：</span><br><span class="line">[root@server1 ~]<span class="comment"># perl -e "use Authen::SASL"</span></span><br><span class="line"></span><br><span class="line">[root@server1 ~]<span class="comment"># //什么也不显示表明模块已经正确安装了。</span></span><br><span class="line"></span><br><span class="line">[root@server1 ~]<span class="comment"># perl -e "use Net::SMTP"</span></span><br><span class="line"></span><br><span class="line">[root@server1 ~]<span class="comment">#</span></span><br><span class="line"></span><br><span class="line">[root@server1 ~]<span class="comment"># perl -e "use Socket"</span></span><br><span class="line"></span><br><span class="line">[root@server1 ~]<span class="comment">#</span></span><br><span class="line"></span><br><span class="line">[root@server1 ~]<span class="comment"># perl -e "use Sys::Hostname"</span></span><br><span class="line"></span><br><span class="line">[root@server1 ~]<span class="comment">#</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim  data/params.json </span><br><span class="line"></span><br><span class="line"><span class="string">'mailfrom'</span> =&gt; <span class="string">'xxx@163.com'</span>,</span><br><span class="line"><span class="string">'smtp_password'</span> =&gt; <span class="string">'***'</span>,</span><br><span class="line"><span class="string">'smtp_username'</span> =&gt; <span class="string">'xxx@163.com'</span>,</span><br><span class="line"><span class="string">'smtpserver'</span> =&gt; <span class="string">'smtp.163.com'</span>,</span><br><span class="line"><span class="string">'urlbase'</span> =&gt; <span class="string">'http://192.168.0.2/bugzilla/'</span>,</span><br></pre></td></tr></table></figure>
<h1 id="bugzilla忘记密码">bugzilla忘记密码</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">SELECT ENCRYPT(<span class="string">'123.com'</span>);</span><br><span class="line"></span><br><span class="line">使用sql 生成 crypt来加密密文,填入数据库密码(cryptpassword)字段  `bugzilladb`.`profiles`表</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="安装LNMP">安装LNMP</h1><p>此处省略。。。</p>
<h1 id="安装perl-fcgi模块">安装perl-fcgi模块</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">yum -y install perl-FCGI</span><br><span class="line"></span><br><span class="line"><span class="comment">#或者源码编译安装</span></span><br><span class="line"></span><br><span class="line">wget http://search.cpan.org/CPAN/authors/id/F/FL/FLORA/FCGI-<span class="number">0.74</span>.tar.gz</span><br><span class="line">tar zxvf FCGI-<span class="number">0.74</span>.tar.gz </span><br><span class="line"><span class="built_in">cd</span> FCGI-<span class="number">0.74</span></span><br><span class="line">perl Makefile.PL</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>]]>
    
    </summary>
    
      <category term="bugzilla" scheme="http://linux48.com/tags/bugzilla/"/>
    
      <category term="cgi" scheme="http://linux48.com/tags/cgi/"/>
    
      <category term="perl" scheme="http://linux48.com/tags/perl/"/>
    
      <category term="devops" scheme="http://linux48.com/categories/devops/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[CentOS上搭建私有maven仓库]]></title>
    <link href="http://linux48.com//archives/443/"/>
    <id>http://linux48.com//archives/443/</id>
    <published>2015-11-11T16:00:00.000Z</published>
    <updated>2016-04-09T09:12:49.000Z</updated>
    <content type="html"><![CDATA[<h1 id="安装JDK">安装JDK</h1><p>此处省略。。。</p>
<h1 id="安装Sonatype_Nexus">安装Sonatype Nexus</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http://download.sonatype.com/nexus/oss/nexus-<span class="number">2.11</span>.<span class="number">1</span>-<span class="number">01</span>-bundle.tar.gz</span><br><span class="line">tar zxvf nexus-<span class="number">2.11</span>.<span class="number">1</span>-<span class="number">01</span>-bundle.tar.gz </span><br><span class="line">mv nexus-<span class="number">2.11</span>.<span class="number">1</span>-<span class="number">01</span> /usr/<span class="built_in">local</span>/nexus</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h1 id="启动文件配置">启动文件配置</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/init.d/</span><br><span class="line">cp /usr/<span class="built_in">local</span>/nexus/bin/nexus nexus</span><br><span class="line">cat /etc/init.d/nexus</span><br><span class="line"></span><br><span class="line"><span class="shebang">#! /bin/sh</span><br><span class="line"></span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Copyright (c) 1999, 2006 Tanuki Software Inc.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Java Service Wrapper sh script.  Suitable for starting and stopping</span></span><br><span class="line"><span class="comment">#  wrapped Java applications on UNIX platforms.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># These settings can be modified to fit the needs of your application</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set this to the root of the Nexus installation</span></span><br><span class="line">NEXUS_HOME=<span class="string">"/usr/local/nexus"</span></span><br><span class="line">PLATFORM=linux-x86-<span class="number">64</span></span><br><span class="line">PLATFORM_DIR=<span class="string">"<span class="variable">$&#123;NEXUS_HOME&#125;</span>/bin/jsw/<span class="variable">$&#123;PLATFORM&#125;</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If specified, the Wrapper will be run as the specified user.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># IMPORTANT - Make sure that the user has the required privileges to write into the Nexus installation directory.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># <span class="doctag"><span class="keyword">NOTE</span></span> - This will set the user which is used to run the Wrapper as well as</span></span><br><span class="line"><span class="comment">#  the JVM and is not useful in situations where a privileged resource or</span></span><br><span class="line"><span class="comment">#  port needs to be allocated prior to the user being changed.</span></span><br><span class="line">RUN_AS_USER=root</span><br><span class="line"></span><br><span class="line"><span class="comment"># Application</span></span><br><span class="line">APP_NAME=<span class="string">"nexus"</span></span><br><span class="line">APP_LONG_NAME=<span class="string">"Nexus OSS"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Priority at which to run the wrapper.  See "man nice" for valid priorities.</span></span><br><span class="line"><span class="comment">#  nice is only used if a priority is specified.</span></span><br><span class="line">PRIORITY=</span><br><span class="line"></span><br><span class="line"><span class="comment"># Location of the pid file.</span></span><br><span class="line"><span class="comment">#PIDDIR="."</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If uncommented, causes the Wrapper to be shutdown using an anchor file.</span></span><br><span class="line"><span class="comment">#  When launched with the 'start' command, it will also ignore all INT and</span></span><br><span class="line"><span class="comment">#  TERM signals.</span></span><br><span class="line"><span class="comment">#IGNORE_SIGNALS=true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The following two lines are used by the chkconfig command. Change as is</span></span><br><span class="line"><span class="comment">#  appropriate for your application.  They should remain commented.</span></span><br><span class="line"><span class="comment"># chkconfig: 2345 20 80</span></span><br><span class="line"><span class="comment"># description: Test Wrapper Sample Application</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Do not modify anything beyond this point</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Get the fully qualified path to the script</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$0</span> <span class="keyword">in</span></span><br><span class="line">    /*)</span><br><span class="line">        SCRIPT=<span class="string">"<span class="variable">$0</span>"</span></span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        PWD=`<span class="built_in">pwd</span>`</span><br><span class="line">        SCRIPT=<span class="string">"<span class="variable">$PWD</span>/<span class="variable">$0</span>"</span></span><br><span class="line">        ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Resolve the true real path without any sym links.</span></span><br><span class="line">CHANGED=<span class="literal">true</span></span><br><span class="line"><span class="keyword">while</span> [ <span class="string">"X<span class="variable">$CHANGED</span>"</span> != <span class="string">"X"</span> ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="comment"># Change spaces to ":" so the tokens can be parsed.</span></span><br><span class="line">    SAFESCRIPT=`<span class="built_in">echo</span> <span class="variable">$SCRIPT</span> | sed <span class="operator">-e</span> <span class="string">'s; ;:;g'</span>`</span><br><span class="line">    <span class="comment"># Get the real path to this script, resolving any symbolic links</span></span><br><span class="line">    TOKENS=`<span class="built_in">echo</span> <span class="variable">$SAFESCRIPT</span> | sed <span class="operator">-e</span> <span class="string">'s;/; ;g'</span>`</span><br><span class="line">    REALPATH=</span><br><span class="line">    <span class="keyword">for</span> C <span class="keyword">in</span> <span class="variable">$TOKENS</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="comment"># Change any ":" in the token back to a space.</span></span><br><span class="line">        C=`<span class="built_in">echo</span> <span class="variable">$C</span> | sed <span class="operator">-e</span> <span class="string">'s;:; ;g'</span>`</span><br><span class="line">        REALPATH=<span class="string">"<span class="variable">$REALPATH</span>/<span class="variable">$C</span>"</span></span><br><span class="line">        <span class="comment"># If REALPATH is a sym link, resolve it.  Loop for nested links.</span></span><br><span class="line">        <span class="keyword">while</span> [ -h <span class="string">"<span class="variable">$REALPATH</span>"</span> ] ; <span class="keyword">do</span></span><br><span class="line">            LS=<span class="string">"`ls -ld "</span><span class="variable">$REALPATH</span><span class="string">"`"</span></span><br><span class="line">            LINK=<span class="string">"`expr "</span><span class="variable">$LS</span><span class="string">" : '.*-&gt; \(.*\)$'`"</span></span><br><span class="line">            <span class="keyword">if</span> expr <span class="string">"<span class="variable">$LINK</span>"</span> : <span class="string">'/.*'</span> &gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">                <span class="comment"># LINK is absolute.</span></span><br><span class="line">                REALPATH=<span class="string">"<span class="variable">$LINK</span>"</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="comment"># LINK is relative.</span></span><br><span class="line">                REALPATH=<span class="string">"`dirname "</span><span class="variable">$REALPATH</span><span class="string">"`"</span><span class="string">"/<span class="variable">$LINK</span>"</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">"<span class="variable">$REALPATH</span>"</span> = <span class="string">"<span class="variable">$SCRIPT</span>"</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        CHANGED=<span class="string">""</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        SCRIPT=<span class="string">"<span class="variable">$REALPATH</span>"</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Change the current directory to the location of the script</span></span><br><span class="line"><span class="built_in">cd</span> <span class="string">"`dirname "</span><span class="variable">$REALPATH</span><span class="string">"`"</span></span><br><span class="line">REALDIR=`<span class="built_in">pwd</span>`</span><br><span class="line"></span><br><span class="line"><span class="comment"># Resolve the location of the 'ps' command</span></span><br><span class="line">PSEXE=<span class="string">"/usr/bin/ps"</span></span><br><span class="line"><span class="keyword">if</span> [ ! -x <span class="string">"<span class="variable">$PSEXE</span>"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    PSEXE=<span class="string">"/bin/ps"</span></span><br><span class="line">    <span class="keyword">if</span> [ ! -x <span class="string">"<span class="variable">$PSEXE</span>"</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"Unable to locate 'ps'."</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"Please report this message along with the location of the command on your system."</span></span><br><span class="line">        <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Resolve the os</span></span><br><span class="line">DIST_OS=`uname <span class="operator">-s</span> | tr [:upper:] [:lower:] | tr <span class="operator">-d</span> [:blank:]`</span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$DIST_OS</span>"</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">'sunos'</span>)</span><br><span class="line">        DIST_OS=<span class="string">"solaris"</span></span><br><span class="line">        PSEXE=<span class="string">"/usr/ucb/ps"</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">'hp-ux'</span> | <span class="string">'hp-ux64'</span>)</span><br><span class="line">        DIST_OS=<span class="string">"hpux"</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">'darwin'</span>)</span><br><span class="line">        DIST_OS=<span class="string">"macosx"</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">'unix_sv'</span>)</span><br><span class="line">        DIST_OS=<span class="string">"unixware"</span></span><br><span class="line">        ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Resolve the architecture</span></span><br><span class="line">DIST_ARCH=`uname -p | tr [:upper:] [:lower:] | tr <span class="operator">-d</span> [:blank:]`</span><br><span class="line">DIST_BITS=<span class="number">32</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$DIST_ARCH</span>"</span> = <span class="string">"unknown"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    DIST_ARCH=`uname -m | tr [:upper:] [:lower:] | tr <span class="operator">-d</span> [:blank:]`</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$DIST_ARCH</span>"</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">'athlon'</span> | <span class="string">'ia32'</span> | <span class="string">'i386'</span> | <span class="string">'i486'</span> | <span class="string">'i586'</span> | <span class="string">'i686'</span>)</span><br><span class="line">        DIST_ARCH=<span class="string">"x86"</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">'amd64'</span> | <span class="string">'x86_64'</span> | <span class="string">'ia64'</span>)</span><br><span class="line">        DIST_ARCH=<span class="string">"x86"</span></span><br><span class="line">        DIST_BITS=<span class="number">64</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">'ip27'</span>)</span><br><span class="line">        DIST_ARCH=<span class="string">"mips"</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">'power'</span> | <span class="string">'powerpc'</span> | <span class="string">'power_pc'</span>)</span><br><span class="line">        DIST_ARCH=<span class="string">"ppc"</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">'ppc64'</span>)</span><br><span class="line">        DIST_ARCH=<span class="string">"ppc"</span></span><br><span class="line">        DIST_BITS=<span class="number">64</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">'pa_risc'</span> | <span class="string">'pa-risc'</span>)</span><br><span class="line">        DIST_ARCH=<span class="string">"parisc"</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">'sun4u'</span> | <span class="string">'sparcv9'</span>)</span><br><span class="line">        DIST_ARCH=<span class="string">"sparc"</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">'9000/800'</span>)</span><br><span class="line">        DIST_ARCH=<span class="string">"parisc"</span></span><br><span class="line">        ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Extra architecture detection</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$DIST_OS</span>"</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">'macosx'</span>)</span><br><span class="line">        <span class="keyword">if</span> [ `sysctl hw.cpu64bit_capable | awk <span class="string">'&#123; print $2 &#125;'</span>` = <span class="string">'1'</span> ]; <span class="keyword">then</span></span><br><span class="line">            DIST_BITS=<span class="number">64</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        DIST_ARCH=<span class="string">'universal'</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">'aix'</span>)</span><br><span class="line">        DIST_BITS=`getconf KERNEL_BITMODE`</span><br><span class="line">        ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">outputFile</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="operator">-f</span> <span class="string">"<span class="variable">$1</span>"</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"  <span class="variable">$1</span> (Found but not executable.)"</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"  <span class="variable">$1</span>"</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Test if NEXUS_HOME is relative (does not start with /). If relative it should be relative to this script location</span></span><br><span class="line">FIRST_CHAR=`<span class="built_in">echo</span> <span class="variable">$NEXUS_HOME</span> | cut -c1,<span class="number">1</span>`</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$FIRST_CHAR</span>"</span> != <span class="string">"/"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    NEXUS_HOME=<span class="variable">$REALDIR</span>/<span class="variable">$NEXUS_HOME</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Default PIDDIR to os/arch/bits directory</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"X<span class="variable">$PIDDIR</span>"</span> = <span class="string">"X"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    PIDDIR=<span class="string">"bin/jsw/<span class="variable">$DIST_OS</span>-<span class="variable">$DIST_ARCH</span>-<span class="variable">$DIST_BITS</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If the PIDDIR is relative, set its value relative to the full NEXUS_HOME to avoid problems if</span></span><br><span class="line"><span class="comment">#  the working directory is later changed.</span></span><br><span class="line">FIRST_CHAR=`<span class="built_in">echo</span> <span class="variable">$PIDDIR</span> | cut -c1,<span class="number">1</span>`</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$FIRST_CHAR</span>"</span> != <span class="string">"/"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    PIDDIR=<span class="variable">$NEXUS_HOME</span>/<span class="variable">$PIDDIR</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Process ID</span></span><br><span class="line">ANCHORFILE=<span class="string">"<span class="variable">$PIDDIR</span>/<span class="variable">$APP_NAME</span>.anchor"</span></span><br><span class="line">PIDFILE=<span class="string">"<span class="variable">$PIDDIR</span>/<span class="variable">$APP_NAME</span>.pid"</span></span><br><span class="line">LOCKDIR=<span class="string">"/var/lock/subsys"</span></span><br><span class="line">LOCKFILE=<span class="string">"<span class="variable">$LOCKDIR</span>/<span class="variable">$APP_NAME</span>"</span></span><br><span class="line">pid=<span class="string">""</span></span><br><span class="line"></span><br><span class="line">WRAPPER_CMD=<span class="string">"<span class="variable">$&#123;PLATFORM_DIR&#125;</span>/wrapper"</span></span><br><span class="line"><span class="keyword">if</span> [ ! -x <span class="string">"<span class="variable">$WRAPPER_CMD</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Missing platform binary: <span class="variable">$WRAPPER_CMD</span>"</span></span><br><span class="line">    <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">WRAPPER_CONF=<span class="string">"<span class="variable">$&#123;PLATFORM_DIR&#125;</span>/../conf/wrapper.conf"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Build the nice clause</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"X<span class="variable">$PRIORITY</span>"</span> = <span class="string">"X"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    CMDNICE=<span class="string">""</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    CMDNICE=<span class="string">"nice -<span class="variable">$PRIORITY</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Build the anchor file clause.</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"X<span class="variable">$IGNORE_SIGNALS</span>"</span> = <span class="string">"X"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   ANCHORPROP=</span><br><span class="line">   IGNOREPROP=</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   ANCHORPROP=wrapper.anchorfile=\<span class="string">"<span class="variable">$ANCHORFILE</span>\"</span><br><span class="line">   IGNOREPROP=wrapper.ignore_signals=TRUE</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># Build the lock file clause.  Only create a lock file if the lock directory exists on this platform.</span><br><span class="line">LOCKPROP=</span><br><span class="line">if [ -d <span class="variable">$LOCKDIR</span> ]</span><br><span class="line">then</span><br><span class="line">    if [ -w <span class="variable">$LOCKDIR</span> ]</span><br><span class="line">    then</span><br><span class="line">        LOCKPROP=wrapper.lockfile=\"<span class="variable">$LOCKFILE</span>\"</span><br><span class="line">    fi</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">checkUser() &#123;</span><br><span class="line">    # <span class="variable">$1</span> touchLock flag</span><br><span class="line">    # <span class="variable">$2</span> command</span><br><span class="line"></span><br><span class="line">    # Resolve the location of the 'id' command</span><br><span class="line">    IDEXE="</span>/usr/xpg4/bin/id<span class="string">"</span><br><span class="line">    if [ ! -x "</span><span class="variable">$IDEXE</span><span class="string">" ]</span><br><span class="line">    then</span><br><span class="line">        IDEXE="</span>/usr/bin/id<span class="string">"</span><br><span class="line">        if [ ! -x "</span><span class="variable">$IDEXE</span><span class="string">" ]</span><br><span class="line">        then</span><br><span class="line">            echo "</span>Unable to locate <span class="string">'id'</span>.<span class="string">"</span><br><span class="line">            echo "</span>Please report this message along with the location of the <span class="built_in">command</span> on your system.<span class="string">"</span><br><span class="line">            exit 1</span><br><span class="line">        fi</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    # Check the configured user.  If necessary rerun this script as the desired user.</span><br><span class="line">    if [ "</span>X<span class="variable">$RUN_AS_USER</span><span class="string">" != "</span>X<span class="string">" ]</span><br><span class="line">    then</span><br><span class="line">        if [ "</span>`<span class="variable">$IDEXE</span> -u -n`<span class="string">" != "</span><span class="variable">$RUN_AS_USER</span><span class="string">" ]</span><br><span class="line">        then</span><br><span class="line">            # If LOCKPROP and <span class="variable">$RUN_AS_USER</span> are defined then the new user will most likely not be</span><br><span class="line">            # able to create the lock file.  The Wrapper will be able to update this file once it</span><br><span class="line">            # is created but will not be able to delete it on shutdown.  If <span class="variable">$2</span> is defined then</span><br><span class="line">            # the lock file should be created for the current command</span><br><span class="line">            if [ "</span>X<span class="variable">$LOCKPROP</span><span class="string">" != "</span>X<span class="string">" ]</span><br><span class="line">            then</span><br><span class="line">                if [ "</span>X<span class="variable">$1</span><span class="string">" != "</span>X<span class="string">" ]</span><br><span class="line">                then</span><br><span class="line">                    # Resolve the primary group </span><br><span class="line">                    RUN_AS_GROUP=`groups <span class="variable">$RUN_AS_USER</span> | awk '&#123;print <span class="variable">$3</span>&#125;' | tail -1`</span><br><span class="line">                    if [ "</span>X<span class="variable">$RUN_AS_GROUP</span><span class="string">" = "</span>X<span class="string">" ]</span><br><span class="line">                    then</span><br><span class="line">                        RUN_AS_GROUP=<span class="variable">$RUN_AS_USER</span></span><br><span class="line">                    fi</span><br><span class="line">                    touch <span class="variable">$LOCKFILE</span></span><br><span class="line">                    chown <span class="variable">$RUN_AS_USER</span>:<span class="variable">$RUN_AS_GROUP</span> <span class="variable">$LOCKFILE</span></span><br><span class="line">                fi</span><br><span class="line">            fi</span><br><span class="line">    </span><br><span class="line">            # Still want to change users, recurse.  This means that the user will only be</span><br><span class="line">            #  prompted for a password once. Variables shifted by 1</span><br><span class="line">            su - <span class="variable">$RUN_AS_USER</span> -c "</span>\<span class="string">"<span class="variable">$REALPATH</span>\" <span class="variable">$2</span>"</span></span><br><span class="line">    </span><br><span class="line">            <span class="comment"># Now that we are the original user again, we may need to clean up the lock file.</span></span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">"X<span class="variable">$LOCKPROP</span>"</span> != <span class="string">"X"</span> ]</span><br><span class="line">            <span class="keyword">then</span></span><br><span class="line">                getpid</span><br><span class="line">                <span class="keyword">if</span> [ <span class="string">"X<span class="variable">$pid</span>"</span> = <span class="string">"X"</span> ]</span><br><span class="line">                <span class="keyword">then</span></span><br><span class="line">                    <span class="comment"># Wrapper is not running so make sure the lock file is deleted.</span></span><br><span class="line">                    <span class="keyword">if</span> [ <span class="operator">-f</span> <span class="string">"<span class="variable">$LOCKFILE</span>"</span> ]</span><br><span class="line">                    <span class="keyword">then</span></span><br><span class="line">                        rm <span class="string">"<span class="variable">$LOCKFILE</span>"</span></span><br><span class="line">                    <span class="keyword">fi</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">    </span><br><span class="line">            <span class="built_in">exit</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Check that script is not run as root</span></span><br><span class="line">    LUID=`<span class="variable">$IDEXE</span> -u`</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$LUID</span> <span class="operator">-eq</span> <span class="number">0</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"****************************************"</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"WARNING - NOT RECOMMENDED TO RUN AS ROOT"</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"****************************************"</span></span><br><span class="line">        <span class="keyword">if</span> [ ! <span class="string">"`<span class="variable">$IDEXE</span> -u -n`"</span> = <span class="string">"<span class="variable">$RUN_AS_USER</span>"</span> ]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">"If you insist running as root, then set the environment variable RUN_AS_USER=root before running this script."</span></span><br><span class="line">            <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">getpid</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="operator">-f</span> <span class="string">"<span class="variable">$PIDFILE</span>"</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">if</span> [ -r <span class="string">"<span class="variable">$PIDFILE</span>"</span> ]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            pid=`cat <span class="string">"<span class="variable">$PIDFILE</span>"</span>`</span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">"X<span class="variable">$pid</span>"</span> != <span class="string">"X"</span> ]</span><br><span class="line">            <span class="keyword">then</span></span><br><span class="line">                <span class="comment"># It is possible that 'a' process with the pid exists but that it is not the</span></span><br><span class="line">                <span class="comment">#  correct process.  This can happen in a number of cases, but the most</span></span><br><span class="line">                <span class="comment">#  common is during system startup after an unclean shutdown.</span></span><br><span class="line">                <span class="comment"># The ps statement below looks for the specific wrapper command running as</span></span><br><span class="line">                <span class="comment">#  the pid.  If it is not found then the pid file is considered to be stale.</span></span><br><span class="line">                <span class="keyword">case</span> <span class="string">"<span class="variable">$DIST_OS</span>"</span> <span class="keyword">in</span></span><br><span class="line">                    <span class="string">'macosx'</span>)</span><br><span class="line">                        pidtest=`<span class="variable">$PSEXE</span> -ww -p <span class="variable">$pid</span> -o <span class="built_in">command</span> | grep <span class="string">"wrapper.pidfile"</span> | tail -<span class="number">1</span>`</span><br><span class="line">                        ;;</span><br><span class="line">                    <span class="string">'solaris'</span>)</span><br><span class="line">                        pidtest=`<span class="variable">$PSEXE</span> ww <span class="variable">$pid</span> | grep <span class="string">"wrapper.pidfile"</span> | tail -<span class="number">1</span>`</span><br><span class="line">                        ;;</span><br><span class="line">                    *)</span><br><span class="line">                        pidtest=`<span class="variable">$PSEXE</span> -p <span class="variable">$pid</span> -o args | grep <span class="string">"wrapper.pidfile"</span> | tail -<span class="number">1</span>`</span><br><span class="line">                        ;;</span><br><span class="line">                <span class="keyword">esac</span></span><br><span class="line">                <span class="keyword">if</span> [ <span class="string">"X<span class="variable">$pidtest</span>"</span> = <span class="string">"X"</span> ]</span><br><span class="line">                <span class="keyword">then</span></span><br><span class="line">                    <span class="comment"># This is a stale pid file.</span></span><br><span class="line">                    rm <span class="operator">-f</span> <span class="string">"<span class="variable">$PIDFILE</span>"</span></span><br><span class="line">                    <span class="built_in">echo</span> <span class="string">"Removed stale pid file: <span class="variable">$PIDFILE</span>"</span></span><br><span class="line">                    pid=<span class="string">""</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">"Cannot read <span class="variable">$PIDFILE</span>."</span></span><br><span class="line">            <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">testpid</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">"<span class="variable">$DIST_OS</span>"</span> = <span class="string">"solaris"</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        pid=`<span class="variable">$PSEXE</span> ww <span class="variable">$pid</span> | grep <span class="variable">$pid</span> | grep -v grep | awk <span class="string">'&#123;print $1&#125;'</span> | tail -<span class="number">1</span>`</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        pid=`<span class="variable">$PSEXE</span> -p <span class="variable">$pid</span> | grep <span class="variable">$pid</span> | grep -v grep | awk <span class="string">'&#123;print $1&#125;'</span> | tail -<span class="number">1</span>`</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">"X<span class="variable">$pid</span>"</span> = <span class="string">"X"</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="comment"># Process is gone so remove the pid file.</span></span><br><span class="line">        rm <span class="operator">-f</span> <span class="string">"<span class="variable">$PIDFILE</span>"</span></span><br><span class="line">        pid=<span class="string">""</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">console</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Running <span class="variable">$APP_LONG_NAME</span>..."</span></span><br><span class="line">    getpid</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">"X<span class="variable">$pid</span>"</span> = <span class="string">"X"</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="comment"># The string passed to eval must handles spaces in paths correctly.</span></span><br><span class="line">        COMMAND_LINE=<span class="string">"<span class="variable">$CMDNICE</span> \"<span class="variable">$WRAPPER_CMD</span>\" \"<span class="variable">$WRAPPER_CONF</span>\" wrapper.syslog.ident=<span class="variable">$APP_NAME</span> wrapper.pidfile=\"<span class="variable">$PIDFILE</span>\" <span class="variable">$ANCHORPROP</span> <span class="variable">$LOCKPROP</span>"</span></span><br><span class="line">        <span class="built_in">eval</span> <span class="variable">$COMMAND_LINE</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"<span class="variable">$APP_LONG_NAME</span> is already running."</span></span><br><span class="line">        <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="title">start</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Starting <span class="variable">$APP_LONG_NAME</span>..."</span></span><br><span class="line">    getpid</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">"X<span class="variable">$pid</span>"</span> = <span class="string">"X"</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="comment"># The string passed to eval must handles spaces in paths correctly.</span></span><br><span class="line">        COMMAND_LINE=<span class="string">"<span class="variable">$CMDNICE</span> \"<span class="variable">$WRAPPER_CMD</span>\" \"<span class="variable">$WRAPPER_CONF</span>\" wrapper.syslog.ident=<span class="variable">$APP_NAME</span> wrapper.pidfile=\"<span class="variable">$PIDFILE</span>\" wrapper.daemonize=TRUE <span class="variable">$ANCHORPROP</span> <span class="variable">$IGNOREPROP</span> <span class="variable">$LOCKPROP</span>"</span></span><br><span class="line">        <span class="built_in">eval</span> <span class="variable">$COMMAND_LINE</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"<span class="variable">$APP_LONG_NAME</span> is already running."</span></span><br><span class="line">        <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    getpid</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">"X<span class="variable">$pid</span>"</span> != <span class="string">"X"</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"Started <span class="variable">$APP_LONG_NAME</span>."</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"Failed to start <span class="variable">$APP_LONG_NAME</span>."</span></span><br><span class="line">    <span class="keyword">fi</span>    </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="title">stopit</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Stopping <span class="variable">$APP_LONG_NAME</span>..."</span></span><br><span class="line">    getpid</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">"X<span class="variable">$pid</span>"</span> = <span class="string">"X"</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"<span class="variable">$APP_LONG_NAME</span> was not running."</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="string">"X<span class="variable">$IGNORE_SIGNALS</span>"</span> = <span class="string">"X"</span> ]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            <span class="comment"># Running so try to stop it.</span></span><br><span class="line">            <span class="built_in">kill</span> <span class="variable">$pid</span></span><br><span class="line">            <span class="keyword">if</span> [ $? <span class="operator">-ne</span> <span class="number">0</span> ]</span><br><span class="line">            <span class="keyword">then</span></span><br><span class="line">                <span class="comment"># An explanation for the failure should have been given</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">"Unable to stop <span class="variable">$APP_LONG_NAME</span>."</span></span><br><span class="line">                <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            rm <span class="operator">-f</span> <span class="string">"<span class="variable">$ANCHORFILE</span>"</span></span><br><span class="line">            <span class="keyword">if</span> [ <span class="operator">-f</span> <span class="string">"<span class="variable">$ANCHORFILE</span>"</span> ]</span><br><span class="line">            <span class="keyword">then</span></span><br><span class="line">                <span class="comment"># An explanation for the failure should have been given</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">"Unable to stop <span class="variable">$APP_LONG_NAME</span>."</span></span><br><span class="line">                <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># We can not predict how long it will take for the wrapper to</span></span><br><span class="line">        <span class="comment">#  actually stop as it depends on settings in wrapper.conf.</span></span><br><span class="line">        <span class="comment">#  Loop until it does.</span></span><br><span class="line">        savepid=<span class="variable">$pid</span></span><br><span class="line">        CNT=<span class="number">0</span></span><br><span class="line">        TOTCNT=<span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> [ <span class="string">"X<span class="variable">$pid</span>"</span> != <span class="string">"X"</span> ]</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">            <span class="comment"># Show a waiting message every 5 seconds.</span></span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">"<span class="variable">$CNT</span>"</span> <span class="operator">-lt</span> <span class="string">"5"</span> ]</span><br><span class="line">            <span class="keyword">then</span></span><br><span class="line">                CNT=`expr <span class="variable">$CNT</span> + <span class="number">1</span>`</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">"Waiting for <span class="variable">$APP_LONG_NAME</span> to exit..."</span></span><br><span class="line">                CNT=<span class="number">0</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            TOTCNT=`expr <span class="variable">$TOTCNT</span> + <span class="number">1</span>`</span><br><span class="line"></span><br><span class="line">            sleep <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            testpid</span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">        pid=<span class="variable">$savepid</span></span><br><span class="line">        testpid</span><br><span class="line">        <span class="keyword">if</span> [ <span class="string">"X<span class="variable">$pid</span>"</span> != <span class="string">"X"</span> ]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">"Failed to stop <span class="variable">$APP_LONG_NAME</span>."</span></span><br><span class="line">            <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">"Stopped <span class="variable">$APP_LONG_NAME</span>."</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">status</span></span>() &#123;</span><br><span class="line">    getpid</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">"X<span class="variable">$pid</span>"</span> = <span class="string">"X"</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"<span class="variable">$APP_LONG_NAME</span> is not running."</span></span><br><span class="line">        <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"<span class="variable">$APP_LONG_NAME</span> is running (<span class="variable">$pid</span>)."</span></span><br><span class="line">        <span class="built_in">exit</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">dump</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Dumping <span class="variable">$APP_LONG_NAME</span>..."</span></span><br><span class="line">    getpid</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">"X<span class="variable">$pid</span>"</span> = <span class="string">"X"</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"<span class="variable">$APP_LONG_NAME</span> was not running."</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">kill</span> -<span class="number">3</span> <span class="variable">$pid</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> [ $? <span class="operator">-ne</span> <span class="number">0</span> ]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">"Failed to dump <span class="variable">$APP_LONG_NAME</span>."</span></span><br><span class="line">            <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">"Dumped <span class="variable">$APP_LONG_NAME</span>."</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">    <span class="string">'console'</span>)</span><br><span class="line">        checkUser touchlock <span class="variable">$1</span></span><br><span class="line">        console</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">    <span class="string">'start'</span>)</span><br><span class="line">        checkUser touchlock <span class="variable">$1</span></span><br><span class="line">        start</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">    <span class="string">'stop'</span>)</span><br><span class="line">        checkUser <span class="string">""</span> <span class="variable">$1</span></span><br><span class="line">        stopit</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">    <span class="string">'restart'</span>)</span><br><span class="line">        checkUser touchlock <span class="variable">$1</span></span><br><span class="line">        stopit</span><br><span class="line">        start</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">    <span class="string">'status'</span>)</span><br><span class="line">        checkUser <span class="string">""</span> <span class="variable">$1</span></span><br><span class="line">        status</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">    <span class="string">'dump'</span>)</span><br><span class="line">        checkUser <span class="string">""</span> <span class="variable">$1</span></span><br><span class="line">        dump</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">    *)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$0</span> &#123; console | start | stop | restart | status | dump &#125;"</span></span><br><span class="line">        <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line">        ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<h1 id="验证和配置Nexus">验证和配置Nexus</h1><p><code>/etc/init.d/nexus start</code></p>
<p>nexus安装完成以后，一般在路径： <a href="http://sever_ip:8081/nexus/" target="_blank" rel="external">http://sever_ip:8081/nexus/</a> </p>
<p>打开以后会出现配置管理页面，说明安装成功了。点击右上角“Log in”，输入用户名和密码（默认用户名：admin密码：admin123）登录。</p>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="安装JDK">安装JDK</h1><p>此处省略。。。</p>
<h1 id="安装Sonatype_Nexus">安装Sonatype Nexus</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http://download.sonatype.com/nexus/oss/nexus-<span class="number">2.11</span>.<span class="number">1</span>-<span class="number">01</span>-bundle.tar.gz</span><br><span class="line">tar zxvf nexus-<span class="number">2.11</span>.<span class="number">1</span>-<span class="number">01</span>-bundle.tar.gz </span><br><span class="line">mv nexus-<span class="number">2.11</span>.<span class="number">1</span>-<span class="number">01</span> /usr/<span class="built_in">local</span>/nexus</span><br></pre></td></tr></table></figure>]]>
    
    </summary>
    
      <category term="maven" scheme="http://linux48.com/tags/maven/"/>
    
      <category term="devops" scheme="http://linux48.com/categories/devops/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[mysql中查看数据库中所有表的记录数]]></title>
    <link href="http://linux48.com//archives/442/"/>
    <id>http://linux48.com//archives/442/</id>
    <published>2015-10-29T16:00:00.000Z</published>
    <updated>2016-04-09T09:12:49.000Z</updated>
    <content type="html"><![CDATA[<p>如果想知道MySQL数据库中每个表占用的空间、表记录的行数的话，可以打开MySQL的 information_schema 数据库。在该库中有一个 TABLES 表，这个表主要字段分别是：</p>
<blockquote>
<ul>
<li>TABLE_SCHEMA : 数据库名</li>
<li>TABLE_NAME：表名</li>
<li>ENGINE：所使用的存储引擎</li>
<li>TABLES_ROWS：记录数</li>
<li>DATA_LENGTH：数据大小</li>
<li>INDEX_LENGTH：索引大小</li>
</ul>
</blockquote>
<p>其他字段请参考MySQL的手册，一下是利用这几个字段查询详情演示，可以根据具体业务来自定义sql监控mysql的磁盘使用状态和数据库各个表的具体条数。</p>
<a id="more"></a>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">select table_schema,table_name,table_rows from tables where TABLE_SCHEMA='ebuydb' order by table_rows desc ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--查询所有数据的大小</span><br><span class="line">use information_schema;</span><br><span class="line">select concat(round(sum(DATA_LENGTH/1024/1024), 2),'MB') as data from TABLES;</span><br><span class="line"></span><br><span class="line">--查询单个库占用空间</span><br><span class="line">select concat(round(sum(DATA_LENGTH/1024/1024), 2),'MB') as data from TABLES where TABLE_SCHEMA='ebuydb';</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--数据库总所占空间</span><br><span class="line"></span><br><span class="line">SELECT CONCAT(TRUNCATE(SUM(data_length)/1024/1024,2),'MB') AS data_size,</span><br><span class="line">CONCAT(TRUNCATE(SUM(max_data_length)/1024/1024,2),'MB') AS max_data_size,</span><br><span class="line">CONCAT(TRUNCATE(SUM(data_free)/1024/1024,2),'MB') AS data_free,</span><br><span class="line">CONCAT(TRUNCATE(SUM(index_length)/1024/1024,2),'MB') AS index_size，</span><br><span class="line">FROM information_schema.tables WHERE TABLE_SCHEMA = '数据库名';</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--数据库表占用空间明细</span><br><span class="line">SELECT TABLE_NAME, table_rows,</span><br><span class="line">CONCAT(TRUNCATE(SUM(data_length)/1024/1024,2),'MB') AS data_size,</span><br><span class="line">CONCAT(TRUNCATE(SUM(max_data_length)/1024/1024,2),'MB') AS max_data_size,</span><br><span class="line">CONCAT(TRUNCATE(SUM(data_free)/1024/1024,2),'MB') AS data_free,</span><br><span class="line">CONCAT(TRUNCATE(SUM(index_length)/1024/1024,2),'MB') AS index_size，</span><br><span class="line">FROM information_schema.tables WHERE TABLE_SCHEMA = '数据库名'</span><br><span class="line">group by TABLE_NAME   order by data_length desc;</span><br><span class="line"></span><br><span class="line">--表所占空间</span><br><span class="line"></span><br><span class="line">SELECT CONCAT(TRUNCATE(SUM(data_length)/1024/1024,2),'MB') AS data_size,</span><br><span class="line">CONCAT(TRUNCATE(SUM(max_data_length)/1024/1024,2),'MB') AS max_data_size,</span><br><span class="line">CONCAT(TRUNCATE(SUM(data_free)/1024/1024,2),'MB') AS data_free,</span><br><span class="line">CONCAT(TRUNCATE(SUM(index_length)/1024/1024,2),'MB') AS index_size</span><br><span class="line">FROM information_schema.tables WHERE TABLE_NAME = '表名';</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--查看指定数据库的表的大小，比如说数据库 forexpert 中的 member 表 </span><br><span class="line"></span><br><span class="line">select concat(round(sum(DATA_LENGTH/1024/1024),2),'MB')as data</span><br><span class="line">from TABLES where table_schema='test'</span><br><span class="line">and table_name='1023';</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; select TABLE_NAME, concat(truncate(data_length/1024/1024,2),' MB') as data_size,   concat(truncate(index_length/1024/1024,2),' MB') as index_size   from information_schema.tables where TABLE_SCHEMA = 'test'   group by TABLE_NAME   order by data_length desc;         </span><br><span class="line">+-------------------------+-----------+------------+</span><br><span class="line">| TABLE_NAME              | data_size | index_size |</span><br><span class="line">+-------------------------+-----------+------------+</span><br><span class="line">| 1023                    | 152.68 MB | 0.00 MB    |</span><br><span class="line">| gc1_3                   | 18.54 MB  | 9.54 MB    |</span><br><span class="line">| gc6_8                   | 14.51 MB  | 7.51 MB    |</span><br><span class="line">| gc4_5                   | 12.51 MB  | 6.51 MB    |</span><br><span class="line">| tongyi1_3               | 11.51 MB  | 5.51 MB    |</span><br><span class="line">| tongyi6_8               | 9.51 MB   | 4.51 MB    |</span><br><span class="line">| tongyi4_5               | 8.51 MB   | 4.51 MB    |</span><br><span class="line">| 1023_2                  | 1.51 MB   | 0.00 MB    |</span><br><span class="line">| code                    | 0.14 MB   | 0.09 MB    |</span><br><span class="line">| 1023_3                  | 0.06 MB   | 0.00 MB    |</span><br><span class="line">+-------------------------+-----------+------------+</span><br><span class="line">10 rows in set (0.01 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; select TABLE_SCHEMA, concat(truncate(sum(data_length)/1024/1024,2),' MB') as data_size,   concat(truncate(sum(index_length)/1024/1024,2),'MB') as index_size   from information_schema.tables  group by TABLE_SCHEMA  order by data_length desc;  </span><br><span class="line"></span><br><span class="line">+-------------------------+--------------+------------+</span><br><span class="line">| TABLE_SCHEMA            | data_size    | index_size |</span><br><span class="line">+-------------------------+--------------+------------+</span><br><span class="line">| test                    | 234.68 MB    | 39.42MB    |</span><br><span class="line">| zabbix                  | 1.78 MB      | 2.70MB     |</span><br><span class="line">| information_schema      | 0.00 MB      | 0.00MB     |</span><br><span class="line">| performance_schema      | 0.00 MB      | 0.00MB     |</span><br><span class="line">| mysql                   | 0.58 MB      | 0.10MB     |</span><br><span class="line">+-------------------------+--------------+------------+</span><br><span class="line">5 rows in set (0.54 sec)</span><br><span class="line"></span><br><span class="line">--查看更加明细</span><br><span class="line">mysql&gt; USE information_schema;</span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; SELECT TABLE_NAME, table_rows,</span><br><span class="line">    -&gt; CONCAT(TRUNCATE(SUM(data_length)/1024/1024,2),'MB') AS data_size,</span><br><span class="line">    -&gt; CONCAT(TRUNCATE(SUM(max_data_length)/1024/1024,2),'MB') AS max_data_size,</span><br><span class="line">    -&gt; CONCAT(TRUNCATE(SUM(data_free)/1024/1024,2),'MB') AS data_free,</span><br><span class="line">    -&gt; CONCAT(TRUNCATE(SUM(index_length)/1024/1024,2),'MB') AS index_size</span><br><span class="line">    -&gt; FROM information_schema.tables  WHERE TABLE_NAME NOT LIKE "%history"</span><br><span class="line">    -&gt; AND TABLE_SCHEMA = 'test'</span><br><span class="line">    -&gt; GROUP BY TABLE_NAME   ORDER BY data_length DESC;</span><br><span class="line">+-------------------------+------------+-----------+---------------+-----------+------------+</span><br><span class="line">| TABLE_NAME              | table_rows | data_size | max_data_size | data_free | index_size |</span><br><span class="line">+-------------------------+------------+-----------+---------------+-----------+------------+</span><br><span class="line">| 1023                    |    3351704 | 152.68MB  | 0.00MB        | 7.00MB    | 0.00MB     |</span><br><span class="line">| gc1_3                   |     323649 | 18.54MB   | 0.00MB        | 4.00MB    | 9.54MB     |</span><br><span class="line">| gc6_8                   |     256131 | 14.51MB   | 0.00MB        | 4.00MB    | 7.51MB     |</span><br><span class="line">| gc4_5                   |     219582 | 12.51MB   | 0.00MB        | 4.00MB    | 6.51MB     |</span><br><span class="line">| tongyi1_3               |     184609 | 11.51MB   | 0.00MB        | 4.00MB    | 5.51MB     |</span><br><span class="line">| tongyi6_8               |     150028 | 9.51MB    | 0.00MB        | 4.00MB    | 4.51MB     |</span><br><span class="line">| tongyi4_5               |     132087 | 8.51MB    | 0.00MB        | 4.00MB    | 4.51MB     |</span><br><span class="line">| 1023_2                  |      14619 | 1.51MB    | 0.00MB        | 4.00MB    | 0.00MB     |</span><br><span class="line">| code                    |       2241 | 0.14MB    | 0.00MB        | 0.00MB    | 0.09MB     |</span><br><span class="line">| 1023_3                  |        833 | 0.06MB    | 0.00MB        | 0.00MB    | 0.00MB     |</span><br><span class="line">+-------------------------+------------+-----------+---------------+-----------+------------+</span><br><span class="line">10 rows in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>
<p>参考：</p>
<p>BYTE(B):字节<br>1KB ，2 的 10 次方 ： 1024 BYTE.<br>1MB ，2 的 20 次方 ： 1024 KB.<br>1GB ，2 的 30 次方 ： 1024 MB.<br>1TB ，2 的 40 次方 ： 1024 GB.<br>1PB ，2 的 50 次方 ： 1024 TB.<br>1EB ，2 的 60 次方 ： 1024 PB.<br>1ZB ，2 的 70 次方 ： 1024 EB.<br>1YB ，2 的 80 次方 ： 1024 ZB.</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>如果想知道MySQL数据库中每个表占用的空间、表记录的行数的话，可以打开MySQL的 information_schema 数据库。在该库中有一个 TABLES 表，这个表主要字段分别是：</p>
<blockquote>
<ul>
<li>TABLE_SCHEMA : 数据库名</li>
<li>TABLE_NAME：表名</li>
<li>ENGINE：所使用的存储引擎</li>
<li>TABLES_ROWS：记录数</li>
<li>DATA_LENGTH：数据大小</li>
<li>INDEX_LENGTH：索引大小</li>
</ul>
</blockquote>
<p>其他字段请参考MySQL的手册，一下是利用这几个字段查询详情演示，可以根据具体业务来自定义sql监控mysql的磁盘使用状态和数据库各个表的具体条数。</p>]]>
    
    </summary>
    
      <category term="mysql" scheme="http://linux48.com/tags/mysql/"/>
    
      <category term="database" scheme="http://linux48.com/categories/database/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[zabbix的proxy端安装配置]]></title>
    <link href="http://linux48.com//archives/441/"/>
    <id>http://linux48.com//archives/441/</id>
    <published>2015-10-28T16:00:00.000Z</published>
    <updated>2016-04-09T09:12:49.000Z</updated>
    <content type="html"><![CDATA[<p>zabbix proxy可以代替zabbix server检索客户端的数据，然后把数据汇报给zabbix server，并且在一定程度上分担了zabbix server的压力。zabbix proxy可以非常简便的实现了集中式、分布式监控。</p>
<p>zabbix proxy使用场景:</p>
<blockquote>
<ul>
<li>监控远程区域设备</li>
<li>监控本地网络不稳定区域</li>
<li>当zabbix监控上千设备时，使用它来减轻server的压力</li>
<li>简化zabbix的维护</li>
</ul>
</blockquote>
<a id="more"></a>
<p>简易top如下</p>
<p><img src="http://r.loli.io/emamqy.png" alt=""></p>
<p>zabbix proxy仅仅需要一条tcp连接到zabbix server,所以防火墙上仅仅需要加上一条规则即可，zabbix proxy数据库必须和server分开，否则数据会被破坏，毕竟这两个数据库的表大部分都相同。总之记住，数据库分开即可。<br>proxy收集到数据之后，首先将数据缓存在本地，然后在一定得时间之后传递给zabbix server，这个时间由proxy配置文件中参数ProxyLocalBuffer and ProxyOfflineBuffer决定.<br>zabbix proxy是一个数据收集器，它不计算触发器、不处理事件、不发送报警。</p>
<h2 id="安装搭建zabbix_proxy">安装搭建zabbix proxy</h2><p>安装mysql此处省略</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum -y install curl curl-devel net-snmp net-snmp-devel perl-DBI</span><br><span class="line">tar zxvf zabbix-<span class="number">2.4</span>.<span class="number">5</span>.tar.gz </span><br><span class="line"><span class="built_in">cd</span> zabbix-<span class="number">2.4</span>.<span class="number">5</span></span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/zabbix_proxy --enable-proxy --enable-agent --with-mysql=/usr/<span class="built_in">local</span>/mysql/bin/mysql_config --with-net-snmp --with-libcurl</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<h2 id="建立数据库并授权">建立数据库并授权</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">create</span> <span class="keyword">database</span> zabbix <span class="built_in">character</span> <span class="keyword">set</span> utf8;</span></span><br><span class="line"><span class="operator"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> zabbix.* <span class="keyword">to</span> zabbix@localhost <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'zabbix'</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span></span><br></pre></td></tr></table></figure>
<p>导入数据结构：</p>
<p><code>mysql -uzabbix -p&#39;zabbix&#39; zabbix &lt; database/mysql/schema.sql</code></p>
<p>需要注意的是proxy不需要导入data.sql 和 images.sql 这两份SQL，否则会有问题</p>
<h2 id="配置zabbix_proxy">配置zabbix proxy</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@server]<span class="comment"># cat /usr/local/zabbix_proxy/etc/zabbix_proxy.conf |grep -v "#"</span></span><br><span class="line">ProxyMode=<span class="number">1</span></span><br><span class="line">Server=<span class="number">10.10</span>.<span class="number">3.222</span></span><br><span class="line">Hostname=<span class="number">10.10</span>.<span class="number">3.225</span></span><br><span class="line">LogFile=/tmp/zabbix_proxy.log</span><br><span class="line">DBHost=<span class="number">10.10</span>.<span class="number">3.222</span></span><br><span class="line">DBName=zabbix</span><br><span class="line">DBUser=zabbix</span><br><span class="line">DBPassword=zabbix</span><br><span class="line">DBSocket=/data/mysql/mysql.sock </span><br><span class="line">DBPort=<span class="number">3306</span></span><br><span class="line">ConfigFrequency=<span class="number">60</span></span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>proxyMode 是代理模式，一会在zabbix server的web里面配置会有选择，0是主动模式，1是被动模式,我使1被动模式</li>
<li>Server 是指定zabbix Server 的地址</li>
<li>Hostname 是指定proxy的名称，一会在zabbix server的web配置里填的名称要和这个一样</li>
<li>ConfigFrequency 这个是server和proxy两端配置同步的时间间隔，server和proxy要设定同一个值才好，默认是3600，我想配置同步快一点，改成60</li>
</ul>
</blockquote>
<h2 id="启动zabbix_proxy">启动zabbix proxy</h2><p>启动守护进程agent</p>
<p><code>/usr/local/zabbix_proxy/sbin/zabbix_proxy</code></p>
<p>zabbix_proxy启动端口为10051</p>
<p>iptables放行zabbix_proxy的10051端口</p>
<p><code>iptables -A INPUT -p tcp --dport 10051 -j ACCEPT</code></p>
<p>注：重启服务可直接kill掉zabbix进程再重新按照以上方法启动</p>
<p>或配置开机启动脚本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> zabbix-<span class="number">2.4</span>.<span class="number">5</span></span><br><span class="line">cp misc/init.d/tru64/zabbix_proxy   /etc/init.d/zabbix_proxy</span><br><span class="line">chmod <span class="number">755</span> /etc/init.d/zabbix_proxy</span><br><span class="line">vi /etc/init.d/zabbix_proxy</span><br><span class="line">在文件头部的<span class="comment">#!/bin/sh行下分别添加如下两行：</span></span><br><span class="line">--------------</span><br><span class="line"><span class="comment">#chkconfig: 35 95 95</span></span><br><span class="line"><span class="comment">#description:zabbix_proxy</span></span><br><span class="line">--------------</span><br><span class="line">将DAEMON后面的参数改成你自定义的路径</span><br><span class="line">DAEMON=/usr/<span class="built_in">local</span>/zabbix_proxy/sbin/zabbix_proxy</span><br></pre></td></tr></table></figure>
<p>加入开机启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --add zabbix_proxy</span><br><span class="line">chkconfig zabbix_proxy on</span><br></pre></td></tr></table></figure>
<p>重启服务：</p>
<p><code>service zabbix_proxy restart</code></p>
<h2 id="添加zabbix_proxy节点">添加zabbix proxy节点</h2><p><img src="http://r.loli.io/Uf2qau.png" alt=""></p>
<h2 id="添加被监控的主机">添加被监控的主机</h2><p>添加被监控的主机勾选<strong>由系统代理程式监控</strong></p>
<p><img src="http://r6.loli.io/iiENna.png" alt=""></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>zabbix proxy可以代替zabbix server检索客户端的数据，然后把数据汇报给zabbix server，并且在一定程度上分担了zabbix server的压力。zabbix proxy可以非常简便的实现了集中式、分布式监控。</p>
<p>zabbix proxy使用场景:</p>
<blockquote>
<ul>
<li>监控远程区域设备</li>
<li>监控本地网络不稳定区域</li>
<li>当zabbix监控上千设备时，使用它来减轻server的压力</li>
<li>简化zabbix的维护</li>
</ul>
</blockquote>]]>
    
    </summary>
    
      <category term="zabbix" scheme="http://linux48.com/tags/zabbix/"/>
    
      <category term="监控" scheme="http://linux48.com/categories/%E7%9B%91%E6%8E%A7/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[zabbix的agent端安装配置]]></title>
    <link href="http://linux48.com//archives/440/"/>
    <id>http://linux48.com//archives/440/</id>
    <published>2015-10-27T16:00:00.000Z</published>
    <updated>2016-04-09T09:12:49.000Z</updated>
    <content type="html"><![CDATA[<h2 id="下载zabbix">下载zabbix</h2><h2 id="安装zabbix所需的组件">安装zabbix所需的组件</h2><p><code>yum -y install curl curl-devel net-snmp net-snmp-devel perl-DBI</code></p>
<h2 id="创建用户账号">创建用户账号</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">groupadd zabbix</span><br><span class="line">useradd -g zabbix zabbix</span><br><span class="line">usermod <span class="operator">-s</span> /sbin/nologin zabbix</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h2 id="编译安装(agent)">编译安装(agent)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar zxvf zabbix-<span class="number">2.4</span>.<span class="number">5</span>.tar.gz </span><br><span class="line"><span class="built_in">cd</span> zabbix-<span class="number">2.4</span>.<span class="number">5</span></span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/zabbix-agent --enable-agent  --enable-ipv6 --with-net-snmp --with-libcurl</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<h2 id="编辑agent端配置文件">编辑agent端配置文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@Server2 ~]<span class="comment"># cat /usr/local/zabbix-agent/etc/zabbix_agentd.conf |grep -v "#"</span></span><br><span class="line">LogFile=/tmp/zabbix_agentd.log</span><br><span class="line">Server=<span class="number">10.10</span>.<span class="number">3.225</span></span><br><span class="line">ServerActive=<span class="number">10.10</span>.<span class="number">3.225</span>:<span class="number">10051</span></span><br><span class="line">Hostname=<span class="number">10.128</span>.<span class="number">0.81</span></span><br></pre></td></tr></table></figure>
<h2 id="启动守护进程agent">启动守护进程agent</h2><p><code>/usr/local/zabbix-agent/sbin/zabbix_agentd</code></p>
<p>server启动端口为10051</p>
<p>iptables放行zabbix-agent的10051端口</p>
<p><code>iptables -A INPUT -p tcp  --dport 10051 -j ACCEPT</code></p>
<p>注：重启服务可直接kill掉zabbix进程再重新按照以上方法启动</p>
<p>或配置开机启动脚本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> zabbix-<span class="number">2.4</span>.<span class="number">5</span></span><br><span class="line">cp misc/init.d/tru64/zabbix_agentd   /etc/init.d/zabbix_agentd</span><br><span class="line">chmod <span class="number">755</span> /etc/init.d/zabbix_agentd</span><br><span class="line">vi /etc/init.d/zabbix_agentd</span><br><span class="line">在文件头部的<span class="comment">#!/bin/sh行下分别添加如下两行：</span></span><br><span class="line">--------------</span><br><span class="line"><span class="comment">#chkconfig: 35 95 95</span></span><br><span class="line"><span class="comment">#description:zabbix agent</span></span><br><span class="line">--------------</span><br><span class="line">将DAEMON后面的参数改成你自定义的路径</span><br><span class="line">DAEMON=/usr/<span class="built_in">local</span>/zabbix-agent/sbin/zabbix_agentd</span><br></pre></td></tr></table></figure>
<p>加入开机启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --add zabbix_agentd  </span><br><span class="line">chkconfig zabbix_agentd on</span><br></pre></td></tr></table></figure>
<p>重启服务：</p>
<p><code>service zabbix_agentd restart</code></p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="下载zabbix">下载zabbix</h2><h2 id="安装zabbix所需的组件">安装zabbix所需的组件</h2><p><code>yum -y install curl curl-devel net-snmp net-snmp-devel perl-DBI</code></p>
<h2 id="创建用户账号">创建用户账号</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">groupadd zabbix</span><br><span class="line">useradd -g zabbix zabbix</span><br><span class="line">usermod <span class="operator">-s</span> /sbin/nologin zabbix</span><br></pre></td></tr></table></figure>]]>
    
    </summary>
    
      <category term="zabbix" scheme="http://linux48.com/tags/zabbix/"/>
    
      <category term="监控" scheme="http://linux48.com/categories/%E7%9B%91%E6%8E%A7/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[mysql求平均值、最小和总值]]></title>
    <link href="http://linux48.com//archives/439/"/>
    <id>http://linux48.com//archives/439/</id>
    <published>2015-10-26T16:00:00.000Z</published>
    <updated>2016-04-09T09:12:49.000Z</updated>
    <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE TABLE sales_rep(</span><br><span class="line">    -&gt;   employee_number INT,</span><br><span class="line">    -&gt;   surname VARCHAR(<span class="number">40</span>),</span><br><span class="line">    -&gt;   first_name VARCHAR(<span class="number">30</span>),</span><br><span class="line">    -&gt;   commission TINYINT</span><br><span class="line">    -&gt; );</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; INSERT INTO sales_rep values(<span class="number">4</span>,<span class="string">'Rive'</span>,<span class="string">'Mongane'</span>,<span class="number">10</span>);</span><br><span class="line">Query OK, <span class="number">1</span> row affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; INSERT INTO sales_rep values(<span class="number">5</span>,<span class="string">'Smith'</span>,<span class="string">'Mike'</span>,<span class="number">12</span>);</span><br><span class="line">Query OK, <span class="number">1</span> row affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT AVG(commission) FROM sales_rep;</span><br><span class="line">+-----------------+</span><br><span class="line">| AVG(commission) |</span><br><span class="line">+-----------------+</span><br><span class="line">|         <span class="number">11.0000</span> |</span><br><span class="line">+-----------------+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line">--//以上是AVG()函数的用法，可以换成MIN()、SUM()函数，用来求最小值，求和。</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class=]]>
    </summary>
    
      <category term="mysql" scheme="http://linux48.com/tags/mysql/"/>
    
      <category term="database" scheme="http://linux48.com/categories/database/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[mysql取每隔一小时数据]]></title>
    <link href="http://linux48.com//archives/438/"/>
    <id>http://linux48.com//archives/438/</id>
    <published>2015-10-20T16:00:00.000Z</published>
    <updated>2016-04-09T09:12:49.000Z</updated>
    <content type="html"><![CDATA[<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> </span><br><span class="line">    <span class="keyword">HOUR</span>(<span class="string">`input_date`</span>) <span class="keyword">AS</span> <span class="keyword">HOUR</span>,</span><br><span class="line">    <span class="keyword">COUNT</span>(<span class="number">1</span>) <span class="keyword">AS</span> 交易笔数,</span><br><span class="line">    brand_name_cn <span class="keyword">AS</span> 品牌,</span><br><span class="line">    <span class="keyword">DATE_FORMAT</span>(<span class="string">`input_date`</span>, <span class="string">'%m%d'</span>) <span class="keyword">AS</span> 交易日期 </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    test.<span class="string">`1023`</span> </span><br><span class="line"><span class="keyword">WHERE</span> input_date &gt;= <span class="number">20150930000000</span> </span><br><span class="line">    <span class="keyword">AND</span> input_date &lt;= <span class="number">20150930235959</span> </span><br><span class="line">    <span class="keyword">AND</span> brand_name_cn = <span class="string">'统一星巴克'</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">HOUR</span> ;</span></span><br></pre></td></tr></table></figure>
<p>格式化日期</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> </span><br><span class="line">    <span class="keyword">HOUR</span>(<span class="string">`input_time`</span>) <span class="keyword">AS</span> <span class="keyword">HOUR</span>,</span><br><span class="line">    <span class="keyword">COUNT</span>(<span class="number">1</span>) <span class="keyword">AS</span> <span class="keyword">COUNT</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    <span class="string">`table_name`</span> </span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">DATE_FORMAT</span>(<span class="string">`input_time`</span>, <span class="string">'%Y-%m-%d'</span>) = <span class="string">'2015-10-21'</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">HOUR</span>(<span class="string">`input_time`</span>) ;</span></span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="]]>
    </summary>
    
      <category term="mysql" scheme="http://linux48.com/tags/mysql/"/>
    
      <category term="database" scheme="http://linux48.com/categories/database/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[mysql You cant specify target table]]></title>
    <link href="http://linux48.com//archives/437/"/>
    <id>http://linux48.com//archives/437/</id>
    <published>2015-10-07T16:00:00.000Z</published>
    <updated>2016-04-09T09:12:49.000Z</updated>
    <content type="html"><![CDATA[<p>今天在写SQL语句的时候遇到一个比较特殊的问题。<br>mysql 语句如下:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">UPDATE</span> </span><br><span class="line">  pms_project_product </span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">  area_list = </span><br><span class="line">  (<span class="keyword">SELECT</span> </span><br><span class="line">    area_list </span><br><span class="line">  <span class="keyword">FROM</span></span><br><span class="line">    pms_project_product </span><br><span class="line">  <span class="keyword">WHERE</span> activity_product_id = <span class="number">48468</span>),</span><br><span class="line">  area_list_name = </span><br><span class="line">  (<span class="keyword">SELECT</span> </span><br><span class="line">    area_list_name </span><br><span class="line">  <span class="keyword">FROM</span></span><br><span class="line">    pms_project_product </span><br><span class="line">  <span class="keyword">WHERE</span> activity_product_id = <span class="number">48468</span>) </span><br><span class="line"><span class="keyword">WHERE</span> activity_product_id = <span class="number">47098</span> ;</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>运行时提出如下提示： <strong> You can’t specify target table ‘pms_project_product’ for update in FROM clause </strong></p>
<p>运行 set 里面的 select 语句:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span></span><br><span class="line">         area_list</span><br><span class="line">       <span class="keyword">FROM</span></span><br><span class="line">         pms_project_product</span><br><span class="line">       <span class="keyword">WHERE</span> activity_product_id = <span class="number">48468</span></span></span><br></pre></td></tr></table></figure>
<p>可以正确 select 正确结果。再把结果直接写到 <strong> SET area_list = </strong>里面，改后语句如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">UPDATE</span> </span><br><span class="line">  pms_project_product </span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">  area_list = (***),</span><br><span class="line">  area_list_name = (***) </span><br><span class="line"><span class="keyword">WHERE</span> activity_product_id = <span class="number">47098</span></span></span><br></pre></td></tr></table></figure>
<p>再运行可以正确执行更新。</p>
<p>原因是：mysql中不能这么用。 （等待mysql升级吧）。那串英文错误提示就是说，不能先select出同一表中的某些值，</p>
<p>再update这个表(在同一语句中)。 于是我打算改用临时表的方案。</p>
<p>改写后的 sql 如下所示，大家仔细区别一下。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">UPDATE</span> </span><br><span class="line">  pms_project_product </span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">  area_list = </span><br><span class="line">  (<span class="keyword">SELECT</span> </span><br><span class="line">    tmp1.area_list </span><br><span class="line">  <span class="keyword">FROM</span></span><br><span class="line">    (<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> pms_project_product) tmp1</span><br><span class="line">  <span class="keyword">WHERE</span> tmp1.activity_product_id = <span class="number">48468</span>),</span><br><span class="line">  area_list_name = </span><br><span class="line">  (<span class="keyword">SELECT</span> </span><br><span class="line">    tmp2.area_list_name </span><br><span class="line">  <span class="keyword">FROM</span></span><br><span class="line">    (<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> pms_project_product) tmp2 </span><br><span class="line">  <span class="keyword">WHERE</span> tmp2.activity_product_id = <span class="number">48468</span>) </span><br><span class="line"><span class="keyword">WHERE</span> activity_product_id = <span class="number">47098</span></span></span><br></pre></td></tr></table></figure>
<p>也就是说将select出的结果再通过临时表在select一遍，这样就规避了错误。注意，这个问题只出现于mysql，mssql和oracle不会出现此问题。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>今天在写SQL语句的时候遇到一个比较特殊的问题。<br>mysql 语句如下:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">UPDATE</span> </span><br><span class="line">  pms_project_product </span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">  area_list = </span><br><span class="line">  (<span class="keyword">SELECT</span> </span><br><span class="line">    area_list </span><br><span class="line">  <span class="keyword">FROM</span></span><br><span class="line">    pms_project_product </span><br><span class="line">  <span class="keyword">WHERE</span> activity_product_id = <span class="number">48468</span>),</span><br><span class="line">  area_list_name = </span><br><span class="line">  (<span class="keyword">SELECT</span> </span><br><span class="line">    area_list_name </span><br><span class="line">  <span class="keyword">FROM</span></span><br><span class="line">    pms_project_product </span><br><span class="line">  <span class="keyword">WHERE</span> activity_product_id = <span class="number">48468</span>) </span><br><span class="line"><span class="keyword">WHERE</span> activity_product_id = <span class="number">47098</span> ;</span></span><br></pre></td></tr></table></figure>]]>
    
    </summary>
    
      <category term="mysql" scheme="http://linux48.com/tags/mysql/"/>
    
      <category term="database" scheme="http://linux48.com/categories/database/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[阵列Cache写机制：Write-through与Write-back]]></title>
    <link href="http://linux48.com//archives/436/"/>
    <id>http://linux48.com//archives/436/</id>
    <published>2015-08-26T16:00:00.000Z</published>
    <updated>2016-05-25T08:32:09.000Z</updated>
    <content type="html"><![CDATA[<blockquote class="blockquote-center">Write Through和Write Back是阵列卡Cache的两种使用方式，也称为透写和回写。当选用write through方式时，系统的写磁盘操作并不利用阵列卡的Cache，而是直接与磁盘进行数据的交互。而write Back方式则利用阵列Cache作为系统与磁盘间的二传手，系统先将数据交给Cache，然后再由Cache将数据传给磁盘。</blockquote>

<a id="more"></a>
<p>最近在部署马来西亚DBServer的时候发现DB1的硬盘写入速度比DB2要慢好多</p>
<p><img src="http://r.loli.io/VnUZ7n.png" alt=""></p>
<p><img src="http://r.loli.io/Yj6Zbm.png" alt=""></p>
<p>两台服务器在导入数据的过程中对硬盘测速结果如下</p>
<p><img src="http://r.loli.io/vYj2ye.png" alt=""></p>
<p><img src="http://r.loli.io/BniYFf.png" alt=""></p>
<p>机房给出的解释也是一切正常</p>
<p>后来老大帮忙推荐MegaCli工具去排查问题所在</p>
<p>发现DB1的Cache写机制为Write-through而DB2为Write-back</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@DBServer1 MegaCli]<span class="comment"># ./MegaCli64 -Ldinfo -lall -aall</span></span><br><span class="line">                                     </span><br><span class="line"></span><br><span class="line">Adapter <span class="number">0</span> -- Virtual Drive Information:</span><br><span class="line">Virtual Drive: <span class="number">0</span> (Target Id: <span class="number">0</span>)</span><br><span class="line">Name                :</span><br><span class="line">RAID Level          : Primary-<span class="number">5</span>, Secondary-<span class="number">0</span>, RAID Level Qualifier-<span class="number">3</span></span><br><span class="line">Size                : <span class="number">557.75</span> GB</span><br><span class="line">Sector Size         : <span class="number">512</span></span><br><span class="line">Parity Size         : <span class="number">278.875</span> GB</span><br><span class="line">State               : Optimal</span><br><span class="line">Strip Size          : <span class="number">64</span> KB</span><br><span class="line">Number Of Drives    : <span class="number">3</span></span><br><span class="line">Span Depth          : <span class="number">1</span></span><br><span class="line">Default Cache Policy: WriteThrough, ReadAheadNone, Direct, No Write Cache <span class="keyword">if</span> Bad BBU</span><br><span class="line">Current Cache Policy: WriteThrough, ReadAheadNone, Direct, No Write Cache <span class="keyword">if</span> Bad BBU</span><br><span class="line">Default Access Policy: Read/Write</span><br><span class="line">Current Access Policy: Read/Write</span><br><span class="line">Disk Cache Policy   : Disk<span class="string">'s Default</span><br><span class="line">Encryption Type     : None</span><br><span class="line">Is VD Cached: No</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exit Code: 0x00</span><br><span class="line">[root@DBServer1 MegaCli]#</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@DBServer2 MegaCli]<span class="comment"># ./MegaCli64 -Ldinfo -lall -aall</span></span><br><span class="line">                                     </span><br><span class="line"></span><br><span class="line">Adapter <span class="number">0</span> -- Virtual Drive Information:</span><br><span class="line">Virtual Drive: <span class="number">0</span> (Target Id: <span class="number">0</span>)</span><br><span class="line">Name                :</span><br><span class="line">RAID Level          : Primary-<span class="number">5</span>, Secondary-<span class="number">0</span>, RAID Level Qualifier-<span class="number">3</span></span><br><span class="line">Size                : <span class="number">557.75</span> GB</span><br><span class="line">Sector Size         : <span class="number">512</span></span><br><span class="line">Parity Size         : <span class="number">278.875</span> GB</span><br><span class="line">State               : Optimal</span><br><span class="line">Strip Size          : <span class="number">64</span> KB</span><br><span class="line">Number Of Drives    : <span class="number">3</span></span><br><span class="line">Span Depth          : <span class="number">1</span></span><br><span class="line">Default Cache Policy: WriteBack, ReadAheadNone, Direct, No Write Cache <span class="keyword">if</span> Bad BBU</span><br><span class="line">Current Cache Policy: WriteBack, ReadAheadNone, Direct, No Write Cache <span class="keyword">if</span> Bad BBU</span><br><span class="line">Default Access Policy: Read/Write</span><br><span class="line">Current Access Policy: Read/Write</span><br><span class="line">Disk Cache Policy   : Disk<span class="string">'s Default</span><br><span class="line">Encryption Type     : None</span><br><span class="line">Is VD Cached: No</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exit Code: 0x00</span><br><span class="line">[root@DBServer2 MegaCli]#</span></span><br></pre></td></tr></table></figure>
<p><strong>以下为搜到的科普内容</strong></p>
<p>Cache写机制</p>
<p>参考 <a href="http://en.wikipedia.org/wiki/Cache#Writing_Policies" target="_blank" rel="external">http://en.wikipedia.org/wiki/Cache#Writing_Policies</a> 上的说明，<strong>Cache</strong>写机制分为<strong>write through</strong>和<strong>write back</strong>两种。</p>
<blockquote>
<ul>
<li><strong>Write-through</strong> Write is done synchronously both to the cache and to the backing store.</li>
<li><strong>Write-back</strong> (or Write-behind) – Writing is done only to the cache. A modified cache block is written back to the store, just before it is replaced.</li>
</ul>
</blockquote>
<p><strong>Write-through</strong>（直写模式）在数据更新时，同时写入缓存Cache和后端存储。此模式的优点是操作简单；缺点是因为数据修改需要同时写入存储，数据写入速度较慢。</p>
<p><strong>Write-back</strong>（回写模式）在数据更新时只写入缓存Cache。只在数据被替换出缓存时，被修改的缓存数据才会被写到后端存储。此模式的优点是数据写入速度快，因为不需要写存储；缺点是一旦更新后的数据未被写入存储时出现系统掉电的情况，数据将无法找回。</p>
<p><strong>Write-misses写缺失的处理方式</strong></p>
<p>对于写操作，存在写入缓存缺失数据的情况，这时有两种处理方式：</p>
<blockquote>
<ul>
<li><strong>Write allocate</strong> (aka Fetch on write) – Datum at the missed-write location is loaded to cache, followed by a write-hit operation. In this approach, write misses are similar to read-misses.</li>
<li><strong>No-write allocate</strong> (aka Write-no-allocate, Write around) – Datum at the missed-write location is not loaded to cache, and is written directly to the backing store. In this approach, actually only system reads are being cached.</li>
</ul>
</blockquote>
<p><strong>Write allocate</strong>方式将写入位置读入缓存，然后采用write-hit（缓存命中写入）操作。写缺失操作与读缺失操作类似。</p>
<p><strong>No-write allocate</strong>方式并不将写入位置读入缓存，而是直接将数据写入存储。这种方式下，只有读操作会被缓存。</p>
<p>无论是Write-through还是Write-back都可以使用写缺失的两种方式之一。只是通常Write-back采用Write allocate方式，而Write-through采用No-write allocate方式；因为多次写入同一缓存时，Write allocate配合Write-back可以提升性能；而对于Write-through则没有帮助。</p>
<p><strong>处理流程图</strong></p>
<p>Write-through模式处理流程：</p>
<p><img src="http://r.loli.io/y67vYf.png" alt=""></p>
<p>Write-back模式处理流程：</p>
<p><img src="http://r.loli.io/2mU3Yb.png" alt=""></p>
<p>在创建raid阵列可选择Write Policy的策略</p>
<p><img src="http://r.loli.io/BZRNRf.jpg" alt=""></p>
<p>在了解了原理之后可以通过<strong>MegaCli</strong>来设置DB1的<strong>Write Policy</strong>为<strong>WriteBack</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@DBServer1 MegaCli]<span class="comment"># ./MegaCli64 -LDSetProp WB -LAll -aAll</span></span><br><span class="line">                                     </span><br><span class="line">Set Write Policy to WriteBack on Adapter <span class="number">0</span>, VD <span class="number">0</span> (target id: <span class="number">0</span>) success</span><br><span class="line"></span><br><span class="line">Exit Code: <span class="number">0</span>x00</span><br><span class="line">[root@DBServer1 MegaCli]<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>此时在查看DB1的<strong>Write Policy</strong>已经成功设置为<strong>WriteBack</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@DBServer1 MegaCli]<span class="comment"># ./MegaCli64 -Ldinfo -lall -aall</span></span><br><span class="line">                                     </span><br><span class="line"></span><br><span class="line">Adapter <span class="number">0</span> -- Virtual Drive Information:</span><br><span class="line">Virtual Drive: <span class="number">0</span> (Target Id: <span class="number">0</span>)</span><br><span class="line">Name                :</span><br><span class="line">RAID Level          : Primary-<span class="number">5</span>, Secondary-<span class="number">0</span>, RAID Level Qualifier-<span class="number">3</span></span><br><span class="line">Size                : <span class="number">557.75</span> GB</span><br><span class="line">Sector Size         : <span class="number">512</span></span><br><span class="line">Parity Size         : <span class="number">278.875</span> GB</span><br><span class="line">State               : Optimal</span><br><span class="line">Strip Size          : <span class="number">64</span> KB</span><br><span class="line">Number Of Drives    : <span class="number">3</span></span><br><span class="line">Span Depth          : <span class="number">1</span></span><br><span class="line">Default Cache Policy: WriteBack, ReadAheadNone, Direct, No Write Cache <span class="keyword">if</span> Bad BBU</span><br><span class="line">Current Cache Policy: WriteBack, ReadAheadNone, Direct, No Write Cache <span class="keyword">if</span> Bad BBU</span><br><span class="line">Default Access Policy: Read/Write</span><br><span class="line">Current Access Policy: Read/Write</span><br><span class="line">Disk Cache Policy   : Disk<span class="string">'s Default</span><br><span class="line">Encryption Type     : None</span><br><span class="line">Is VD Cached: No</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exit Code: 0x00</span><br><span class="line">[root@DBServer1 MegaCli]#</span></span><br></pre></td></tr></table></figure>
<p>然后在测试DB1的写入速度，看以看到正常了<br><img src="http://r.loli.io/2uYfMf.png" alt=""></p>
<p>下一篇文章会着重记录一下<strong>MegaCli</strong>工具的安装与使用</p>
<hr>
<p>继续科普记录一下</p>
<p>Write Through和Write Back是阵列卡Cache的两种使用方式，也称为透写和回写。当选用write through方式时，系统的写磁盘操作并不利用阵列卡的Cache，而是直接与磁盘进行数据的交互。而write Back方式则利用阵列Cache作为系统与磁盘间的二传手，系统先将数据交给Cache，然后再由Cache将数据传给磁盘。 在配置阵列的时候，如果不是很清楚的话，默认就可以了，系统会根据磁盘类型进行默认设置。</p>
<p>生产环境中的配置要根据具体的业务类型及环境进行配置，比如：如果有外置UPS电源，选Write Back，如果没有外置电源，并且对数据安全性要求很高，不要求太高性能，就选Write Through。Write caching 或 write-through write-through意思是写操作根本不使用缓存。数据总是直接写入磁盘。关闭写缓存，可释放缓存用于读操作。（缓存被读写操作共用） Write caching可以提高写操作的性能。数据不是直接被写入磁盘；而是写入缓存。从应用程序的角度看，比等待完成磁盘写入操作要快的多。因此，可以提高写性能。由控制器将缓存内未写入磁盘的数据写入磁盘。表面上看，Write cache方式比write-through方式的读、写性能都要好，但是也要看磁盘访问方式和磁盘负荷了。 write-back（write cache）方式通常在磁盘负荷较轻时速度更快。负荷重时，每当数据被写入缓存后，就要马上再写入磁盘以释放缓存来保存将要写入的新数据，这时如果数据直接写入磁盘，控制器会以更快的速度运行。因此，负荷重时，将数据先写入缓存反而会降低吞吐量。 Starting and stopping cache flushing levels 这两个设置影响控制器如何处理未写入磁盘的缓存内数据，并且只在write-back cache方式下生效。缓存内数据写入磁盘称为flushing.你可以配置Starting and stopping cache flushing levels值，这个值表示占用整个缓存大小的百分比。当缓存内未写入磁盘的数据达到starting flushing value时，控制器开始flushing（由缓存写入磁盘）。当缓存内未写入磁盘数据量低于stop flush value时，flushing过程停止。控制器总是先flush旧的缓存数据。缓存内未写入数据停留超过20秒钟后被自动flushing. 典型的start flushing level是80%。通常情况下，stop flushing level也设置为80%。也就是说，控制器不允许超过80%的缓存用于write-back cache,但还是尽可能保持这一比例。如果你使用此设置，可以在缓存内存更多的未写入数据。这有利于提高写操作的性能，但是要牺牲数据保护。如果要得到数据保护，你可以使用较低的start and stop values。通过对这两个参数的设置，你可以调整缓存的读、写性能。经测试表明，使用接近的start and stop flushing levels时性能较好。如果stop level value远远低于start value，在flushing时会导致磁盘拥塞。 Cache block size 这个值指缓存分配单元大小，可以是4K或16K。选择合适的值，可以明显的改善缓存使用性能。 如果应用程序更多时候访问小于8K的数据，而将cache block size设置为16K，每次访问仅使用一部分cache block。在16K的cache block里总是存储8K或更小的数据，意味着只有50%的缓存容量被有效使用，使性能下降。对于随机I/O和小数据块的传送，4K比较合适。另一方面，如果是连续I/O 并使用大的segment size，最好选择16K。大的cache block size意味着cache block数量少并可缩短缓存消耗延时。另外，对于同样大小的数据，cache block size大一些，需要的缓存数据传送量更小。</p>
<p>其他相关说明：</p>
<p>保护内存里的数据</p>
<p>备援电池的功能是确保万一当主电源故障或突然断电时内存里的数据不流失，因此如何确保备援电池的正常运行就显得格外重要。备援电池在2种情况下，系统视为无法正常运行以保护内存里的数据。一是坏掉的时候，背板的LED灯将亮起红灯。一是电池充电的时候，背板的LED灯将亮起黄灯。备援电池的使用寿命是根据充电的次数及电力释放的周期而变化的，这取决于用户本身对盘阵的使用情况，一般而言我们建议最好在盘阵使用了12个月之后更换备援电池模块（BBU）。备援电池在正常情况下充满电的时候是3.5V，当其电力降至2.7V的时候将自动进入充电状态，此时系统因为保护内存数据不流失的电力消失，自动地将数据的写入切换成“Write-Through”模式；当充完电后，又自动切换回“Write-Back”模式。这个动作是在事件启动装置（Event Trigger）功能来执行的，在安装管理软件的时候，事件启动装置对备援电池的管理初始值是打开的（Enable）。如果你没有更改过初始设置，那么上述的动作就会正常的运行。如果备援电池已经坏掉，不能正常保护内存里的数据时，而事件启动装置对备援电池的管理是设定在关闭的状态下，我们建议你手动将数据写入模式更改为“Write-Through”模式，以免数据写入没有电力保护的内存中而主电源故障或突然断电时，这些正在写入的数据就遗失了。</p>
<p>减少延迟 当关闭内存“Write-Back”功能时就进入了“Write-Through”的模式，这时候主机数据是不会写入内存而直接写入硬盘的。在“Write-Through”模式下，所有的硬盘将与其相关的主机以适当的方式存取数据块，而大多数的时候硬盘处于接受写命令的状态。此时盘阵只要从主机接收到写入的命令，硬盘的读写头就会去寻找读写的位置，并等待硬盘处于可写入的状态，这个等待的现象就是所谓的延迟（Latency Time)，而硬盘经常处于等待写入的状态，增加了延迟的时间，不但缩短硬盘的使用寿命，并且系统也比较耗电。当打开内存的“Write-Back”功能时，从主机写入硬盘的数据先被写在内存里，在内存写满数据时盘阵控制器会将存在于内存的数据大量地写入硬盘。这个内存“Write-Back”的模式将主机写入的命令以写入内存来取代，可以大幅减少硬盘延迟的时间，并且相较于“Write-Through”模式，在大多数的时候提供更佳的写入政策。</p>
<p>附上安装方法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wget http://docs.avagotech.com/docs-and-downloads/raid-controllers/raid-controllers-common-files/<span class="number">8</span>-<span class="number">07</span>-<span class="number">14</span>_MegaCLI.zip</span><br><span class="line">unzip <span class="number">8</span>-<span class="number">07</span>-<span class="number">14</span>_MegaCLI.zip</span><br><span class="line"><span class="built_in">cd</span> Linux</span><br><span class="line">rpm -ivh MegaCli-<span class="number">8.07</span>.<span class="number">14</span>-<span class="number">1</span>.noarch.rpm</span><br><span class="line">ls /opt/MegaRAID/MegaCli/           </span><br><span class="line">CmdTool.log  install.log  libstorelibir-<span class="number">2</span>.so  libstorelibir-<span class="number">2</span>.so.<span class="number">14.07</span>-<span class="number">0</span>  MegaCli64  MegaSAS.log</span><br><span class="line">chmod -R * +x /opt/MegaRAID</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote class="blockquote-center">Write Through和Write Back是阵列卡Cache的两种使用方式，也称为透写和回写。当选用write through方式时，系统的写磁盘操作并不利用阵列卡的Cache，而是直接与磁盘进行数据的交互。而write Back方式则利用阵列Cache作为系统与磁盘间的二传手，系统先将数据交给Cache，然后再由Cache将数据传给磁盘。</blockquote>]]>
    
    </summary>
    
      <category term="RAID" scheme="http://linux48.com/tags/RAID/"/>
    
      <category term="cache" scheme="http://linux48.com/tags/cache/"/>
    
      <category term="阵列卡" scheme="http://linux48.com/tags/%E9%98%B5%E5%88%97%E5%8D%A1/"/>
    
      <category term="windows" scheme="http://linux48.com/categories/windows/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Repair Cisco vpnclient on windows10]]></title>
    <link href="http://linux48.com//archives/435/"/>
    <id>http://linux48.com//archives/435/</id>
    <published>2015-08-02T16:00:00.000Z</published>
    <updated>2016-04-09T09:12:49.000Z</updated>
    <content type="html"><![CDATA[<p>由于此问题是windows10刚发布，但是cisco单方面并没有及时修复，并且就目前看来是全球的工程师都碰到的一个很紧急棘手的问题</p>
<p>在查找修复方案的时候;得到好多歪果仁的帮助，特地写了一片洋文，希望可以帮到更多的人，蹩脚的E文如有问题请留言或者邮件我及时勘误，不甚感激！</p>
<p>Microsoft released last week by the windows10, after the upgrade <code>vpnclient-winx64-msi-5.0.07.0440-k9.exe</code> found this installation as wrong.</p>
<p><img src="http://r.loli.io/eAVbii.png" alt=""></p>
<p>First we first fix, so that vpnclient-winx64-msi-5.0.07.0440-k9.exe is properly installed</p>
<a id="more"></a>
<hr>
<h1 id="Fix_Install_Error">Fix Install Error</h1><p>Download the 2 software <strong><code>winfix.exe</code></strong> and <strong><code>dneupdate64.msi</code></strong></p>
<p>first install <strong><code>winfix.exe</code></strong> </p>
<p>and then install <strong><code>dneupdate64.msi</code></strong></p>
<p>and finally extract the <strong><code>vpnclient-winx64-msi-5.0.07.0440-k9.exe</code></strong>, and execute the installation file <strong><code>vpnclient_setup.exe</code></strong></p>
<p>Now Cisco VPN clients has been successfully installed on windows10 ！</p>
<hr>
<h1 id="Fix_Dialing_Error">Fix Dialing Error</h1><p>But, the back of the account password when I dial the wrong</p>
<p><code>Secure VPN Connection terminated locally by the Client.</code><br><code>Reason 433: Reason not specified by peer.</code></p>
<p>Continue to search for information to fix this funking problem ！！！</p>
<p>The likely reason was apparently due to the DNE LightWeight Filter network client not being properly installed by the Cisco Systems VPN installer.</p>
<p>To solve this, please try to do the following in the exact order:</p>
<p>A) First, uninstall any Cisco VPN Client software you may have installed earlier;</p>
<p>B) Then uninstall any DNE updater software(s) you may have installed earlier;</p>
<p>C) Reboot your computer.</p>
<p>D) Run winfix.exe, to ensure the DNE is properly cleaned up. </p>
<p>E) Reboot your computer again.</p>
<p>F) Download Sonic VPN software from here: 32-bit here or 64-bit here.</p>
<p>G) Install the Sonic VPN software (which was able to install the right version of the DNE);</p>
<p>H) Reboot your computer.</p>
<p>I) Reinstall the Cisco VPN Client software again. (You do not need to uninstall the Sonic VPN software from step G). If you face a version check issue, run the msi file instead of the exe file</p>
<p>J) Reboot your computer.</p>
<p>K) Your Cisco VPN Client should now work in Windows 10!</p>
<p>Finally we dial again, what the funking！！ reporting error again ！！</p>
<p><code>vpn 422 failed to enable virtual adapter</code></p>
<hr>
<h1 id="Finally_Fix_this_problem">Finally Fix this problem</h1><p>Enter the registry regedit</p>
<p><code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\CVirtA</code> find <code>DisplayName</code>  key  </p>
<p>Value of X86 system change <strong><code>@oem16.inf,%CVirtA_Desc%;Cisco Systems VPN Adapter</code></strong> to <strong><code>Cisco Systems VPN Adapter</code></strong></p>
<p>Value of 64 system change <strong><code>@oem16.inf,%CVirtA_Desc%;Cisco Systems VPN Adapter for 64-bit Windows</code></strong> to <strong><code>Cisco Systems VPN Adapter for 64-bit Windows</code></strong></p>
<p>And then landed on the dial, success!!<br>Now the problem of the egg pain is completely solved!!!</p>
<hr>
<p>bove software download address</p>
<p>for 64bit<br><a href="ftp://files.citrix.com/winfix.exe" target="_blank" rel="external">ftp://files.citrix.com/winfix.exe</a><br><a href="ftp://files.citrix.com/dneupdate64.msi" target="_blank" rel="external">ftp://files.citrix.com/dneupdate64.msi</a><br><a href="http://www.gleescape.com/wp-content/uploads/2014/09/sonic64.zip" target="_blank" rel="external">http://www.gleescape.com/wp-content/uploads/2014/09/sonic64.zip</a></p>
<p>for 32bit<br><a href="ftp://files.citrix.com/winfix.exe" target="_blank" rel="external">ftp://files.citrix.com/winfix.exe</a><br><a href="ftp://ftpsupport.citrix.com/dneupdate.msi" target="_blank" rel="external">ftp://ftpsupport.citrix.com/dneupdate.msi</a><br><a href="http://www.gleescape.com/wp-content/uploads/2014/09/sonic32.zip" target="_blank" rel="external">http://www.gleescape.com/wp-content/uploads/2014/09/sonic32.zip</a></p>
<p>Chinese users may download speed will be very slow, I deliberately uploaded to Baidu cloud</p>
<p><a href="http://pan.baidu.com/s/1o6vcMz4" target="_blank" rel="external">http://pan.baidu.com/s/1o6vcMz4</a></p>
<p>Reference website:<br><a href="http://www.itsystemadmin.com/error-27850-unable-to-manage-networking-component/" target="_blank" rel="external">http://www.itsystemadmin.com/error-27850-unable-to-manage-networking-component/</a><br><a href="http://www.gleescape.com/posts/2917" target="_blank" rel="external">http://www.gleescape.com/posts/2917</a><br><a href="http://blog.itpub.net/9697/viewspace-1437036/" target="_blank" rel="external">http://blog.itpub.net/9697/viewspace-1437036/</a></p>
<p>Thanks them very much!!!</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>由于此问题是windows10刚发布，但是cisco单方面并没有及时修复，并且就目前看来是全球的工程师都碰到的一个很紧急棘手的问题</p>
<p>在查找修复方案的时候;得到好多歪果仁的帮助，特地写了一片洋文，希望可以帮到更多的人，蹩脚的E文如有问题请留言或者邮件我及时勘误，不甚感激！</p>
<p>Microsoft released last week by the windows10, after the upgrade <code>vpnclient-winx64-msi-5.0.07.0440-k9.exe</code> found this installation as wrong.</p>
<p><img src="http://r.loli.io/eAVbii.png" alt=""></p>
<p>First we first fix, so that vpnclient-winx64-msi-5.0.07.0440-k9.exe is properly installed</p>]]>
    
    </summary>
    
      <category term="cisco" scheme="http://linux48.com/tags/cisco/"/>
    
      <category term="vpn" scheme="http://linux48.com/tags/vpn/"/>
    
      <category term="windows10" scheme="http://linux48.com/tags/windows10/"/>
    
      <category term="windows" scheme="http://linux48.com/categories/windows/"/>
    
  </entry>
  
</feed>