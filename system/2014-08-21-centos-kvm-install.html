<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redhat/CentOS系统KVM虚拟机安装过程详解 | LINUX48</title>
    <meta name="description" content=" 快应用UI组件库，简洁，易用，高效">
    <link rel="icon" href="favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.0b276b3d.css" as="style"><link rel="preload" href="/assets/js/app.294eee9c.js" as="script"><link rel="preload" href="/assets/js/2.24623497.js" as="script"><link rel="preload" href="/assets/js/109.441214fa.js" as="script"><link rel="prefetch" href="/assets/js/10.85b07791.js"><link rel="prefetch" href="/assets/js/100.7c500289.js"><link rel="prefetch" href="/assets/js/101.4d1d534b.js"><link rel="prefetch" href="/assets/js/102.da0b3676.js"><link rel="prefetch" href="/assets/js/103.69e7affb.js"><link rel="prefetch" href="/assets/js/104.c5fd8014.js"><link rel="prefetch" href="/assets/js/105.eca63ec4.js"><link rel="prefetch" href="/assets/js/106.a42c9a7a.js"><link rel="prefetch" href="/assets/js/107.b0a3e9d0.js"><link rel="prefetch" href="/assets/js/108.48f2df0f.js"><link rel="prefetch" href="/assets/js/11.ce2352d0.js"><link rel="prefetch" href="/assets/js/110.47cd187c.js"><link rel="prefetch" href="/assets/js/111.ce424e40.js"><link rel="prefetch" href="/assets/js/112.b5887451.js"><link rel="prefetch" href="/assets/js/113.59575f68.js"><link rel="prefetch" href="/assets/js/114.9c7d6bc7.js"><link rel="prefetch" href="/assets/js/115.525b7610.js"><link rel="prefetch" href="/assets/js/116.67e0a272.js"><link rel="prefetch" href="/assets/js/117.34aab813.js"><link rel="prefetch" href="/assets/js/118.d0d2ab8b.js"><link rel="prefetch" href="/assets/js/119.f56f2649.js"><link rel="prefetch" href="/assets/js/12.7a5cf9ea.js"><link rel="prefetch" href="/assets/js/120.b9cba40a.js"><link rel="prefetch" href="/assets/js/121.9425f20c.js"><link rel="prefetch" href="/assets/js/122.dc798386.js"><link rel="prefetch" href="/assets/js/123.1510a3c7.js"><link rel="prefetch" href="/assets/js/124.82db64ae.js"><link rel="prefetch" href="/assets/js/125.03784a70.js"><link rel="prefetch" href="/assets/js/126.505f99f4.js"><link rel="prefetch" href="/assets/js/127.fde125ce.js"><link rel="prefetch" href="/assets/js/128.2f52f9e9.js"><link rel="prefetch" href="/assets/js/129.f8124508.js"><link rel="prefetch" href="/assets/js/13.a8a76a9e.js"><link rel="prefetch" href="/assets/js/130.1889d1e1.js"><link rel="prefetch" href="/assets/js/131.4b906ddd.js"><link rel="prefetch" href="/assets/js/132.50bcbee0.js"><link rel="prefetch" href="/assets/js/133.5931b7d5.js"><link rel="prefetch" href="/assets/js/134.f944030c.js"><link rel="prefetch" href="/assets/js/135.2f05d94a.js"><link rel="prefetch" href="/assets/js/136.6732d310.js"><link rel="prefetch" href="/assets/js/137.d10875dc.js"><link rel="prefetch" href="/assets/js/138.69d27b4a.js"><link rel="prefetch" href="/assets/js/139.9234d690.js"><link rel="prefetch" href="/assets/js/14.8cfd079f.js"><link rel="prefetch" href="/assets/js/140.92d76eca.js"><link rel="prefetch" href="/assets/js/141.55f759b4.js"><link rel="prefetch" href="/assets/js/142.bf504c04.js"><link rel="prefetch" href="/assets/js/143.eda8e14a.js"><link rel="prefetch" href="/assets/js/144.5c8478c8.js"><link rel="prefetch" href="/assets/js/145.482f64ca.js"><link rel="prefetch" href="/assets/js/146.fa5d72a0.js"><link rel="prefetch" href="/assets/js/15.32178794.js"><link rel="prefetch" href="/assets/js/16.8915da96.js"><link rel="prefetch" href="/assets/js/17.44bb6603.js"><link rel="prefetch" href="/assets/js/18.81ca85d6.js"><link rel="prefetch" href="/assets/js/19.0833c690.js"><link rel="prefetch" href="/assets/js/20.21a0bcee.js"><link rel="prefetch" href="/assets/js/21.93a5279d.js"><link rel="prefetch" href="/assets/js/22.ffb9ccd7.js"><link rel="prefetch" href="/assets/js/23.f418667b.js"><link rel="prefetch" href="/assets/js/24.2c36a44e.js"><link rel="prefetch" href="/assets/js/25.324729fc.js"><link rel="prefetch" href="/assets/js/26.4b1f24a0.js"><link rel="prefetch" href="/assets/js/27.c5168e56.js"><link rel="prefetch" href="/assets/js/28.11c5cd93.js"><link rel="prefetch" href="/assets/js/29.d0df7513.js"><link rel="prefetch" href="/assets/js/3.e2a5b8ba.js"><link rel="prefetch" href="/assets/js/30.8be6e657.js"><link rel="prefetch" href="/assets/js/31.0e9caaef.js"><link rel="prefetch" href="/assets/js/32.2eb7ff49.js"><link rel="prefetch" href="/assets/js/33.6b7abc98.js"><link rel="prefetch" href="/assets/js/34.3e5606b8.js"><link rel="prefetch" href="/assets/js/35.370b123e.js"><link rel="prefetch" href="/assets/js/36.83f9b362.js"><link rel="prefetch" href="/assets/js/37.6e35ee30.js"><link rel="prefetch" href="/assets/js/38.a773fb35.js"><link rel="prefetch" href="/assets/js/39.74e2e4de.js"><link rel="prefetch" href="/assets/js/4.5229681b.js"><link rel="prefetch" href="/assets/js/40.f4992bad.js"><link rel="prefetch" href="/assets/js/41.5fa9700b.js"><link rel="prefetch" href="/assets/js/42.b5c593c6.js"><link rel="prefetch" href="/assets/js/43.a9239390.js"><link rel="prefetch" href="/assets/js/44.0a076d78.js"><link rel="prefetch" href="/assets/js/45.c2e2cf01.js"><link rel="prefetch" href="/assets/js/46.930a4274.js"><link rel="prefetch" href="/assets/js/47.25274095.js"><link rel="prefetch" href="/assets/js/48.94502441.js"><link rel="prefetch" href="/assets/js/49.36b50720.js"><link rel="prefetch" href="/assets/js/5.be647063.js"><link rel="prefetch" href="/assets/js/50.25ba2d36.js"><link rel="prefetch" href="/assets/js/51.19210514.js"><link rel="prefetch" href="/assets/js/52.a4a58f79.js"><link rel="prefetch" href="/assets/js/53.2e8c69d3.js"><link rel="prefetch" href="/assets/js/54.0ced061b.js"><link rel="prefetch" href="/assets/js/55.523194ff.js"><link rel="prefetch" href="/assets/js/56.69315dd4.js"><link rel="prefetch" href="/assets/js/57.9228ceba.js"><link rel="prefetch" href="/assets/js/58.ed13242a.js"><link rel="prefetch" href="/assets/js/59.3a4dc33c.js"><link rel="prefetch" href="/assets/js/6.71dbec67.js"><link rel="prefetch" href="/assets/js/60.f061089a.js"><link rel="prefetch" href="/assets/js/61.8469796f.js"><link rel="prefetch" href="/assets/js/62.a17eacd2.js"><link rel="prefetch" href="/assets/js/63.0f5e6b75.js"><link rel="prefetch" href="/assets/js/64.fb0ef273.js"><link rel="prefetch" href="/assets/js/65.10899016.js"><link rel="prefetch" href="/assets/js/66.e7ee8f49.js"><link rel="prefetch" href="/assets/js/67.92bb9fdb.js"><link rel="prefetch" href="/assets/js/68.7a9c310b.js"><link rel="prefetch" href="/assets/js/69.2732190d.js"><link rel="prefetch" href="/assets/js/7.62405bcd.js"><link rel="prefetch" href="/assets/js/70.cfd7130d.js"><link rel="prefetch" href="/assets/js/71.163f5e07.js"><link rel="prefetch" href="/assets/js/72.470f93d6.js"><link rel="prefetch" href="/assets/js/73.fda04d74.js"><link rel="prefetch" href="/assets/js/74.ca20f9c0.js"><link rel="prefetch" href="/assets/js/75.fe89701f.js"><link rel="prefetch" href="/assets/js/76.4f8328d0.js"><link rel="prefetch" href="/assets/js/77.9135dbf0.js"><link rel="prefetch" href="/assets/js/78.3c2e9fa1.js"><link rel="prefetch" href="/assets/js/79.a1408b70.js"><link rel="prefetch" href="/assets/js/8.d941bdbf.js"><link rel="prefetch" href="/assets/js/80.920926f9.js"><link rel="prefetch" href="/assets/js/81.d60bb7bb.js"><link rel="prefetch" href="/assets/js/82.4e748beb.js"><link rel="prefetch" href="/assets/js/83.70f5a357.js"><link rel="prefetch" href="/assets/js/84.5588a7a2.js"><link rel="prefetch" href="/assets/js/85.305593f3.js"><link rel="prefetch" href="/assets/js/86.89b4e061.js"><link rel="prefetch" href="/assets/js/87.48e833b9.js"><link rel="prefetch" href="/assets/js/88.078c4a36.js"><link rel="prefetch" href="/assets/js/89.489813d2.js"><link rel="prefetch" href="/assets/js/9.7e79e735.js"><link rel="prefetch" href="/assets/js/90.9302e5a7.js"><link rel="prefetch" href="/assets/js/91.b7d2a479.js"><link rel="prefetch" href="/assets/js/92.e73cfd6e.js"><link rel="prefetch" href="/assets/js/93.1f02a544.js"><link rel="prefetch" href="/assets/js/94.f0898a34.js"><link rel="prefetch" href="/assets/js/95.2f1600ef.js"><link rel="prefetch" href="/assets/js/96.164db052.js"><link rel="prefetch" href="/assets/js/97.68fff71f.js"><link rel="prefetch" href="/assets/js/98.5a5b922f.js"><link rel="prefetch" href="/assets/js/99.e6feade8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0b276b3d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">LINUX48</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">指南</a></div><div class="nav-item"><a href="/zh/CHANGELOG.html" class="nav-link">Changelog</a></div><div class="nav-item"><a href="https://github.com/JDsecretFE/quist-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">指南</a></div><div class="nav-item"><a href="/zh/CHANGELOG.html" class="nav-link">Changelog</a></div><div class="nav-item"><a href="https://github.com/JDsecretFE/quist-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Database</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Container</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Monitor</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>System</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/system/emoji.html" class="sidebar-link">emoji_full</a></li><li><a href="/system/2016-06-30-hive-hdfs.html" class="sidebar-link">hive整合hadoop通过flume+hue收集日志</a></li><li><a href="/system/2016-05-24-free-ssl.html" class="sidebar-link">Startssl免费SSL证书+Nginx搭建https</a></li><li><a href="/system/2016-05-16-flume.html" class="sidebar-link">flume+hdfs构建大数据</a></li><li><a href="/system/2016-04-21-notepad.html" class="sidebar-link">数据库维护文本编辑技巧记录</a></li><li><a href="/system/2016-04-14-cisco-firewall-ha.html" class="sidebar-link">CISCO ASA5520 HA 配置</a></li><li><a href="/system/2016-04-09-centos7-config-bond.html" class="sidebar-link">centos7配置bond和bond跨网段改IP</a></li><li><a href="/system/2016-02-03-centos-install-bugzilla.html" class="sidebar-link">CentOS下Nginx配置Perl运行Bugzilla</a></li><li><a href="/system/2015-11-12-centos-install-maven.html" class="sidebar-link">CentOS上搭建私有maven仓库(迁移，升级)</a></li><li><a href="/system/2015-08-27-Write-through-back.html" class="sidebar-link">MegaCli使用技巧-阵列Cache写机制：Write-through与Write-back</a></li><li><a href="/system/2015-08-03-win10-cisco-vpn-repair.html" class="sidebar-link">Repair Cisco vpnclient on windows10</a></li><li><a href="/system/2015-07-07-svn-admin.html" class="sidebar-link">CentOS6安装subversion 可视化管理工具iF.SVNAdmin</a></li><li><a href="/system/2015-07-06-rhel-yum.html" class="sidebar-link">Red Hat Enterprise Linux Server YUM配置</a></li><li><a href="/system/2015-06-08-php-fpm-backlog.html" class="sidebar-link">关于PHP-FPM的backlog</a></li><li><a href="/system/2015-06-03-bitnami-gitlab-port.html" class="sidebar-link">bitnami版gitlab修改端口</a></li><li><a href="/system/2015-03-13-awstats-install.html" class="sidebar-link">awstats日志分析安装</a></li><li><a href="/system/2015-03-07-h3c-vlan.html" class="sidebar-link">H3C划分VLAN命令</a></li><li><a href="/system/2015-01-21-shadowsocks-python-node.html" class="sidebar-link">shadowsocks的python和nodejs版搭建</a></li><li><a href="/system/2015-01-07-ruby-Syntax-error-Invalid-GBK.html" class="sidebar-link">ruby环境sass编译中文出现 Invalid GBK character</a></li><li><a href="/system/2015-01-06-linux-rm-luanma.html" class="sidebar-link">linux下删除乱码文件</a></li><li><a href="/system/2014-12-17-SVNListParentPath.html" class="sidebar-link">利用SVNListParentPath增加http浏览仓库根目录的功能</a></li><li><a href="/system/2014-12-15-Chrome-css-failed.html" class="sidebar-link">Chrome 浏览器加载 css Failed to load resource</a></li><li><a href="/system/2014-12-04-centos-gitlab-yijian.html" class="sidebar-link">centos gitlab一键安装备份恢复和迁移</a></li><li><a href="/system/2014-12-02-linux-sar.html" class="sidebar-link">linux sar命令</a></li><li><a href="/system/2014-11-24-ruby-on-rails-err.html" class="sidebar-link">ruby on rails 报错解决</a></li><li><a href="/system/2014-11-18-awk-note.html" class="sidebar-link">AWK统计随笔记录</a></li><li><a href="/system/2014-11-12-svn-force-commit.html" class="sidebar-link">SVN强制提交commit</a></li><li><a href="/system/2014-11-12-rm-list-too-long.html" class="sidebar-link">rm Argument list too long的解决办法</a></li><li><a href="/system/2014-11-12-crontab-linux-lessthan.html" class="sidebar-link">Crontab导致Linux的线程数枯竭</a></li><li><a href="/system/2014-11-11-shell-ftp-uplod.html" class="sidebar-link">用二句Shell命令实现FTP批量上传文件夹</a></li><li><a href="/system/2014-11-10-redis-disk-memory-err.html" class="sidebar-link">redis 写磁盘出错Cannot allocate memory</a></li><li><a href="/system/2014-10-19-Jekyll_Variables.html" class="sidebar-link">Jekyll目录结构与变量</a></li><li><a href="/system/2014-10-19-git_common_command.html" class="sidebar-link">Git 常用命令整理</a></li><li><a href="/system/2014-10-18-windows_configuration_Jekyll.html" class="sidebar-link">Windows平台配置Jekyll环境并与GitHub连接</a></li><li><a href="/system/2014-08-21-centos-kvm-install.html" class="active sidebar-link">Redhat/CentOS系统KVM虚拟机安装过程详解</a></li><li><a href="/system/2014-08-18-Sublime-add-youjian.html" class="sidebar-link">将sublime text添加到右键菜单中</a></li><li><a href="/system/2014-08-13-Sublime-python-build.html" class="sidebar-link">Sublime Text 3设置python编译支持环境设置</a></li><li><a href="/system/2014-08-11-shell-syntax-error.html" class="sidebar-link">SHELL syntax error:unexpected end of file 提示错误</a></li><li><a href="/system/2014-07-31-CentOS-NFS-mount.html" class="sidebar-link">CentOS NFS的安装配置、启动及mount挂载方法</a></li><li><a href="/system/2014-07-30-tencent-yun-repo.html" class="sidebar-link">腾讯云的YUM repo</a></li><li><a href="/system/2014-07-28-git-del-err-commit.html" class="sidebar-link">git删除错误提交的commit</a></li><li><a href="/system/2014-07-25-centos-install-ossec.html" class="sidebar-link">centos安装ossec</a></li><li><a href="/system/2014-07-24-phpmyadmin-error.html" class="sidebar-link">访问phpmyadmin错误</a></li><li><a href="/system/2014-07-13-black-apple.html" class="sidebar-link">厚黑苹果售后</a></li><li><a href="/system/2014-06-25-wordpress-google-css.html" class="sidebar-link">wordpress引用google开放css加载不到解决方法</a></li><li><a href="/system/2014-06-25-nginx-https.html" class="sidebar-link">centos下nginx的https配置</a></li><li><a href="/system/2014-05-30-rsync.html" class="sidebar-link">rsync同步部署</a></li><li><a href="/system/2014-05-15-saltstack1.html" class="sidebar-link">使用saltstack批量管理服务器 （一）</a></li><li><a href="/system/2014-04-18-msmtpmutt.html" class="sidebar-link">msmtp+mutt 服务器批量发送邮件</a></li><li><a href="/system/2014-04-05-wordpress-them-only-one.html" class="sidebar-link">wordpress后台主题只有一个解决方法</a></li><li><a href="/system/2014-01-30-many-php-version.html" class="sidebar-link">多版本php共存搭建</a></li><li><a href="/system/2013-11-06-linux-memery-cat.html" class="sidebar-link">linux查看内存相关命令</a></li><li><a href="/system/2013-07-07-github-easy-install.html" class="sidebar-link">git安装使用</a></li><li><a href="/system/2013-06-30-localhost-127.0.0.1.html" class="sidebar-link">localhost 与 127.0.0.1 的区别</a></li><li><a href="/system/2013-06-15-rsync-del-hailiang.html" class="sidebar-link">使用rsync删除海量文件</a></li><li><a href="/system/2013-06-08-disk-data-recovery.html" class="sidebar-link">记录一次服务器数据恢复</a></li><li><a href="/system/2013-06-03-1nginx-502.html" class="sidebar-link">记录一次nginx 502</a></li><li><a href="/system/2013-06-02-linux-nohup.html" class="sidebar-link">linux命令后台运行详解</a></li><li><a href="/system/2013-06-01-disk-inode.html" class="sidebar-link">深入理解磁盘inode</a></li><li><a href="/system/2013-01-04-centos-php-oracle.html" class="sidebar-link">centos6.2下php支持oracle</a></li><li><a href="/system/2012-08-10-python-mysqldb-install.html" class="sidebar-link">CentOS下python-mysqldb安装事件</a></li><li><a href="/system/2012-08-03-sqlite-source-upgrade.html" class="sidebar-link">sqlite3源码升级事件</a></li><li><a href="/system/2012-08-01-centos6-pythonsqlite3.html" class="sidebar-link">centos6.2升级python后处理sqlite3库事件</a></li><li><a href="/system/2012-07-18-repair-yum.html" class="sidebar-link">误卸载python导致yum无法使用修复事件</a></li><li><a href="/system/2012-07-18-reload-upgrade-python.html" class="sidebar-link">Centos平滑升级python事件</a></li><li><a href="/system/2012-07-18-nginx413.html" class="sidebar-link">Nginx出现“413 Request Entity Too Large”错误解决方法</a></li><li><a href="/system/2012-07-06-nginx-apache-mulu-bd.html" class="sidebar-link">Nginx、Apache目录浏览功能</a></li><li><a href="/system/2012-06-27-yum-lamp-tomcat.html" class="sidebar-link">CentOS yum安装配置LAMP+tomcat</a></li><li><a href="/system/2012-06-11-ios-jiangji.html" class="sidebar-link">ios5.0.1降级4.3.3事件</a></li><li><a href="/system/2012-05-17-ocr-Tesseract.html" class="sidebar-link">OCR之Tesseract的linux下安装</a></li><li><a href="/system/2012-05-04-memcached-easy-install.html" class="sidebar-link">memcached简易安装</a></li><li><a href="/system/2012-04-11-centos-install-snmp.html" class="sidebar-link">centos下snmp客户端安装</a></li><li><a href="/system/2012-03-13-iptables-shell.html" class="sidebar-link">一篇很不错的iptables的shell</a></li><li><a href="/system/2012-03-07-cisco-fudong-luyou.html" class="sidebar-link">思科静态浮动路由配置</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>RaspberryPi</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>About</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="redhat-centos系统kvm虚拟机安装过程详解"><a href="#redhat-centos系统kvm虚拟机安装过程详解" aria-hidden="true" class="header-anchor">#</a> Redhat/CentOS系统KVM虚拟机安装过程详解</h1> <h2 id="什么是-kvm"><a href="#什么是-kvm" aria-hidden="true" class="header-anchor">#</a> 什么是 KVM ?</h2> <p>KVM 是指基于 Linux 内核的虚拟机（Kernel-based Virtual Machine）。 2006 年 10 月，由以色列的Qumranet 组织开发的一种新的“虚拟机”实现方案。 2007 年 2 月发布的 Linux 2.6.20 内核第一次包含了 KVM 。增加 KVM 到 Linux 内核是 Linux 发展的一个重要里程碑，这也是第一个整合到 Linux 主线内核的虚拟化技术。</p> <p>KVM 在标准的 Linux 内核中增加了虚拟技术，从而我们可以通过优化的内核来使用虚拟技术。在 KVM 模型中，每一个虚拟机都是一个由 Linux 调度程序管理的标准进程，你可以在用户空间启动客户机操作系统。一个普通的 Linux 进程有两种运行模式：内核和用户。 KVM 增加了第三种模式：客户模式（有自己的内核和用户模式）。</p> <p>一个典型的 KVM 安装包括以下部件：</p> <blockquote><ul><li>一个管理虚拟硬件的设备驱动，这个驱动通过一个字符设备 /dev/kvm 导出它的功能。通过 /dev/kvm每一个客户机拥有其自身的地址空间，这个地址空间与内核的地址空间相分离或与任何一个正运行着的客户机相分离。</li> <li>一个模拟硬件的用户空间部件，它是一个稍微改动过的 QEMU 进程。从客户机操作系统执行 I/O 会拥有QEMU 。 QEMU 是一个平台虚拟化方案，它允许整个 PC 环境（包括磁盘、显示卡（图形卡）、网络设备）的虚拟化。任何客户机操作系统所发出的 I/O 请求都被拦截，并被路由到用户模式用以被 QEMU 过程模拟仿真。</li></ul></blockquote> <h2 id="centos上安装kvm功能模块步骤"><a href="#centos上安装kvm功能模块步骤" aria-hidden="true" class="header-anchor">#</a> CentOS上安装KVM功能模块步骤</h2> <p><strong>1.KVM 需要有 CPU 的支持（Intel VT 或 AMD SVM），在安装 KVM 之前检查一下 CPU 是否提供了虚拟技术的支持。</strong></p> <blockquote><ul><li>基于 Intel 处理器的系统，运行<code>grep vmx /proc/cpuinfo</code>查找 CPU flags 是否包括 vmx 关键词</li> <li>基于 AMD 处理器的系统，运行<code>grep svm /proc/cpuinfo</code>查找 CPU flags 是否包括 svm 关键词</li> <li>检查BIOS，确保BIOS里开启VT选项:</li></ul></blockquote> <p>注 : 一些厂商禁止了机器 BIOS 中的 VT 选项 , 这种方式下 VT 不能被重新打开。**</p> <p>注意：/proc/cpuinfo 仅从 Linux 2.6.15(Intel) 和 Linux 2.6.16(AMD) 开始显示虚拟化方面的信息。请使用 uname -r 命令查询您的内核版本。如有疑问，请联系硬件厂商。</p> <p><strong>2.iptables设置</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost qemu<span class="token punctuation">]</span><span class="token comment"># cat /bin/iptables.sh </span>
modprobe ip_conntrack_ftp
iptables -F
iptables -A INPUT -i lo -j ACCEPT
iptables -A OUTPUT -o em1  -j ACCEPT
iptables -A INPUT -s <span class="token number">127.0</span>.0.1 -d <span class="token number">127.0</span>.0.1 -j ACCEPT
/sbin/iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

<span class="token comment">#for ping:</span>
iptables -A INPUT -p icmp --icmp-type echo-reply -j ACCEPT
iptables -A INPUT -p icmp --icmp-type echo-request -j ACCEPT

<span class="token comment">#for kvm</span>
iptables -I FORWARD -m physdev --physdev-is-bridged -j ACCEPT

iptables -A INPUT -p tcp -j REJECT --reject-with tcp-reset
iptables -A INPUT -j DROP
iptables -A FORWARD -j DROP
<span class="token punctuation">[</span>root@localhost qemu<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre></div><p><strong>3.安装与启动</strong></p> <pre><code>yum install kvm libvirt python-virtinst qemu-kvm virt-viewer bridge-utils

/etc/init.d/libvirtd start
</code></pre> <p><strong>4.建立虚拟机</strong></p> <p>划分硬盘</p> <pre><code>qemu-img create -f qcow2 -o preallocation=metadata /home/kvm/centos65-x64-mysql.qcow2 200G
</code></pre> <p>安装KVM，下面是两种常见的网络连接方式，默认是default，适用于不同需求的网络环境，后面配置KVM中会详细说明。</p> <p>bridge网络模式</p> <pre><code>virt-install --name=gatewat-4 --ram 4096 --vcpus=4 -f /home/kvm/gateway-4.qcow2 --cdrom /home/iso/CentOS-6.5-x86_64-bin-DVD1.iso --graphics vnc,listen=0.0.0.0,port=5920, --network bridge=br0 --force --autostart
</code></pre> <p>NAT网络模式</p> <pre><code>virt-install --name=test --ram 512 --vcpus=1 -f /home/kvm/test.qcow2 --cdrom /opt/CentOS-6.5-x86_64-bin-DVD1.iso --graphics vnc,listen=0.0.0.0,port=5988, --network network=default, --force --autostart
</code></pre> <p><strong>5.启动</strong></p> <p>使用<code>virsh list --all</code>查看已安装的kvm</p> <p>使用<code>virsh start test</code>启动虚拟机</p> <p>使用VNC工具连接KVM来进行初始化配置</p> <h2 id="配置kvm"><a href="#配置kvm" aria-hidden="true" class="header-anchor">#</a> 配置KVM</h2> <p>使用<code>virsh-install</code>安装完KVM之后，会自动生成相应配置</p> <p>KVM的配置文件存储在<code>/etc/libvirt/qemu/</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cd /etc/libvirt/qemu/</span>
<span class="token punctuation">[</span>root@localhost qemu<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">24</span>
drwxr-xr-x. <span class="token number">2</span> root root <span class="token number">4096</span> Jul <span class="token number">24</span> <span class="token number">17</span>:30 autostart
drwx------. <span class="token number">3</span> root root <span class="token number">4096</span> Jun <span class="token number">20</span> <span class="token number">19</span>:21 networks
-rw-------. <span class="token number">1</span> root root <span class="token number">2566</span> Aug <span class="token number">20</span> <span class="token number">18</span>:28 vm_1.xml
-rw-------. <span class="token number">1</span> root root <span class="token number">2560</span> Jul  <span class="token number">4</span> 02:02 vm_2.xml
-rw-------. <span class="token number">1</span> root root <span class="token number">2566</span> Aug <span class="token number">20</span> <span class="token number">18</span>:28 vm_3.xml
</code></pre></div><p>长的大概是这个样子</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost qemu<span class="token punctuation">]</span><span class="token comment"># cat vm_1.xml </span>
<span class="token operator">&lt;</span><span class="token operator">!</span>--
WARNING: THIS IS AN AUTO-GENERATED FILE. CHANGES TO IT ARE LIKELY TO BE 
OVERWRITTEN AND LOST. Changes to this xml configuration should be made using:
  <span class="token function">virsh</span> edit vm_1
or other application using the libvirt API.
--<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>domain <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'kvm'</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>vm_<span class="token operator"><span class="token file-descriptor important">1</span>&lt;</span>/name<span class="token operator">&gt;</span>  //此处为hostname
  <span class="token operator">&lt;</span>uuid<span class="token operator">&gt;</span>2f952159-b231-80a4-8086-d49978513fb<span class="token operator"><span class="token file-descriptor important">4</span>&lt;</span>/uuid<span class="token operator">&gt;</span>  //此处为uuid标识
  <span class="token operator">&lt;</span>memory <span class="token assign-left variable">unit</span><span class="token operator">=</span><span class="token string">'KiB'</span><span class="token operator">&gt;</span><span class="token number">838860</span><span class="token operator"><span class="token file-descriptor important">8</span>&lt;</span>/memory<span class="token operator">&gt;</span>  //此处为内存
  <span class="token operator">&lt;</span>currentMemory <span class="token assign-left variable">unit</span><span class="token operator">=</span><span class="token string">'KiB'</span><span class="token operator">&gt;</span><span class="token number">838860</span><span class="token operator"><span class="token file-descriptor important">8</span>&lt;</span>/currentMemory<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>vcpu <span class="token assign-left variable">placement</span><span class="token operator">=</span><span class="token string">'static'</span><span class="token operator">&gt;</span><span class="token operator"><span class="token file-descriptor important">6</span>&lt;</span>/vcpu<span class="token operator">&gt;</span>  //此处为cpu核数
  <span class="token operator">&lt;</span>os<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>type <span class="token assign-left variable">arch</span><span class="token operator">=</span><span class="token string">'x86_64'</span> <span class="token assign-left variable">machine</span><span class="token operator">=</span><span class="token string">'rhel6.5.0'</span><span class="token operator">&gt;</span>hvm<span class="token operator">&lt;</span>/type<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>boot <span class="token assign-left variable">dev</span><span class="token operator">=</span><span class="token string">'hd'</span>/<span class="token operator">&gt;</span>  //此处为启动项目，若想从光盘启动可设置为<span class="token operator">&lt;</span>boot <span class="token assign-left variable">dev</span><span class="token operator">=</span><span class="token string">'cdrom'</span>/<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/os<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>features<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>acpi/<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>apic/<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>pae/<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/features<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>clock <span class="token assign-left variable">offset</span><span class="token operator">=</span><span class="token string">'utc'</span>/<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>on_poweroff<span class="token operator">&gt;</span>destroy<span class="token operator">&lt;</span>/on_poweroff<span class="token operator">&gt;</span>  //此处为关机命令 使用 <span class="token function">virsh</span> destroy vm_1 关闭
  <span class="token operator">&lt;</span>on_reboot<span class="token operator">&gt;</span>restart<span class="token operator">&lt;</span>/on_reboot<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>on_crash<span class="token operator">&gt;</span>restart<span class="token operator">&lt;</span>/on_crash<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>devices<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>emulator<span class="token operator">&gt;</span>/usr/libexec/qemu-kvm<span class="token operator">&lt;</span>/emulator<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>disk <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'file'</span> <span class="token assign-left variable">device</span><span class="token operator">=</span><span class="token string">'disk'</span><span class="token operator">&gt;</span>  //此处为硬盘信息
      <span class="token operator">&lt;</span>driver <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">'qemu'</span> <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'raw'</span> <span class="token assign-left variable">cache</span><span class="token operator">=</span><span class="token string">'none'</span>/<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>source <span class="token assign-left variable">file</span><span class="token operator">=</span><span class="token string">'/home/kvm/vm_1.qcow2'</span>/<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>target <span class="token assign-left variable">dev</span><span class="token operator">=</span><span class="token string">'hda'</span> <span class="token assign-left variable">bus</span><span class="token operator">=</span><span class="token string">'ide'</span>/<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>address <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'drive'</span> <span class="token assign-left variable">controller</span><span class="token operator">=</span><span class="token string">'0'</span> <span class="token assign-left variable">bus</span><span class="token operator">=</span><span class="token string">'0'</span> <span class="token assign-left variable">target</span><span class="token operator">=</span><span class="token string">'0'</span> <span class="token assign-left variable">unit</span><span class="token operator">=</span><span class="token string">'0'</span>/<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/disk<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>disk <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'block'</span> <span class="token assign-left variable">device</span><span class="token operator">=</span><span class="token string">'cdrom'</span><span class="token operator">&gt;</span>  //此处为cdrom信息，可修改为iso的路径
      <span class="token operator">&lt;</span>driver <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">'qemu'</span> <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'raw'</span>/<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>target <span class="token assign-left variable">dev</span><span class="token operator">=</span><span class="token string">'hdc'</span> <span class="token assign-left variable">bus</span><span class="token operator">=</span><span class="token string">'ide'</span>/<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>readonly/<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>address <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'drive'</span> <span class="token assign-left variable">controller</span><span class="token operator">=</span><span class="token string">'0'</span> <span class="token assign-left variable">bus</span><span class="token operator">=</span><span class="token string">'1'</span> <span class="token assign-left variable">target</span><span class="token operator">=</span><span class="token string">'0'</span> <span class="token assign-left variable">unit</span><span class="token operator">=</span><span class="token string">'0'</span>/<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/disk<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>controller <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'usb'</span> <span class="token assign-left variable">index</span><span class="token operator">=</span><span class="token string">'0'</span><span class="token operator">&gt;</span>  //此处为usb接口信息
      <span class="token operator">&lt;</span>address <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'pci'</span> <span class="token assign-left variable">domain</span><span class="token operator">=</span><span class="token string">'0x0000'</span> <span class="token assign-left variable">bus</span><span class="token operator">=</span><span class="token string">'0x00'</span> <span class="token assign-left variable">slot</span><span class="token operator">=</span><span class="token string">'0x01'</span> <span class="token assign-left variable">function</span><span class="token operator">=</span><span class="token string">'0x2'</span>/<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/controller<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>controller <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'ide'</span> <span class="token assign-left variable">index</span><span class="token operator">=</span><span class="token string">'0'</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>address <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'pci'</span> <span class="token assign-left variable">domain</span><span class="token operator">=</span><span class="token string">'0x0000'</span> <span class="token assign-left variable">bus</span><span class="token operator">=</span><span class="token string">'0x00'</span> <span class="token assign-left variable">slot</span><span class="token operator">=</span><span class="token string">'0x01'</span> <span class="token assign-left variable">function</span><span class="token operator">=</span><span class="token string">'0x1'</span>/<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/controller<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>interface <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'network'</span><span class="token operator">&gt;</span>  //此处为网卡1信息，使用network也就是nat模式连接virbr0联网
      <span class="token operator">&lt;</span>mac <span class="token assign-left variable">address</span><span class="token operator">=</span><span class="token string">'52:54:00:9a:d7:82'</span>/<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>source <span class="token assign-left variable">network</span><span class="token operator">=</span><span class="token string">'default'</span>/<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>address <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'pci'</span> <span class="token assign-left variable">domain</span><span class="token operator">=</span><span class="token string">'0x0000'</span> <span class="token assign-left variable">bus</span><span class="token operator">=</span><span class="token string">'0x00'</span> <span class="token assign-left variable">slot</span><span class="token operator">=</span><span class="token string">'0x03'</span> <span class="token assign-left variable">function</span><span class="token operator">=</span><span class="token string">'0x0'</span>/<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/interface<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>interface <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'bridge'</span><span class="token operator">&gt;</span>  //此处为网卡2信息，使用bridge桥接方式到br1
      <span class="token operator">&lt;</span>mac <span class="token assign-left variable">address</span><span class="token operator">=</span><span class="token string">'52:54:11:fd:39:23'</span>/<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>source <span class="token assign-left variable">bridge</span><span class="token operator">=</span><span class="token string">'br1'</span>/<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>address <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'pci'</span> <span class="token assign-left variable">domain</span><span class="token operator">=</span><span class="token string">'0x0000'</span> <span class="token assign-left variable">bus</span><span class="token operator">=</span><span class="token string">'0x00'</span> <span class="token assign-left variable">slot</span><span class="token operator">=</span><span class="token string">'0x05'</span> <span class="token assign-left variable">function</span><span class="token operator">=</span><span class="token string">'0x0'</span>/<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/interface<span class="token operator">&gt;</span>
//若要添加网卡可新加配置，注意修改mac地址
    <span class="token operator">&lt;</span>interface <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'bridge'</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>mac <span class="token assign-left variable">address</span><span class="token operator">=</span><span class="token string">'52:54:21:fd:39:23'</span>/<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>source <span class="token assign-left variable">bridge</span><span class="token operator">=</span><span class="token string">'br0'</span>/<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>address <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'pci'</span> <span class="token assign-left variable">domain</span><span class="token operator">=</span><span class="token string">'0x0000'</span> <span class="token assign-left variable">bus</span><span class="token operator">=</span><span class="token string">'0x00'</span> <span class="token assign-left variable">slot</span><span class="token operator">=</span><span class="token string">'0x08'</span> <span class="token assign-left variable">function</span><span class="token operator">=</span><span class="token string">'0x0'</span>/<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/interface<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>serial <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'pty'</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>target <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token string">'0'</span>/<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/serial<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>console <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'pty'</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>target <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'serial'</span> <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token string">'0'</span>/<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/console<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'mouse'</span> <span class="token assign-left variable">bus</span><span class="token operator">=</span><span class="token string">'ps2'</span>/<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>graphics <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'vnc'</span> <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token string">'5920'</span> <span class="token assign-left variable">autoport</span><span class="token operator">=</span><span class="token string">'no'</span> <span class="token assign-left variable">listen</span><span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token operator">&gt;</span>  //此处为VNC连接端口
      <span class="token operator">&lt;</span>listen <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'address'</span> <span class="token assign-left variable">address</span><span class="token operator">=</span><span class="token string">'0.0.0.0'</span>/<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/graphics<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>video<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>model <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'cirrus'</span> <span class="token assign-left variable">vram</span><span class="token operator">=</span><span class="token string">'9216'</span> <span class="token assign-left variable">heads</span><span class="token operator">=</span><span class="token string">'1'</span>/<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>address <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'pci'</span> <span class="token assign-left variable">domain</span><span class="token operator">=</span><span class="token string">'0x0000'</span> <span class="token assign-left variable">bus</span><span class="token operator">=</span><span class="token string">'0x00'</span> <span class="token assign-left variable">slot</span><span class="token operator">=</span><span class="token string">'0x02'</span> <span class="token assign-left variable">function</span><span class="token operator">=</span><span class="token string">'0x0'</span>/<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/video<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>memballoon <span class="token assign-left variable">model</span><span class="token operator">=</span><span class="token string">'virtio'</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>address <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'pci'</span> <span class="token assign-left variable">domain</span><span class="token operator">=</span><span class="token string">'0x0000'</span> <span class="token assign-left variable">bus</span><span class="token operator">=</span><span class="token string">'0x00'</span> <span class="token assign-left variable">slot</span><span class="token operator">=</span><span class="token string">'0x04'</span> <span class="token assign-left variable">function</span><span class="token operator">=</span><span class="token string">'0x0'</span>/<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/memballoon<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/devices<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/domain<span class="token operator">&gt;</span>
<span class="token punctuation">[</span>root@localhost qemu<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre></div><p>后期可能会因为需求对KVM重新配置，这个时候我们只需要修改对应的<code>xml</code>文件即可</p> <p>修改配置的时候需要关闭KVM <code>virsh destroy vm_1</code></p> <p>使用<code>virsh define vm_1.xml</code>使配置生效</p> <p>使用<code>virsh start vm_1</code>启动虚拟机</p> <h2 id="配置网路环境"><a href="#配置网路环境" aria-hidden="true" class="header-anchor">#</a> 配置网路环境</h2> <p><strong>1.nat模式配置</strong></p> <p>KVM默认采用nat模式，用户网络（User Networking）：让虚拟机访问主机、互联网或本地网络上的资源的简单方法，但是不能从网络或其他的客户机访问客户机。在公网IP不够使用KVM还需要上网的时候可以使用，大大节省了公网IP！同时这种模式也使得KVM不用暴露在公网之中，也增加了安全性。</p> <p>下图是虚拟机管理模块产生的接口关系：</p> <p><img src="http://segmentfault.com/img/bVcRHo" alt="请输入图片描述"></p> <p>其中virbr0是由宿主机虚拟机支持模块安装时产生的虚拟网络接口，也是一个switch和bridge，负责把内容分发到各虚拟机。</p> <p>从图上可以看出，虚拟接口和物理接口之间没有连接关系，所以虚拟机只能在通过虚拟的网络访问外部世界，无法从网络上定位和访问虚拟主机。</p> <p>下面是nat的default配置，可以自定义地址池</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost qemu<span class="token punctuation">]</span><span class="token comment"># cat /etc/libvirt/qemu/networks/default.xml </span>
<span class="token operator">&lt;</span>network<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>default<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>uuid<span class="token operator">&gt;</span>a8e0859c-4761-4d78-bcd6-eaeeceace42<span class="token operator"><span class="token file-descriptor important">9</span>&lt;</span>/uuid<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>bridge <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&quot;virbr0&quot;</span> /<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>mac <span class="token assign-left variable">address</span><span class="token operator">=</span><span class="token string">'52:54:00:C9:D5:1E'</span>/<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>forward/<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>ip <span class="token assign-left variable">address</span><span class="token operator">=</span><span class="token string">&quot;192.168.122.1&quot;</span> <span class="token assign-left variable">netmask</span><span class="token operator">=</span><span class="token string">&quot;255.255.255.0&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>dhcp<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>range <span class="token assign-left variable">start</span><span class="token operator">=</span><span class="token string">&quot;192.168.122.2&quot;</span> <span class="token assign-left variable">end</span><span class="token operator">=</span><span class="token string">&quot;192.168.122.254&quot;</span> /<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/dhcp<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/ip<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/network<span class="token operator">&gt;</span>
<span class="token punctuation">[</span>root@localhost qemu<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre></div><p>创建方法：</p> <p>使用<code>virsh net-start default</code>来启动nat网络，同时，虚拟机支持模块会修改iptables规则，通过命令可以查看：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># iptables -t nat -L -nv</span>
Chain PREROUTING <span class="token punctuation">(</span>policy ACCEPT <span class="token number">16924</span> packets, 2759K bytes<span class="token punctuation">)</span>
pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination
Chain POSTROUTING <span class="token punctuation">(</span>policy ACCEPT <span class="token number">2009</span> packets, 125K bytes<span class="token punctuation">)</span>
pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination        
 <span class="token number">421</span> <span class="token number">31847</span> MASQUERADE  all  --  *      *       <span class="token number">192.168</span>.122.0/24    <span class="token operator">!</span><span class="token number">192.168</span>.122.0/24   -----------<span class="token operator">&gt;</span>这条是关键，它配置了NAT功能。
Chain OUTPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">2011</span> packets, 125K bytes<span class="token punctuation">)</span>
pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination        
</code></pre></div><p>如果你由于不小心将IPTABLE清空或者STOP导致IPTABLE配置丢失，可以通过如下操作来恢复：</p> <pre><code>virsh net-destroy default

virsh net-start default
</code></pre> <p>确认路由转发开启</p> <pre><code>[root@localhost qemu]# more /proc/sys/net/ipv4/ip_forward 
1
</code></pre> <p>下面是一个KVM的nat模式的范例</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>root@vm_1 data<span class="token punctuation">]</span><span class="token comment"># cat /etc/sysconfig/network-scripts/ifcfg-eth0</span>

<span class="token comment">#使用dhcp</span>
<span class="token comment">#DEVICE=eth0</span>
<span class="token comment">#ONBOOT=yes</span>
<span class="token comment">#TYPE=Ethernet</span>
<span class="token comment">#BOOTPROTO=dhcp</span>

<span class="token comment">#手动IP</span>
<span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>eth0
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">192.168</span>.122.3
<span class="token assign-left variable">NETMASK</span><span class="token operator">=</span><span class="token number">255.255</span>.255.0
<span class="token assign-left variable">GATEWAY</span><span class="token operator">=</span><span class="token number">192.168</span>.122.1
<span class="token assign-left variable">DNS1</span><span class="token operator">=</span><span class="token number">192.168</span>.122.1
<span class="token assign-left variable">TYPE</span><span class="token operator">=</span>Ethernet
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>static
<span class="token assign-left variable">IPV6INIT</span><span class="token operator">=</span>no
<span class="token assign-left variable">USERCTL</span><span class="token operator">=</span>no
<span class="token punctuation">[</span>root@vm_web_1_1 data<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre></div><p><strong>2.Bridge方式</strong></p> <p>虚拟网桥（Virtual Bridge）：设置好后客户机与互联网，客户机与主机之间都可以通信，试用于需要多个公网IP的环境。</p> <p>Bridge方式即虚拟网桥的网络连接方式，是客户机和子网里面的机器能够互相通信。可以使虚拟机成为网络中具有独立IP的主机。</p> <p>桥接网络（也叫物理设备共享）被用作把一个物理设备复制到一台虚拟机。网桥多用作高级设置，特别是主机多个网络接口的情况。</p> <p><img src="http://segmentfault.com/img/bVcRIf" alt="请输入图片描述"></p> <p>如上图，网桥的基本原理就是创建一个桥接接口br0，在物理网卡和虚拟网络接口之间传递数据。</p> <p>创建方法：</p> <p>不用过多命令，只需要修改好网卡的桥接方式，配好IP即可，下面是范例，不用注释仔细读一遍就能看懂了！</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>kvm_server<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>

<span class="token punctuation">[</span>root@localhost network-scripts<span class="token punctuation">]</span><span class="token comment"># cat ifcfg-br0 </span>
<span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>br0
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>none
<span class="token assign-left variable">TYPE</span><span class="token operator">=</span>Bridge
<span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">114.137</span>.122.233
<span class="token assign-left variable">NETMASK</span><span class="token operator">=</span><span class="token number">255.255</span>.255.128
<span class="token assign-left variable">GATEWAY</span><span class="token operator">=</span><span class="token number">114.137</span>.102.139
<span class="token assign-left variable">DNS1</span><span class="token operator">=</span><span class="token number">202.96</span>.122.83
<span class="token assign-left variable">IPV6INIT</span><span class="token operator">=</span>no
<span class="token assign-left variable">NM_CONTROLLED</span><span class="token operator">=</span>yes
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">USERCTL</span><span class="token operator">=</span>no

<span class="token punctuation">[</span>root@localhost network-scripts<span class="token punctuation">]</span><span class="token comment"># cat ifcfg-br1</span>
<span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>br1
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>none
<span class="token assign-left variable">TYPE</span><span class="token operator">=</span>Bridge
<span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">192.168</span>.1.12
<span class="token assign-left variable">NETMASK</span><span class="token operator">=</span><span class="token number">255.255</span>.255.0
<span class="token assign-left variable">IPV6INIT</span><span class="token operator">=</span>no
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">USERCTL</span><span class="token operator">=</span>no

<span class="token punctuation">[</span>root@localhost network-scripts<span class="token punctuation">]</span><span class="token comment"># cat ifcfg-em1 </span>
<span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>em1
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>none
<span class="token assign-left variable">BRIDGE</span><span class="token operator">=</span>br0
<span class="token assign-left variable">TYPE</span><span class="token operator">=</span>Ethernet
<span class="token assign-left variable">IPV6INIT</span><span class="token operator">=</span>no
<span class="token assign-left variable">USERCTL</span><span class="token operator">=</span>no

<span class="token punctuation">[</span>root@localhost network-scripts<span class="token punctuation">]</span><span class="token comment"># cat ifcfg-em2</span>
<span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>em2
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>none
<span class="token assign-left variable">BRIDGE</span><span class="token operator">=</span>br1
<span class="token assign-left variable">TYPE</span><span class="token operator">=</span>Ethernet
<span class="token assign-left variable">IPV6INIT</span><span class="token operator">=</span>no
<span class="token assign-left variable">USERCTL</span><span class="token operator">=</span>no

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>kvm<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>

<span class="token punctuation">[</span>root@gateway-2 network-scripts<span class="token punctuation">]</span><span class="token comment"># cat ifcfg-eth0</span>
<span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>eth0
<span class="token assign-left variable">TYPE</span><span class="token operator">=</span>Ethernet
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">NM_CONTROLLED</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">114.137</span>.122.222
<span class="token assign-left variable">NETMASK</span><span class="token operator">=</span><span class="token number">255.255</span>.255.128
<span class="token assign-left variable">GATEWAY</span><span class="token operator">=</span><span class="token number">114.137</span>.102.139
<span class="token assign-left variable">DNS1</span><span class="token operator">=</span><span class="token number">202.96</span>.122.83

<span class="token punctuation">[</span>root@gateway-2 network-scripts<span class="token punctuation">]</span><span class="token comment"># cat ifcfg-eth0:1</span>
<span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>eth0:1
<span class="token assign-left variable">TYPE</span><span class="token operator">=</span>Ethernet
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">114.137</span>.122.123
<span class="token assign-left variable">NETMASK</span><span class="token operator">=</span><span class="token number">255.255</span>.255.128
<span class="token assign-left variable">NM_CONTROLLED</span><span class="token operator">=</span>yes
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>static

<span class="token punctuation">[</span>root@gateway-2 network-scripts<span class="token punctuation">]</span><span class="token comment"># cat ifcfg-eth1</span>
<span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>eth1
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">192.168</span>.1.25
<span class="token assign-left variable">NETMASK</span><span class="token operator">=</span><span class="token number">255.255</span>.255.0
<span class="token assign-left variable">TYPE</span><span class="token operator">=</span>Ethernet
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>static
<span class="token assign-left variable">IPV6INIT</span><span class="token operator">=</span>no
<span class="token assign-left variable">USERCTL</span><span class="token operator">=</span>no
</code></pre></div><p><strong>注意：网络配置可以同时存在nat和Bridge，看最上面的vm_1.xml</strong></p> <h2 id="_2014-10-29更新"><a href="#_2014-10-29更新" aria-hidden="true" class="header-anchor">#</a> ---2014.10.29更新---</h2> <p>由于按照上文的NAT方式配置的机器，过了几个月宿主机重启之后死活连接不上外网ping不通<code>virbr0</code>(192.168.122.1)，<code>virsh net-destroy default</code>和 <code>virsh net-start default</code>之后也是不行，尝试了各种方案，最后<code>/etc/init.d/libvirtd restart</code>之后会偶尔联上外网ping通192.168.122.1，但是<code>virsh net-destroy default</code>和 <code>virsh net-start default</code>之后又连不上外网，今天又在测试环境测试都是OK的也没发现问题~~~~</p> <p>真实匪夷所思~~~</p> <p>最后抱着尝试一下的心态按照http://www.linuxidc.com/Linux/2012-05/61445.htm这篇文章配置了，果断就OK了！再此记录一下！</p> <p><strong>宿主机配置</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>root@web8 qemu<span class="token punctuation">]</span><span class="token comment"># cp /etc/libvirt/qemu/networks/default.xml /etc/libvirt/qemu/networks/default.xml.bk </span>

<span class="token punctuation">[</span>root@web8 qemu<span class="token punctuation">]</span><span class="token comment"># cat /etc/libvirt/qemu/networks/default.xml</span>

<span class="token operator">&lt;</span>network<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>default<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>uuid<span class="token operator">&gt;</span>ea07af3d-fd95-444d-a1d2-a0ae5fce43de<span class="token operator">&lt;</span>/uuid<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>forward <span class="token assign-left variable">mode</span><span class="token operator">=</span><span class="token string">'nat'</span>/<span class="token operator">&gt;</span>   //此处增加mode参数为nat
  <span class="token operator">&lt;</span>bridge <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">'virbr0'</span> <span class="token assign-left variable">stp</span><span class="token operator">=</span><span class="token string">'on'</span> <span class="token assign-left variable">delay</span><span class="token operator">=</span><span class="token string">'0'</span> /<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>mac <span class="token assign-left variable">address</span><span class="token operator">=</span><span class="token string">'52:54:00:89:DD:12'</span>/<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>ip <span class="token assign-left variable">address</span><span class="token operator">=</span><span class="token string">'192.168.122.1'</span> <span class="token assign-left variable">netmask</span><span class="token operator">=</span><span class="token string">'255.255.255.0'</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>dhcp<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>range <span class="token assign-left variable">start</span><span class="token operator">=</span><span class="token string">'192.168.122.2'</span> <span class="token assign-left variable">end</span><span class="token operator">=</span><span class="token string">'192.168.122.254'</span> /<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/dhcp<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/ip<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/network<span class="token operator">&gt;</span>

<span class="token punctuation">[</span>root@web8 qemu<span class="token punctuation">]</span><span class="token comment"># virsh net-define /etc/libvirt/qemu/networks/default.xml</span>
<span class="token punctuation">[</span>root@web8 qemu<span class="token punctuation">]</span><span class="token comment"># virsh net-destroy default</span>
<span class="token punctuation">[</span>root@web8 qemu<span class="token punctuation">]</span><span class="token comment"># virsh net-start default</span>

<span class="token punctuation">[</span>root@web8 qemu<span class="token punctuation">]</span><span class="token comment"># cat  vm.xml</span>

······
    <span class="token operator">&lt;</span>interface <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'network'</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>mac <span class="token assign-left variable">address</span><span class="token operator">=</span><span class="token string">'52:54:00:66:6e:49'</span>/<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>source <span class="token assign-left variable">network</span><span class="token operator">=</span><span class="token string">'default'</span>/<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>model <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'virtio'</span>/<span class="token operator">&gt;</span>  //此处为新增参数mode
      <span class="token operator">&lt;</span>address <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'pci'</span> <span class="token assign-left variable">domain</span><span class="token operator">=</span><span class="token string">'0x0000'</span> <span class="token assign-left variable">bus</span><span class="token operator">=</span><span class="token string">'0x00'</span> <span class="token assign-left variable">slot</span><span class="token operator">=</span><span class="token string">'0x03'</span> <span class="token assign-left variable">function</span><span class="token operator">=</span><span class="token string">'0x0'</span>/<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/interface<span class="token operator">&gt;</span>
······

</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/system/2014-10-18-windows_configuration_Jekyll.html" class="prev">Windows平台配置Jekyll环境并与GitHub连接</a></span> <span class="next"><a href="/system/2014-08-18-Sublime-add-youjian.html">将sublime text添加到右键菜单中</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.294eee9c.js" defer></script><script src="/assets/js/2.24623497.js" defer></script><script src="/assets/js/109.441214fa.js" defer></script>
  </body>
</html>
